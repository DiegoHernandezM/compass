import{j as e,r as s,a as X,q as S,$ as Y}from"./app-eAIuj_cC.js";import{D as Z,M as C,A as ee}from"./AuthenticatedLayout-1Tl302_h.js";import{c as W,T as A}from"./Typography-BcdJuq5C.js";import{d as b}from"./index-BQc1uWjq.js";import{C as ae,T as g,F,I as O,a as P}from"./Close-yBam2o1_.js";import{B as f}from"./Box-BGLLKGRv.js";import{I as y}from"./IconButton-CrzczThT.js";import{F as re,C as te,D as q,a as N,E as ne,b as se,S as le,V as oe}from"./ValidationErrorAlert-FS6RG0IT.js";import{B as j}from"./Button-DI9pIjvX.js";import{D as M}from"./Dialog-BcsoZR_i.js";import{D as Q,a as R,b as B}from"./DialogTitle-79ovbJM9.js";import"./isMuiElement-BN6hkxZ0.js";import"./Logout-Cp_TGwhv.js";import"./Paper-D99NRCdE.js";import"./Grow-DLqGqw0i.js";import"./Portal-Bp8leHfp.js";import"./Modal-CIXJXkbC.js";import"./Tooltip-69rEhds4.js";import"./useThemeProps-B-6moD8G.js";import"./Alert--jybFbC2.js";const ie=W(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"})),ce=W(e.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}));function de({open:h,onClose:m,question:a=null,subjectId:i}){const[l,o]=s.useState({subject_id:i,question:"",answer_a:"",answer_b:"",answer_c:"",answer_d:"",correct_answer:"",feedback_text:"",feedback_image:null,has_dynamic:!1});s.useEffect(()=>{i&&o(c=>({...c,subject_id:i}))},[i]),s.useEffect(()=>{o(a?{subject_id:a.subject_id||i||"",question:a.question||"",answer_a:a.answer_a||"",answer_b:a.answer_b||"",answer_c:a.answer_c||"",answer_d:a.answer_d||"",correct_answer:a.correct_answer||"",feedback_text:a.feedback_text||"",feedback_image:null,has_dynamic:a.has_dynamic||!1}:{subject_id:i||"",question:"",answer_a:"",answer_b:"",answer_c:"",answer_d:"",correct_answer:"",feedback_text:"",feedback_image:null,has_dynamic:!1})},[a,i]);const t=c=>{const{name:x,type:p,files:r,value:n,checked:w}=c.target,_=p==="file"?r[0]:p==="checkbox"?w:n;o(v=>({...v,[x]:_}))},u=c=>{c.preventDefault();const x={...l};a?b.Inertia.post(route("question.update",a.id),{...x,_method:"PUT"},{forceFormData:!0}):b.Inertia.post(route("question.store"),x,{forceFormData:!0}),m()};return e.jsx(Z,{anchor:"right",open:h,onClose:m,sx:{zIndex:c=>c.zIndex.drawer+1e3},children:e.jsxs(f,{sx:{width:400,p:3},role:"presentation",children:[e.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(A,{variant:"h6",children:a?"Editar Pregunta":"Nueva Pregunta"}),e.jsx(y,{onClick:m,children:e.jsx(ae,{})})]}),e.jsxs(f,{component:"form",onSubmit:u,mt:2,children:[e.jsx(g,{label:"Pregunta",name:"question",fullWidth:!0,value:l.question,onChange:t,margin:"normal",required:!0}),e.jsx(g,{label:"Respuesta A",name:"answer_a",fullWidth:!0,value:l.answer_a,onChange:t,margin:"normal",required:!0}),e.jsx(g,{label:"Respuesta B",name:"answer_b",fullWidth:!0,value:l.answer_b,onChange:t,margin:"normal",required:!0}),e.jsx(g,{label:"Respuesta C",name:"answer_c",fullWidth:!0,value:l.answer_c,onChange:t,margin:"normal",required:!0}),e.jsx(g,{label:"Respuesta D",name:"answer_d",fullWidth:!0,value:l.answer_d,onChange:t,margin:"normal"}),e.jsxs(F,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(O,{id:"correct-answer-label",children:"Respuesta Correcta"}),e.jsxs(P,{labelId:"correct-answer-label",name:"correct_answer",value:l.correct_answer,label:"Respuesta Correcta",onChange:t,MenuProps:{container:document.body,disablePortal:!0},children:[e.jsx(C,{value:"A",children:"A"}),e.jsx(C,{value:"B",children:"B"}),e.jsx(C,{value:"C",children:"C"}),e.jsx(C,{value:"D",children:"D"})]})]}),e.jsx(g,{label:"Retroalimentación",name:"feedback_text",fullWidth:!0,multiline:!0,rows:3,value:l.feedback_text,onChange:t,margin:"normal"}),e.jsx("input",{type:"file",name:"feedback_image",onChange:t,style:{marginTop:16}}),e.jsx(re,{control:e.jsx(te,{checked:l.has_dynamic,onChange:t,name:"has_dynamic"}),label:"¿Contiene dinámica?",sx:{mt:2}}),e.jsx(j,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:2},children:a?"Actualizar":"Crear"})]})]})})}function ue({open:h,onClose:m,subject:a,handleEditQuestion:i,handleDelete:l,handleExport:o}){const[t,u]=s.useState([]),[c,x]=s.useState(!0),p=async()=>{try{const n=await X.get(route("question.subject",a==null?void 0:a.id));u(n.data)}catch(n){console.error("Error fetching questions:",n)}finally{x(!1)}};s.useEffect(()=>{h&&(a!=null&&a.id)&&p()},[h,a==null?void 0:a.id]);const r=[{field:"question",headerName:"Pregunta",flex:1},{field:"correct_answer",headerName:"Correcta",width:120},{field:"has_dynamic",headerName:"Dinámica",width:120,renderCell:n=>e.jsx("span",{children:n.value?"Sí":"No"})},{field:"actions",headerName:"Acciones",width:120,sortable:!1,renderCell:n=>e.jsxs(N,{direction:"row",spacing:1,children:[e.jsx(y,{onClick:()=>i(n.row),color:"primary",children:e.jsx(ne,{})}),e.jsx(y,{onClick:()=>l(n.row.id),color:"error",size:"small",children:e.jsx(se,{})})]})}];return e.jsxs(M,{open:h,onClose:m,fullWidth:!0,maxWidth:"md",children:[e.jsxs(Q,{children:["Preguntas de la materia: ",a==null?void 0:a.name]}),e.jsx(R,{children:c?e.jsx(A,{children:"Cargando preguntas..."}):e.jsx(f,{sx:{height:400,width:"100%"},children:e.jsx(q,{rows:t,columns:r,pageSize:5,rowsPerPageOptions:[5],getRowId:n=>n.id})})}),e.jsx(B,{children:e.jsx(j,{onClick:m,children:"Cerrar"})})]})}function he({open:h,onClose:m,subjects:a,onImport:i,handleExport:l}){const[o,t]=s.useState(""),[u,c]=s.useState(null),x=r=>{c(r.target.files[0])},p=()=>{if(u&&o){const r=new FormData;r.append("file",u),r.append("subject_id",o),i(r),c(null),t(""),m()}};return e.jsxs(M,{open:h,onClose:m,fullWidth:!0,maxWidth:"sm",children:[e.jsx(Q,{children:"Importar Preguntas por Excel"}),e.jsx(R,{children:e.jsxs(f,{sx:{mt:2},children:[e.jsxs(F,{fullWidth:!0,margin:"normal",children:[e.jsx(O,{id:"subject-select-label",children:"Materia"}),e.jsx(P,{labelId:"subject-select-label",value:o,label:"Materia",onChange:r=>t(r.target.value),required:!0,children:a.map(r=>e.jsx(C,{value:r.id,children:r.name},r.id))})]}),e.jsxs(j,{variant:"outlined",component:"label",fullWidth:!0,sx:{mt:2},children:["Seleccionar archivo Excel",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx, .xls",onChange:x})]}),u&&e.jsx(g,{label:"Archivo seleccionado",value:u.name,fullWidth:!0,disabled:!0,margin:"normal"})]})}),e.jsxs(B,{children:[e.jsx(j,{onClick:()=>{l(o),t(null)},children:"Exportar Concentrado"}),e.jsx(j,{onClick:()=>{m(),t(null)},children:"Cancelar"}),e.jsx(j,{variant:"contained",onClick:p,disabled:!u||!o,children:"Importar"})]})]})}function Oe(){var I,E;const{errors:h,flash:m}=S().props,{questions:a,subjects:i}=S().props,[l,o]=s.useState(!1),[t,u]=s.useState(!1),[c,x]=s.useState(!1),[p,r]=s.useState(null),[n,w]=s.useState(null),_=((E=(I=S().props)==null?void 0:I.flash)==null?void 0:E.success)??null,[v,k]=s.useState(!!_),[z,D]=s.useState(!1);s.useEffect(()=>{_&&k(!0)},[_]),s.useEffect(()=>{Object.keys(h).length>0&&D(!0)},[h]);const T=d=>{w(d),o(!0)},V=d=>{r(d),o(!0)},L=d=>{w(d),u(!0)},H=()=>{o(!1),r(null),w(null)},$=()=>{u(!1),r(null),w(null)},G=()=>{x(!0)},U=d=>{b.Inertia.get(route("question.export",d))},J=[{field:"name",headerName:"Materia",flex:.5},{field:"questions_count",headerName:"Número de preguntas",flex:.5},{field:"actions",headerName:"Acciones",flex:.5,sortable:!0,renderCell:d=>e.jsxs(N,{direction:"row",spacing:1,children:[e.jsx(y,{onClick:()=>L(d.row),color:"primary",children:e.jsx(ce,{})}),e.jsx(y,{onClick:()=>T(d.row),color:"primary",children:e.jsx(ie,{})})]})}],K=d=>{confirm("¿Estás seguro de eliminar esta pregunta?")&&b.Inertia.delete(route("question.destroy",d))};return e.jsxs(ee,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Cuestionarios"}),children:[e.jsx(Y,{title:"Cuestionarios"}),e.jsx(le,{open:v,onClose:()=>k(!1),message:_}),e.jsx(oe,{open:z,onClose:()=>D(!1),errors:h}),e.jsxs(f,{p:4,children:[e.jsx(f,{display:"flex",justifyContent:"flex-end",mb:2,children:e.jsx(j,{variant:"contained",color:"primary",onClick:G,children:"Importar Cuestionario"})}),e.jsx(f,{sx:{height:500,width:"100%"},children:e.jsx(q,{rows:i,columns:J,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,autoHeight:!0})})]}),e.jsx(de,{open:l,onClose:H,question:p,subjectId:n==null?void 0:n.id}),e.jsx(ue,{open:t,onClose:$,subject:n,handleEditQuestion:V,handleDelete:K}),e.jsx(he,{open:c,onClose:()=>x(!1),subjects:i,onImport:d=>{b.Inertia.post(route("question.import"),d,{forceFormData:!0})},handleExport:U})]})}export{Oe as default};
