import{r as x,j as s,q as L,v as J,$ as K}from"./app-BqWlvYXa.js";import{A as Q}from"./AuthenticatedLayout-DvPkSqb7.js";import{B as r}from"./Box-BUJooizW.js";import{S as _}from"./Stack-TDRU_GPF.js";import{A as B}from"./Alert-olohZ20j.js";import{C as U}from"./Card-CeR8cu3-.js";import{g as V,a as X,b as Y,T as y,s as I,c as Z,t as E}from"./Typography-KjnR0wxH.js";import{u as f}from"./Modal-DSVhJoGT.js";import{C as z}from"./CardContent-Dmz4biAL.js";import{B as ee}from"./Button-B6_tUdkC.js";import{L as te}from"./LinearProgress-CVlH1iMS.js";import{T as se,F as ae,I as re,S as oe}from"./TextField-BSUfUADF.js";import{M as g}from"./Toolbar-C4xSzryH.js";import{D as ne}from"./DataGrid-CcXzG_69.js";import"./School-DlE_rjWc.js";import"./createSvgIcon-CwdkiJb4.js";import"./Logout-h3QwyMd0.js";import"./isMuiElement-C0bkQkL3.js";import"./Fade-C2LyS97k.js";import"./index-CUdHpl8X.js";import"./getThemeProps-VTvsTMSr.js";import"./IconButton-R5mr-7Si.js";import"./index-BltL7mRL.js";import"./Slide-B7yoBshC.js";import"./debounce-Be36O1Ab.js";import"./useFormControl-Btw4PGPb.js";import"./useThemeProps-CT_TUxfz.js";function ie(i){return X("MuiCardHeader",i)}const F=V("MuiCardHeader",["root","avatar","action","content","title","subheader"]),le=i=>{const{classes:n}=i;return Z({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},ie,n)},de=I("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(i,n)=>[{[`& .${F.title}`]:n.title},{[`& .${F.subheader}`]:n.subheader},n.root]})({display:"flex",alignItems:"center",padding:16}),ce=I("div",{name:"MuiCardHeader",slot:"Avatar"})({display:"flex",flex:"0 0 auto",marginRight:16}),me=I("div",{name:"MuiCardHeader",slot:"Action"})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),pe=I("div",{name:"MuiCardHeader",slot:"Content"})({flex:"1 1 auto",[`.${E.root}:where(& .${F.title})`]:{display:"block"},[`.${E.root}:where(& .${F.subheader})`]:{display:"block"}}),O=x.forwardRef(function(n,m){const S=Y({props:n,name:"MuiCardHeader"}),{action:C,avatar:l,component:j="div",disableTypography:p=!1,subheader:A,subheaderTypographyProps:b,title:M,titleTypographyProps:P,slots:T={},slotProps:R={},...D}=S,d={...S,component:j,disableTypography:p},c=le(d),o={slots:T,slotProps:{title:P,subheader:b,...R}};let u=M;const[W,$]=f("title",{className:c.title,elementType:y,externalForwardedProps:o,ownerState:d,additionalProps:{variant:l?"body2":"h5",component:"span"}});u!=null&&u.type!==y&&!p&&(u=s.jsx(W,{...$,children:u}));let h=A;const[H,k]=f("subheader",{className:c.subheader,elementType:y,externalForwardedProps:o,ownerState:d,additionalProps:{variant:l?"body2":"body1",color:"textSecondary",component:"span"}});h!=null&&h.type!==y&&!p&&(h=s.jsx(H,{...k,children:h}));const[N,t]=f("root",{ref:m,className:c.root,elementType:de,externalForwardedProps:{...o,...D,component:j},ownerState:d}),[e,w]=f("avatar",{className:c.avatar,elementType:ce,externalForwardedProps:o,ownerState:d}),[v,a]=f("content",{className:c.content,elementType:pe,externalForwardedProps:o,ownerState:d}),[q,G]=f("action",{className:c.action,elementType:me,externalForwardedProps:o,ownerState:d});return s.jsxs(N,{...t,children:[l&&s.jsx(e,{...w,children:l}),s.jsxs(v,{...a,children:[u,h]}),C&&s.jsx(q,{...G,children:C})]})});function Be(){var N;const{props:i}=L(),n=L().props.latest??[],m=((N=i==null?void 0:i.flash)==null?void 0:N.success)??null,[S,C]=x.useState(!!m),[l,j]=x.useState(!1),[p,A]=x.useState(""),[b,M]=x.useState("all"),P=t=>t?new Date(t):null,{data:T,setData:R,post:D,reset:d,errors:c,progress:o}=J({file:null});x.useEffect(()=>{m&&C(!0)},[m]);const u=t=>{R("file",t.target.files[0]??null)},W=t=>{t.preventDefault(),T.file&&(j(!0),D(route("personal-reports.import"),{forceFormData:!0,onFinish:()=>{j(!1),d("file")}}))},$=(t,e)=>{if(e==="all")return!0;if(!t)return!1;const w=new Date,v=24*60*60*1e3,a=Math.floor((w-t)/v);switch(e){case"1w":return a<=7;case"2w":return a>7&&a<=14;case"3w":return a>14&&a<=21;case"1m":return a>21&&a<=31;case"gt1m":return a>31;default:return!0}},h=x.useMemo(()=>{const t=p.trim().toLowerCase();return(n??[]).filter(e=>{const w=P(e==null?void 0:e.opened_at),v=$(w,b),a=!t||String((e==null?void 0:e.ticket_number)??"").toLowerCase().includes(t)||String((e==null?void 0:e.client)??"").toLowerCase().includes(t)||String((e==null?void 0:e.unit)??"").toLowerCase().includes(t)||String((e==null?void 0:e.assignee)??"").toLowerCase().includes(t);return v&&a})},[n,p,b]),H=t=>{if(!t)return"";const e=P(t);return e?e.toLocaleString():""},k=[{field:"ticket_number",headerName:"Ticket",flex:.8,minWidth:120,renderCell:t=>{var e;return s.jsx(r,{children:((e=t.row)==null?void 0:e.ticket_number)??""})}},{field:"opened_at",headerName:"F. de alta",flex:1,minWidth:160,renderCell:t=>{var e;return s.jsx(r,{children:H((e=t.row)==null?void 0:e.opened_at)})}},{field:"closed_at",headerName:"F. de cierre",flex:1,minWidth:160,renderCell:t=>{var e;return s.jsx(r,{children:H((e=t.row)==null?void 0:e.closed_at)})}},{field:"status",headerName:"Estado",flex:.8,minWidth:120,renderCell:t=>{var e;return s.jsx(r,{children:((e=t.row)==null?void 0:e.status)??""})}},{field:"assignee",headerName:"Asignado",flex:1.2,minWidth:160,renderCell:t=>{var e;return s.jsx(r,{children:((e=t.row)==null?void 0:e.assignee)??""})}},{field:"client",headerName:"Cliente",flex:1,minWidth:140,renderCell:t=>{var e;return s.jsx(r,{children:((e=t.row)==null?void 0:e.client)??""})}},{field:"unit",headerName:"Unidad",flex:1,minWidth:140,renderCell:t=>{var e;return s.jsx(r,{children:((e=t.row)==null?void 0:e.unit)??""})}},{field:"contact",headerName:"Contacto",flex:1,minWidth:160,renderCell:t=>{var e;return s.jsx(r,{children:((e=t.row)==null?void 0:e.contact)??""})}},{field:"description",headerName:"Descripción",flex:1.6,minWidth:220,renderCell:t=>{var e;return s.jsx(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:((e=t.row)==null?void 0:e.description)??""})}}];return s.jsxs(Q,{header:s.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Importar reporte de tickets"}),children:[s.jsx(K,{title:"Personal Reports"}),s.jsxs(r,{p:3,children:[s.jsxs(_,{spacing:2,sx:{mb:2},children:[S&&s.jsx(B,{severity:"success",onClose:()=>C(!1),children:m}),c.file&&s.jsx(B,{severity:"error",children:c.file})]}),s.jsxs(U,{sx:{mb:3},children:[s.jsx(O,{title:"Subir archivo Excel",subheader:"Formatos permitidos: .xlsx, .xls, .csv"}),s.jsx(z,{children:s.jsxs("form",{onSubmit:W,encType:"multipart/form-data",children:[s.jsxs(_,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",children:[s.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:u,disabled:l}),s.jsx(ee,{type:"submit",variant:"contained",disabled:!T.file||l,children:l?"Importando...":"Importar"})]}),(o||l)&&s.jsxs(r,{sx:{mt:2},children:[s.jsx(y,{variant:"caption",children:"Progreso"}),s.jsx(te,{variant:"determinate",value:(o==null?void 0:o.percentage)??100})]})]})})]}),s.jsxs(U,{children:[s.jsx(O,{title:"Últimos registros importados"}),s.jsxs(z,{children:[s.jsxs(r,{display:"flex",gap:2,mb:2,alignItems:"center",flexWrap:"wrap",children:[s.jsx(se,{size:"small",label:"Buscar (ticket / cliente / unidad / asignado)",value:p,onChange:t=>A(t.target.value),sx:{minWidth:360}}),s.jsxs(ae,{size:"small",sx:{minWidth:240},children:[s.jsx(re,{id:"age-filter-label",children:"Creado"}),s.jsxs(oe,{labelId:"age-filter-label",label:"Creado",value:b,onChange:t=>M(t.target.value),children:[s.jsx(g,{value:"all",children:"Todos"}),s.jsx(g,{value:"1w",children:"Creado hace 1 semana"}),s.jsx(g,{value:"2w",children:"Creado hace 2 semanas"}),s.jsx(g,{value:"3w",children:"Creado hace 3 semanas"}),s.jsx(g,{value:"1m",children:"Creado hace 1 mes"}),s.jsx(g,{value:"gt1m",children:"Creado hace más de 1 mes"})]})]})]}),s.jsx(ne,{rows:h,columns:k,getRowId:t=>(t==null?void 0:t.id)??`${t.ticket_number}-${t.opened_at}-${Math.random()}`,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,autoHeight:!0})]})]})]})]})}export{Be as default};
