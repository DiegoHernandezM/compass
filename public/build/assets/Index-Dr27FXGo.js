import{r as a,j as e,a as X,q as z,$ as xe}from"./app-DwCEZVFF.js";import{D as fe,A as je}from"./AuthenticatedLayout-U9Uyw_Gk.js";import{V,I as pe,A as ge}from"./index-COt1ceky.js";import{d as T}from"./index-DoMVEGhO.js";import{C as Y}from"./Close-BV66wLSe.js";import{B as h}from"./Box-uR_MV7Yt.js";import{T as $}from"./Typography-C9TfHzEn.js";import{I as D}from"./IconButton-C1FLJJIM.js";import{T as I,F as N,I as W,a as O}from"./TextField-17wVU2sh.js";import{M as k,A as we,T as be}from"./Toolbar-B4-R3iO0.js";import{F as Z,S as H}from"./Stack-B7v_HOYv.js";import{C as ee,D as G,T as E,S as Ce,V as _e}from"./ValidationErrorAlert-C2_VF21B.js";import{B as b}from"./Button-D2li4RT3.js";import{D as R}from"./Dialog-D2BGgOXh.js";import{D as Q,a as y,b as L}from"./DialogTitle-LPV4W4Fb.js";import{F as ve}from"./FormGroup-BRd1qzUI.js";import{E as Se,D as Ie}from"./Edit-BBIefANG.js";import{S as ke}from"./index-zh7_OOK1.js";import"./School-XkyOLg96.js";import"./Logout-XIE38ds4.js";import"./isMuiElement-BY-e61hx.js";import"./Modal-BxgXCAmp.js";import"./index-CTz2S2P7.js";import"./Person-CtViAMGu.js";import"./MenuBook-OgOW2h6B.js";import"./useFormControl-C5o9xrum.js";import"./debounce-Be36O1Ab.js";import"./useThemeProps-wrbgtDKb.js";import"./getThemeProps-DhhtQzxo.js";import"./Alert-DNxaXQ3C.js";function De({open:f,onClose:c,question:n=null,subjectId:l}){const[m,o]=a.useState({subject_id:l,question:"",answer_a:"",answer_b:"",answer_c:"",answer_d:"",correct_answer:"",feedback_text:"",feedback_image:null,has_dynamic:!1});a.useEffect(()=>{l&&o(x=>({...x,subject_id:l}))},[l]),a.useEffect(()=>{o(n?{subject_id:n.subject_id||l||"",question:n.question||"",answer_a:n.answer_a||"",answer_b:n.answer_b||"",answer_c:n.answer_c||"",answer_d:n.answer_d||"",correct_answer:n.correct_answer||"",feedback_text:n.feedback_text||"",feedback_image:null,has_dynamic:n.has_dynamic||!1}:{subject_id:l||"",question:"",answer_a:"",answer_b:"",answer_c:"",answer_d:"",correct_answer:"",feedback_text:"",feedback_image:null,has_dynamic:!1})},[n,l]);const s=x=>{const{name:d,type:p,files:j,value:g,checked:w}=x.target,C=p==="file"?j[0]:p==="checkbox"?w:g;o(_=>({..._,[d]:C}))},i=x=>{x.preventDefault();const d={...m};n?T.Inertia.post(route("question.update",n.id),{...d,_method:"PUT"},{forceFormData:!0}):T.Inertia.post(route("question.store"),d,{forceFormData:!0}),c()};return e.jsx(fe,{anchor:"right",open:f,onClose:c,sx:{zIndex:x=>x.zIndex.drawer+1e3},children:e.jsxs(h,{sx:{width:400,p:3},role:"presentation",children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx($,{variant:"h6",children:n?"Editar Pregunta":"Nueva Pregunta"}),e.jsx(D,{onClick:c,children:e.jsx(Y,{})})]}),e.jsxs(h,{component:"form",onSubmit:i,mt:2,children:[e.jsx(I,{label:"Pregunta",name:"question",fullWidth:!0,value:m.question,onChange:s,margin:"normal",required:!0}),e.jsx(I,{label:"Respuesta A",name:"answer_a",fullWidth:!0,value:m.answer_a,onChange:s,margin:"normal",required:!0}),e.jsx(I,{label:"Respuesta B",name:"answer_b",fullWidth:!0,value:m.answer_b,onChange:s,margin:"normal",required:!0}),e.jsx(I,{label:"Respuesta C",name:"answer_c",fullWidth:!0,value:m.answer_c,onChange:s,margin:"normal",required:!0}),e.jsx(I,{label:"Respuesta D",name:"answer_d",fullWidth:!0,value:m.answer_d,onChange:s,margin:"normal"}),e.jsxs(N,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(W,{id:"correct-answer-label",children:"Respuesta Correcta"}),e.jsxs(O,{labelId:"correct-answer-label",name:"correct_answer",value:m.correct_answer,label:"Respuesta Correcta",onChange:s,MenuProps:{container:document.body,disablePortal:!0},children:[e.jsx(k,{value:"A",children:"A"}),e.jsx(k,{value:"B",children:"B"}),e.jsx(k,{value:"C",children:"C"}),e.jsx(k,{value:"D",children:"D"})]})]}),e.jsx(I,{label:"Retroalimentación",name:"feedback_text",fullWidth:!0,multiline:!0,rows:3,value:m.feedback_text,onChange:s,margin:"normal"}),e.jsx("input",{type:"file",name:"feedback_image",onChange:s,style:{marginTop:16}}),e.jsx(Z,{control:e.jsx(ee,{checked:m.has_dynamic,onChange:s,name:"has_dynamic"}),label:"¿Contiene dinámica?",sx:{mt:2}}),e.jsx(b,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:2},children:n?"Actualizar":"Crear"})]})]})})}function qe({open:f,onClose:c,type:n,subjects:l,onSave:m}){const[o,s]=a.useState(""),[i,x]=a.useState(""),d=l.find(r=>r.id===Number(o)),p=(n==null?void 0:n.levels)||[],j=p.find(r=>r.id===Number(i)),[g,w]=a.useState(!1),[C,_]=a.useState(""),[v,t]=a.useState(""),S=(n==null?void 0:n.bypass_levels_and_questions)===1,[B,q]=a.useState(!1);a.useEffect(()=>{(async()=>{var A;if(o&&i)try{const F=await X.get(`/admin/question/check-existence/${o}/${i}/${n==null?void 0:n.id}`);((A=F.data)==null?void 0:A.exists.length)>0&&(console.log(F.data.exists),q(!0))}catch(F){console.error("Error al verificar test existente:",F)}})()},[o,i]);const M=()=>{if(n!=null&&n.id&&o){const r=new FormData;r.append("subject_id",o),r.append("question_type_id",n==null?void 0:n.id),r.append("question_level_id",i),r.append("question_count",C),r.append("has_time_limit",g?"1":"0"),g&&r.append("time_limit",v),m(r),s(""),x(""),_(""),t(""),c()}};return e.jsxs(e.Fragment,{children:[e.jsxs(R,{open:f,onClose:(r,A)=>{},fullWidth:!0,maxWidth:"xl",disableEscapeKeyDown:!0,children:[e.jsxs(Q,{children:["Tipo de cuestionario: ",n==null?void 0:n.name]}),e.jsx(y,{children:e.jsxs(h,{sx:{mt:2},children:[e.jsxs(N,{fullWidth:!0,margin:"normal",children:[e.jsx(W,{id:"type-select-label",children:"Materias"}),e.jsx(O,{labelId:"type-select-label",value:o??"",label:"Materias",onChange:r=>{s(r.target.value),x("")},required:!0,children:l.map(r=>e.jsx(k,{value:r.id,children:r.name},r.id))})]}),e.jsxs(N,{fullWidth:!0,margin:"normal",disabled:p.length==0,children:[e.jsx(W,{id:"level-select-label",children:"Nivel de complejidad"}),e.jsx(O,{labelId:"level-select-label",value:i??"",label:"Nivel de complejidad",onChange:r=>x(r.target.value),required:p.length>0,children:p.map(r=>e.jsxs(k,{value:r.id,children:[r.name," - ",r.description]},r.id))})]}),(j||S)&&e.jsxs(N,{fullWidth:!0,margin:"normal",children:[e.jsx($,{variant:"subtitle1",component:"p",children:S?"Número de preguntas para el examen":`Preguntas disponibles sobre examen (${j?j.questions_count||0:(d==null?void 0:d.questions_count)||0})`}),e.jsx(I,{id:"count-question-required",label:"Número de preguntas para examen",type:"number",inputProps:{min:1,...S?{}:{max:j?j.questions_count:(d==null?void 0:d.questions_count)||1}},onChange:r=>_(r.target.value),required:!0})]}),S||o&&e.jsx(ve,{children:e.jsx(Z,{control:e.jsx(ee,{checked:g,onChange:r=>w(r.target.checked)}),label:"Tiempo límite"})}),g&&e.jsx(e.Fragment,{children:e.jsx(N,{fullWidth:!0,margin:"normal",children:e.jsx(I,{id:"limit-time-required",label:"Tiempo límite (segundos por pregunta)",type:"number",onChange:r=>t(r.target.value),inputProps:{min:1}})})})]})}),e.jsxs(L,{children:[e.jsx(b,{onClick:()=>{c(),s(""),i("")},children:"Cancelar"}),e.jsx(b,{variant:"contained",onClick:M,disabled:!o,children:"Crear"})]})]}),e.jsxs(R,{open:B,onClose:()=>q(!1),children:[e.jsx(Q,{children:"Existen oreguntas asignadas a esta materia"}),e.jsx(y,{children:"Al continuar se reasignarán las nuevas preguntas a la materia con el nivel asignado. ¿Quieres continuar?"}),e.jsxs(L,{children:[e.jsx(b,{onClick:()=>q(!1),children:"Cancelar"}),e.jsx(b,{onClick:()=>{q(!1)},autoFocus:!0,children:"Continuar"})]})]})]})}function Ne({open:f,onClose:c,types:n,onImport:l,handleExport:m}){const[o,s]=a.useState(""),[i,x]=a.useState(null),[d,p]=a.useState(""),[j,g]=a.useState(""),w=n.find(t=>t.id===Number(d)),C=(w==null?void 0:w.levels)||[],_=t=>{x(t.target.files[0])},v=()=>{if(i&&d){const t=new FormData;t.append("file",i),t.append("type_id",d),t.append("level_id",j),l(t),x(null),setTypetId(""),setLeveltId(""),c()}};return e.jsxs(R,{open:f,onClose:c,fullWidth:!0,maxWidth:"sm",children:[e.jsx(Q,{children:"Importar a banco de preguntas"}),e.jsx(y,{children:e.jsxs(h,{sx:{mt:2},children:[e.jsxs(N,{fullWidth:!0,margin:"normal",children:[e.jsx(W,{id:"type-select-label",children:"Tipo de cuestionario"}),e.jsx(O,{labelId:"type-select-label",value:d,label:"Tipo de cuestionario",onChange:t=>{p(t.target.value),g("")},required:!0,children:n.filter(t=>t.is_automatic===0).map(t=>e.jsx(k,{value:t.id,children:t.name},t.id))})]}),e.jsxs(N,{fullWidth:!0,margin:"normal",disabled:!C.length,children:[e.jsx(W,{id:"level-select-label",children:"Nivel de complejidad"}),e.jsx(O,{labelId:"level-select-label",value:j,label:"Nivel de complejidad",onChange:t=>g(t.target.value),required:!0,children:C.map(t=>e.jsxs(k,{value:t.id,children:[t.name," - ",t.description]},t.id))})]}),e.jsxs(b,{variant:"outlined",component:"label",fullWidth:!0,sx:{mt:2},children:["Seleccionar archivo Excel",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx, .xls",onChange:_})]}),i&&e.jsx(I,{label:"Archivo seleccionado",value:i.name,fullWidth:!0,disabled:!0,margin:"normal"})]})}),e.jsxs(L,{children:[e.jsx(b,{onClick:()=>{m(o),s(null)},children:"Exportar Concentrado"}),e.jsx(b,{onClick:()=>{c(),p(null),g(null)},children:"Cancelar"}),e.jsx(b,{variant:"contained",onClick:v,disabled:!i||!d,children:"Importar"})]})]})}function Ee({open:f,onClose:c,type:n,handleEditQuestion:l,handleDelete:m,handleSowQuestions:o}){const s=[{field:"name",headerName:"Nivel",flex:.1},{field:"description",headerName:"Descripción",flex:.5},{field:"actions",headerName:"Acciones",flex:.2,sortable:!1,renderCell:i=>e.jsxs(H,{direction:"row",spacing:1,children:[e.jsx(E,{title:"Editar",arrow:!0,children:e.jsx(D,{onClick:()=>l(i.row),color:"primary",children:e.jsx(Se,{})})}),e.jsx(E,{title:"Ver preguntas",arrow:!0,children:e.jsx(D,{onClick:()=>o(i.row),color:"primary",children:e.jsx(V,{})})}),e.jsx(E,{title:"Eliminar nivel",arrow:!0,children:e.jsx(D,{onClick:()=>m(i.row.id),color:"error",size:"small",children:e.jsx(Ie,{})})})]})}];return e.jsxs(R,{open:f,onClose:c,fullWidth:!0,maxWidth:"md",children:[e.jsxs(Q,{children:["Niveles de: ",n==null?void 0:n.name]}),e.jsx(y,{children:e.jsx(h,{sx:{height:400,width:"100%"},children:e.jsx(G,{rows:n==null?void 0:n.levels,columns:s,pageSize:5,rowsPerPageOptions:[5],getRowId:i=>i.id})})}),e.jsx(L,{children:e.jsx(b,{onClick:c,children:"Cerrar"})})]})}const Fe=a.forwardRef(function(c,n){return e.jsx(ke,{direction:"up",ref:n,...c})});function Te({open:f,close:c,questions:n,type:l}){const m=[{field:"name",headerName:"Memorama",flex:.9,sortable:!0,renderCell:s=>{const i=pe[s.row.name];return i?e.jsx(i,{sx:{fontSize:40,color:"#555",mx:"auto"}}):e.jsx("span",{children:s.row.name})}}],o=[{field:"question",headerName:"Pregunta",flex:.9,sortable:!0,renderCell:s=>s.row.question?e.jsx(E,{title:s.row.question,arrow:!0,children:e.jsx("span",{style:{cursor:"default"},children:s.row.question})}):e.jsx(h,{component:"img",src:s.row.question_image,alt:"Pregunta",sx:{width:300,height:"auto",objectFit:"contain"}})},{field:"answer_a",headerName:"Opción A",flex:.9,sortable:!0,renderCell:s=>s.row.question?e.jsx("span",{children:s.row.answer_a}):s.row.answer_a?e.jsx(h,{sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(h,{component:"img",src:s.row.answer_a,alt:"Respuesta A",sx:{width:25,height:25,objectFit:"contain"}})}):e.jsx("span",{children:"-"})},{field:"answer_b",headerName:"Opción B",flex:.9,sortable:!0,renderCell:s=>s.row.question?e.jsx("span",{children:s.row.answer_b}):s.row.answer_b?e.jsx(h,{sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(h,{component:"img",src:s.row.answer_b,alt:"Respuesta B",sx:{width:25,height:25,objectFit:"contain"}})}):e.jsx("span",{children:"-"})},{field:"answer_c",headerName:"Opción C",flex:.9,sortable:!0,renderCell:s=>s.row.question?e.jsx("span",{children:s.row.answer_c}):s.row.answer_c?e.jsx(h,{sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(h,{component:"img",src:s.row.answer_c,alt:"Respuesta C",sx:{width:25,height:25,objectFit:"contain"}})}):e.jsx("span",{children:"-"})},{field:"answer_d",headerName:"Opción D",flex:.9,sortable:!0,renderCell:s=>s.row.question?e.jsx("span",{children:s.row.answer_d}):s.row.answer_d?e.jsx(h,{sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(h,{component:"img",src:s.row.answer_d,alt:"Respuesta D",sx:{width:20,height:20,objectFit:"contain"}})}):e.jsx("span",{children:"-"})},{field:"correct_answer",headerName:"Respuesta",flex:.5},{field:"actions",headerName:"Acciones",flex:.5,sortable:!0,renderCell:s=>e.jsx(H,{direction:"row",spacing:1,children:e.jsx(E,{title:"Niveles",arrow:!0,children:e.jsx(D,{onClick:()=>handleSowLevels(s.row),color:"primary",children:e.jsx(V,{})})})})}];return e.jsx(a.Fragment,{children:e.jsxs(R,{fullScreen:!0,open:f,onClose:c,slots:{transition:Fe},children:[e.jsx(we,{sx:{position:"relative"},children:e.jsxs(be,{children:[e.jsx(D,{edge:"start",color:"inherit",onClick:c,"aria-label":"close",children:e.jsx(Y,{})}),e.jsx($,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:l==null?void 0:l.name}),e.jsx(b,{autoFocus:!0,color:"inherit",onClick:c,children:"CERRAR"})]})}),e.jsx(h,{p:4,children:e.jsx(h,{sx:{height:500,width:"100%"},children:e.jsx(G,{rows:n,columns:(l==null?void 0:l.bypass_levels_and_questions)!=1?o:m,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,autoHeight:!0})})})]})})}function dn(){var U,J;const{errors:f,flash:c}=z().props,{subjects:n,types:l}=z().props,[m,o]=a.useState(!1),[s,i]=a.useState(!1),[x,d]=a.useState(!1),[p,j]=a.useState(!1),[g,w]=a.useState(null),[C,_]=a.useState(null),[v,t]=a.useState(null),S=((J=(U=z().props)==null?void 0:U.flash)==null?void 0:J.success)??null,[B,q]=a.useState(!!S),[M,r]=a.useState(!1),[A,F]=a.useState([]),[ne,K]=a.useState(!1);a.useEffect(()=>{S&&q(!0)},[S]),a.useEffect(()=>{Object.keys(f).length>0&&r(!0)},[f]);const se=u=>{t(u),d(!0)},re=u=>{w(u),o(!0)},te=u=>{t(u),i(!0)},ae=()=>{o(!1),w(null),_(null)},ie=()=>{d(!1),w(null),_(null)},le=()=>{i(!1),w(null),_(null)},oe=()=>{j(!0)},ce=u=>{T.Inertia.get(route("question.export",u))},de=[{field:"name",headerName:"Tipo de cuestionario",flex:.5},{field:"description",headerName:"Descripción",flex:.5},{field:"actions",headerName:"Acciones",flex:.5,sortable:!0,renderCell:u=>e.jsxs(H,{direction:"row",spacing:1,children:[e.jsx(E,{title:"Niveles",arrow:!0,children:e.jsx(D,{onClick:()=>te(u.row),color:"primary",children:e.jsx(V,{})})}),e.jsx(E,{title:"Asignar a Materias",arrow:!0,children:e.jsx(D,{onClick:()=>se(u.row),color:"primary",children:e.jsx(ge,{})})})]})}],ue=u=>{confirm("¿Estás seguro de eliminar esta pregunta?")&&T.Inertia.delete(route("question.destroy",u))},he=u=>{T.Inertia.post(route("question.test"),u,{forceFormData:!0})},me=async u=>{try{const P=await X.get(route("question.show",{typeId:v==null?void 0:v.id,levelId:u==null?void 0:u.id}));P.data.questions&&(F(P.data.questions),K(!0))}catch(P){console.error("Error al obtener preguntas:",P)}};return e.jsxs(je,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Cuestionarios"}),children:[e.jsx(xe,{title:"Cuestionarios"}),e.jsx(Ce,{open:B,onClose:()=>q(!1),message:S}),e.jsx(_e,{open:M,onClose:()=>r(!1),errors:f}),e.jsxs(h,{p:4,children:[e.jsx(h,{display:"flex",justifyContent:"flex-end",mb:2,children:e.jsx(b,{variant:"contained",color:"primary",onClick:oe,children:"Importar Cuestionario"})}),e.jsx(h,{sx:{height:500,width:"100%"},children:e.jsx(G,{rows:l,columns:de,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,autoHeight:!0})})]}),e.jsx(De,{open:m,onClose:ae,question:g,subjectId:C==null?void 0:C.id}),e.jsx(qe,{open:x,onClose:ie,subjects:n,type:v,onSave:he}),e.jsx(Ee,{open:s,onClose:le,type:v,handleEditQuestion:re,handleDelete:ue,handleSowQuestions:me}),e.jsx(Te,{open:ne,close:()=>K(!1),questions:A,type:v}),e.jsx(Ne,{open:p,onClose:()=>j(!1),types:l,onImport:u=>{T.Inertia.post(route("question.import"),u,{forceFormData:!0})},handleExport:ce})]})}export{dn as default};
