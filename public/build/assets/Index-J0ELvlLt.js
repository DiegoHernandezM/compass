import{r as l,j as t,q as J,v as re,$ as oe}from"./app-1N2yyaC7.js";import{A as ae}from"./AuthenticatedLayout-wnS3IuM5.js";import{B as n}from"./Box--mxV3xbB.js";import{S as K}from"./Stack-utyhpqVl.js";import{A as Q}from"./Alert-C6vfpSRO.js";import{g as ne,a as le,b as ie,c as j,T as v,s as R,d as de,t as V,B as ce,C as X}from"./Modal-B-ejLRXY.js";import{C as Y}from"./Card-D1BtjQmV.js";import{C as Z}from"./CardContent-BizGbWWH.js";import{B as q}from"./Button-BoTqHcQU.js";import{L as ue}from"./LinearProgress-r3kngql6.js";import{T as me,F as he,I as pe,S as xe}from"./TextField-DHX6OGrm.js";import{M as w}from"./ErrorAlert-DIl-xOWy.js";import{D as fe}from"./Dialog-DRfKdy1E.js";import{D as ge,a as Ce}from"./DialogTitle-Ctglz5cj.js";import{D as be}from"./DialogActions-D7DPMj9X.js";import{D as je}from"./DataGrid-nuAxJK2P.js";import"./School-BCAaVzuk.js";import"./createSvgIcon-CMP9chmU.js";import"./Logout--vrwq_ac.js";import"./isMuiElement-PcXgI9Ee.js";import"./index-B0CYb8qG.js";import"./getThemeProps-8OSM87jU.js";import"./index-p_b7ytGd.js";import"./useFormControl-DG8IYMgQ.js";import"./useControlled-DkFfKZ5Z.js";import"./useThemeProps-Bqf1Y0Ph.js";import"./index-DHoA0182.js";import"./Tooltip-CcKONjtm.js";import"./TableCell-CkjmOc5G.js";function we(c){return le("MuiCardHeader",c)}const I=ne("MuiCardHeader",["root","avatar","action","content","title","subheader"]),ve=c=>{const{classes:i}=c;return de({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},we,i)},Se=R("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(c,i)=>[{[`& .${I.title}`]:i.title},{[`& .${I.subheader}`]:i.subheader},i.root]})({display:"flex",alignItems:"center",padding:16}),ye=R("div",{name:"MuiCardHeader",slot:"Avatar"})({display:"flex",flex:"0 0 auto",marginRight:16}),De=R("div",{name:"MuiCardHeader",slot:"Action"})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),Te=R("div",{name:"MuiCardHeader",slot:"Content"})({flex:"1 1 auto",[`.${V.root}:where(& .${I.title})`]:{display:"block"},[`.${V.root}:where(& .${I.subheader})`]:{display:"block"}}),ee=l.forwardRef(function(i,f){const P=ie({props:i,name:"MuiCardHeader"}),{action:S,avatar:u,component:y="div",disableTypography:g=!1,subheader:N,subheaderTypographyProps:D,title:L,titleTypographyProps:k,slots:A={},slotProps:T={},...F}=P,m={...P,component:y,disableTypography:g},h=ve(m),p={slots:A,slotProps:{title:k,subheader:D,...T}};let d=L;const[C,$]=j("title",{className:h.title,elementType:v,externalForwardedProps:p,ownerState:m,additionalProps:{variant:u?"body2":"h5",component:"span"}});d!=null&&d.type!==v&&!g&&(d=t.jsx(C,{...$,children:d}));let x=N;const[M,W]=j("subheader",{className:h.subheader,elementType:v,externalForwardedProps:p,ownerState:m,additionalProps:{variant:u?"body2":"body1",color:"textSecondary",component:"span"}});x!=null&&x.type!==v&&!g&&(x=t.jsx(M,{...W,children:x}));const[_,H]=j("root",{ref:f,className:h.root,elementType:Se,externalForwardedProps:{...p,...F,component:y},ownerState:m}),[b,U]=j("avatar",{className:h.avatar,elementType:ye,externalForwardedProps:p,ownerState:m}),[B,z]=j("content",{className:h.content,elementType:Te,externalForwardedProps:p,ownerState:m}),[E,O]=j("action",{className:h.action,elementType:De,externalForwardedProps:p,ownerState:m});return t.jsxs(_,{...H,children:[u&&t.jsx(b,{...U,children:u}),t.jsxs(B,{...z,children:[d,x]}),S&&t.jsx(E,{...O,children:S})]})});function st(){var G;const{props:c}=J(),i=J().props.latest??[],f=((G=c==null?void 0:c.flash)==null?void 0:G.success)??null,[P,S]=l.useState(!!f),[u,y]=l.useState(!1),[g,N]=l.useState(""),[D,L]=l.useState("all"),k=e=>e?new Date(e):null,[A,T]=l.useState(!1),[F,m]=l.useState("Detalle"),[h,p]=l.useState(""),[d,C]=l.useState(!1),$=e=>{var r,o;if(console.log(e),e.field!=="description")return;const s=((r=e==null?void 0:e.row)==null?void 0:r.description)??"";s&&(m(`Ticket ${((o=e==null?void 0:e.row)==null?void 0:o.ticket_number)??""}`),p(s),T(!0))},{data:x,setData:M,post:W,reset:_,errors:H,progress:b}=re({file:null});l.useEffect(()=>{f&&S(!0)},[f]);const U=e=>{M("file",e.target.files[0]??null)},B=e=>{e.preventDefault(),x.file&&(y(!0),C(!0),W(route("personal-reports.import"),{forceFormData:!0,onFinish:()=>{y(!1),_("file"),C(!1)}}))},z=(e,s)=>{if(console.log("entrox"),s==="all")return!0;if(!e)return!1;const r=new Date,o=24*60*60*1e3,a=Math.floor((r-e)/o);switch(s){case"1w":return a<=7;case"2w":return a>7&&a<=14;case"3w":return a>14&&a<=21;case"1m":return a>21&&a<=31;case"gt1m":return a>31;default:return!0}},E=l.useMemo(()=>{const e=g.trim().toLowerCase();return(i??[]).filter(s=>{const r=k(s==null?void 0:s.opened_at),o=z(r,D),a=!e||String((s==null?void 0:s.ticket_number)??"").toLowerCase().includes(e)||String((s==null?void 0:s.client)??"").toLowerCase().includes(e)||String((s==null?void 0:s.unit)??"").toLowerCase().includes(e)||String((s==null?void 0:s.assignee)??"").toLowerCase().includes(e);return o&&a})},[i,g,D]),O=e=>{if(!e)return"";const s=k(e);return s?s.toLocaleString():""},te=async()=>{C(!0);try{const e=await fetch(route("personal-reports.export-dashboard"));if(!e.ok){const a=await e.text();throw new Error(a||`HTTP ${e.status}`)}const s=await e.blob(),r=URL.createObjectURL(s),o=document.createElement("a");o.href=r,o.download=`dashboard_tickets_${new Date().toISOString()}.xlsx`,document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(r)}catch(e){alert("Hubo un error al descargar el archivo"),console.error(e)}finally{C(!1)}},se=[{field:"ticket_number",headerName:"Ticket",flex:.8,minWidth:120,renderCell:e=>{var s;return t.jsx(n,{children:((s=e.row)==null?void 0:s.ticket_number)??""})}},{field:"opened_at",headerName:"F. de alta",flex:1,minWidth:160,renderCell:e=>{var s;return t.jsx(n,{children:O((s=e.row)==null?void 0:s.opened_at)})}},{field:"count",headerName:"No. de registros",flex:.8,minWidth:120,renderCell:e=>{var s;return t.jsx(n,{children:((s=e.row)==null?void 0:s.count)??""})}},{field:"assignee",headerName:"Asignado",flex:1.2,minWidth:160,renderCell:e=>{var s;return t.jsx(n,{children:((s=e.row)==null?void 0:s.assignee)??""})}},{field:"client",headerName:"Cliente",flex:1,minWidth:140,renderCell:e=>{var s;return t.jsx(n,{children:((s=e.row)==null?void 0:s.client)??""})}},{field:"unit",headerName:"Unidad",flex:1,minWidth:140,renderCell:e=>{var s;return t.jsx(n,{children:((s=e.row)==null?void 0:s.unit)??""})}},{field:"contact",headerName:"Contacto",flex:1,minWidth:160,renderCell:e=>{var s;return t.jsx(n,{children:((s=e.row)==null?void 0:s.contact)??""})}},{field:"description",headerName:"Descripción",flex:1.6,minWidth:220,renderCell:e=>{var s,r;return t.jsx(n,{sx:{width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:(s=e.row)!=null&&s.description?"zoom-in":"default"},title:"Doble clic para ver completo",children:((r=e.row)==null?void 0:r.description)??""})}}];return t.jsxs(ae,{header:t.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Importar reporte de tickets"}),children:[t.jsx(oe,{title:"Personal Reports"}),t.jsxs(n,{p:3,children:[t.jsxs(K,{spacing:2,sx:{mb:2},children:[P&&t.jsx(Q,{severity:"success",onClose:()=>S(!1),children:f}),H.file&&t.jsx(Q,{severity:"error",children:H.file})]}),t.jsx(ce,{open:d,sx:{color:"#fff",zIndex:e=>e.zIndex.modal+1},children:t.jsx(X,{color:"inherit"})}),t.jsxs(Y,{sx:{mb:3},children:[t.jsx(ee,{title:"Subir archivo Excel",subheader:"Formatos permitidos: .xlsx, .xls, .csv"}),t.jsx(Z,{children:t.jsxs("form",{onSubmit:B,encType:"multipart/form-data",children:[t.jsxs(K,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",children:[t.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:U,disabled:u}),t.jsx(q,{type:"submit",variant:"contained",disabled:!x.file||u,children:u?"Importando...":"Importar"}),t.jsx(q,{variant:"outlined",onClick:te,disabled:d,startIcon:d&&t.jsx(X,{size:20}),children:d?"Descargando...":"Descargar dashboard Excel"})]}),(b||u)&&t.jsxs(n,{sx:{mt:2},children:[t.jsx(v,{variant:"caption",children:"Progreso"}),t.jsx(ue,{variant:"determinate",value:(b==null?void 0:b.percentage)??100})]})]})})]}),t.jsxs(Y,{children:[t.jsx(ee,{title:"Últimos registros importados"}),t.jsxs(Z,{children:[t.jsxs(n,{display:"flex",gap:2,mb:2,alignItems:"center",flexWrap:"wrap",children:[t.jsx(me,{size:"small",label:"Buscar (ticket / cliente / unidad / asignado)",value:g,onChange:e=>N(e.target.value),sx:{minWidth:360}}),t.jsxs(he,{size:"small",sx:{minWidth:240},children:[t.jsx(pe,{id:"age-filter-label",children:"Creado"}),t.jsxs(xe,{labelId:"age-filter-label",label:"Creado",value:D,onChange:e=>L(e.target.value),children:[t.jsx(w,{value:"all",children:"Todos"}),t.jsx(w,{value:"1w",children:"Creado hace 1 semana"}),t.jsx(w,{value:"2w",children:"Creado hace 2 semanas"}),t.jsx(w,{value:"3w",children:"Creado hace 3 semanas"}),t.jsx(w,{value:"1m",children:"Creado hace 1 mes"}),t.jsx(w,{value:"gt1m",children:"Creado hace más de 1 mes"})]})]})]}),t.jsx(je,{rows:E,columns:se,getRowId:e=>(e==null?void 0:e.id)??`${e.ticket_number}-${e.opened_at}-${Math.random()}`,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,autoHeight:!0,onCellDoubleClick:$})]}),t.jsxs(fe,{open:A,onClose:()=>T(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(ge,{children:F}),t.jsx(Ce,{dividers:!0,children:t.jsx(v,{sx:{whiteSpace:"pre-wrap"},children:h})}),t.jsx(be,{children:t.jsx(q,{onClick:()=>T(!1),variant:"contained",children:"Cerrar"})})]})]})]})]})}export{st as default};
