import{j as e,r as s,a as re,q as E,$ as se}from"./app-BYlaDNnQ.js";import{D as ie,M as I,A as le}from"./AuthenticatedLayout-Ciu5tiwa.js";import{c as B,T as F}from"./Typography-Cz5b46_Z.js";import{d as D}from"./index-BFwf8Ka5.js";import{C as oe,T as b,F as y,I as k,a as q}from"./Close-vkWVTsEq.js";import{B as S}from"./Box-Dj2jFWQR.js";import{I as N}from"./IconButton-DHMSuMuk.js";import{F as M,S as z}from"./Stack-D44wqBzF.js";import{C as V,D as H,E as de,a as ce,S as ue,V as me}from"./ValidationErrorAlert-B7GSosPo.js";import{B as v}from"./Button-BDi1-Yqn.js";import{D as P}from"./Dialog-BkevDDps.js";import{D as Q,a as T,b as A}from"./DialogTitle-BBJkTvsX.js";import{F as he}from"./FormGroup-DqGVAQyp.js";import"./isMuiElement-DLpQt63o.js";import"./Logout-DCbHmxsU.js";import"./getThemeProps-B8kFXMoc.js";import"./Paper-ucf8npUG.js";import"./index-BmOyq_06.js";import"./Grow-DnenbNsV.js";import"./Portal-AG3BFHip.js";import"./Modal-BdzuD8Hn.js";import"./Slide-m2awDBZU.js";import"./useFormControl-pAwNMFrR.js";import"./useControlled-BJIFv_eh.js";import"./useThemeProps-CODjRCaF.js";import"./Tooltip-Cwqb10es.js";import"./Alert-Drt3-Y_N.js";const pe=B(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"})),xe=B(e.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}));function fe({open:g,onClose:p,question:n=null,subjectId:l}){const[c,u]=s.useState({subject_id:l,question:"",answer_a:"",answer_b:"",answer_c:"",answer_d:"",correct_answer:"",feedback_text:"",feedback_image:null,has_dynamic:!1});s.useEffect(()=>{l&&u(d=>({...d,subject_id:l}))},[l]),s.useEffect(()=>{u(n?{subject_id:n.subject_id||l||"",question:n.question||"",answer_a:n.answer_a||"",answer_b:n.answer_b||"",answer_c:n.answer_c||"",answer_d:n.answer_d||"",correct_answer:n.correct_answer||"",feedback_text:n.feedback_text||"",feedback_image:null,has_dynamic:n.has_dynamic||!1}:{subject_id:l||"",question:"",answer_a:"",answer_b:"",answer_c:"",answer_d:"",correct_answer:"",feedback_text:"",feedback_image:null,has_dynamic:!1})},[n,l]);const o=d=>{const{name:r,type:x,files:f,value:i,checked:C}=d.target,_=x==="file"?f[0]:x==="checkbox"?C:i;u(j=>({...j,[r]:_}))},m=d=>{d.preventDefault();const r={...c};n?D.Inertia.post(route("question.update",n.id),{...r,_method:"PUT"},{forceFormData:!0}):D.Inertia.post(route("question.store"),r,{forceFormData:!0}),p()};return e.jsx(ie,{anchor:"right",open:g,onClose:p,sx:{zIndex:d=>d.zIndex.drawer+1e3},children:e.jsxs(S,{sx:{width:400,p:3},role:"presentation",children:[e.jsxs(S,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(F,{variant:"h6",children:n?"Editar Pregunta":"Nueva Pregunta"}),e.jsx(N,{onClick:p,children:e.jsx(oe,{})})]}),e.jsxs(S,{component:"form",onSubmit:m,mt:2,children:[e.jsx(b,{label:"Pregunta",name:"question",fullWidth:!0,value:c.question,onChange:o,margin:"normal",required:!0}),e.jsx(b,{label:"Respuesta A",name:"answer_a",fullWidth:!0,value:c.answer_a,onChange:o,margin:"normal",required:!0}),e.jsx(b,{label:"Respuesta B",name:"answer_b",fullWidth:!0,value:c.answer_b,onChange:o,margin:"normal",required:!0}),e.jsx(b,{label:"Respuesta C",name:"answer_c",fullWidth:!0,value:c.answer_c,onChange:o,margin:"normal",required:!0}),e.jsx(b,{label:"Respuesta D",name:"answer_d",fullWidth:!0,value:c.answer_d,onChange:o,margin:"normal"}),e.jsxs(y,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(k,{id:"correct-answer-label",children:"Respuesta Correcta"}),e.jsxs(q,{labelId:"correct-answer-label",name:"correct_answer",value:c.correct_answer,label:"Respuesta Correcta",onChange:o,MenuProps:{container:document.body,disablePortal:!0},children:[e.jsx(I,{value:"A",children:"A"}),e.jsx(I,{value:"B",children:"B"}),e.jsx(I,{value:"C",children:"C"}),e.jsx(I,{value:"D",children:"D"})]})]}),e.jsx(b,{label:"Retroalimentación",name:"feedback_text",fullWidth:!0,multiline:!0,rows:3,value:c.feedback_text,onChange:o,margin:"normal"}),e.jsx("input",{type:"file",name:"feedback_image",onChange:o,style:{marginTop:16}}),e.jsx(M,{control:e.jsx(V,{checked:c.has_dynamic,onChange:o,name:"has_dynamic"}),label:"¿Contiene dinámica?",sx:{mt:2}}),e.jsx(v,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:2},children:n?"Actualizar":"Crear"})]})]})})}function ge({open:g,onClose:p,types:n,subject:l,onSave:c}){const[u,o]=s.useState(""),[m,d]=s.useState(""),r=n.find(t=>t.id===Number(u)),x=(r==null?void 0:r.levels)||[],f=x.find(t=>t.id===Number(m)),[i,C]=s.useState(!1),[_,j]=s.useState(""),[w,a]=s.useState(""),W=()=>{if(l!=null&&l.id&&u){const t=new FormData;t.append("subject_id",l.id),t.append("question_type_id",u),t.append("question_level_id",m),t.append("question_count",_),t.append("has_time_limit",i?"1":"0"),i&&t.append("time_limit",w),c(t),o(""),d(""),j(""),a(""),p()}};return e.jsxs(P,{open:g,onClose:p,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(Q,{children:["Crear cuestionario para: ",l==null?void 0:l.name]}),e.jsx(T,{children:e.jsxs(S,{sx:{mt:2},children:[e.jsxs(y,{fullWidth:!0,margin:"normal",children:[e.jsx(k,{id:"type-select-label",children:"Tipo de cuestionario"}),e.jsx(q,{labelId:"type-select-label",value:u,label:"Tipo de cuestionario",onChange:t=>{o(t.target.value),d("")},required:!0,children:n.map(t=>e.jsx(I,{value:t.id,children:t.name},t.id))})]}),e.jsxs(y,{fullWidth:!0,margin:"normal",disabled:!x.length,children:[e.jsx(k,{id:"level-select-label",children:"Nivel de complejidad"}),e.jsx(q,{labelId:"level-select-label",value:m,label:"Nivel de complejidad",onChange:t=>d(t.target.value),required:x.length>0,children:x.map(t=>e.jsxs(I,{value:t.id,children:[t.name," - ",t.description]},t.id))})]}),(f||r)&&e.jsxs(y,{fullWidth:!0,margin:"normal",children:[e.jsxs(F,{variant:"subtitle1",component:"p",children:["Preguntas disponibles sobre examen (",f?f.questions_count||0:(r==null?void 0:r.questions_count)||0,")"]}),e.jsx(b,{id:"count-question-required",label:"Número de preguntas para examen",type:"number",inputProps:{min:1,max:f?f.questions_count:(r==null?void 0:r.questions_count)||1},onChange:t=>j(t.target.value),required:!0})]}),u&&e.jsx(he,{children:e.jsx(M,{control:e.jsx(V,{checked:i,onChange:t=>C(t.target.checked)}),label:"Tiempo límite"})}),i&&e.jsxs(e.Fragment,{children:[console.log(u),e.jsx(y,{fullWidth:!0,margin:"normal",children:e.jsx(b,{id:"limit-time-required",label:"Tiempo límite (segundos por pregunta)",type:"number",onChange:t=>a(t.target.value),inputProps:{min:1}})})]})]})}),e.jsxs(A,{children:[e.jsx(v,{onClick:()=>{p(),o(""),m("")},children:"Cancelar"}),e.jsx(v,{variant:"contained",onClick:W,disabled:!u,children:"Crear"})]})]})}function je({open:g,onClose:p,types:n,onImport:l,handleExport:c}){const[u,o]=s.useState(""),[m,d]=s.useState(null),[r,x]=s.useState(""),[f,i]=s.useState(""),C=n.find(a=>a.id===Number(r)),_=(C==null?void 0:C.levels)||[],j=a=>{d(a.target.files[0])},w=()=>{if(m&&r){const a=new FormData;a.append("file",m),a.append("type_id",r),a.append("level_id",f),l(a),d(null),setTypetId(""),setLeveltId(""),p()}};return e.jsxs(P,{open:g,onClose:p,fullWidth:!0,maxWidth:"sm",children:[e.jsx(Q,{children:"Importar a banco de preguntas"}),e.jsx(T,{children:e.jsxs(S,{sx:{mt:2},children:[e.jsxs(y,{fullWidth:!0,margin:"normal",children:[e.jsx(k,{id:"type-select-label",children:"Tipo de cuestionario"}),e.jsx(q,{labelId:"type-select-label",value:r,label:"Tipo de cuestionario",onChange:a=>{x(a.target.value),i("")},required:!0,children:n.map(a=>e.jsx(I,{value:a.id,children:a.name},a.id))})]}),e.jsxs(y,{fullWidth:!0,margin:"normal",disabled:!_.length,children:[e.jsx(k,{id:"level-select-label",children:"Nivel de complejidad"}),e.jsx(q,{labelId:"level-select-label",value:f,label:"Nivel de complejidad",onChange:a=>i(a.target.value),required:!0,children:_.map(a=>e.jsxs(I,{value:a.id,children:[a.name," - ",a.description]},a.id))})]}),e.jsxs(v,{variant:"outlined",component:"label",fullWidth:!0,sx:{mt:2},children:["Seleccionar archivo Excel",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx, .xls",onChange:j})]}),m&&e.jsx(b,{label:"Archivo seleccionado",value:m.name,fullWidth:!0,disabled:!0,margin:"normal"})]})}),e.jsxs(A,{children:[e.jsx(v,{onClick:()=>{c(u),o(null)},children:"Exportar Concentrado"}),e.jsx(v,{onClick:()=>{p(),x(null),i(null)},children:"Cancelar"}),e.jsx(v,{variant:"contained",onClick:w,disabled:!m||!r,children:"Importar"})]})]})}function _e({open:g,onClose:p,subject:n,handleEditQuestion:l,handleDelete:c,handleExport:u}){const[o,m]=s.useState([]),[d,r]=s.useState(!0),x=async()=>{try{const i=await re.get(route("question.subject",n==null?void 0:n.id));m(i.data)}catch(i){console.error("Error fetching questions:",i)}finally{r(!1)}};s.useEffect(()=>{g&&(n!=null&&n.id)&&x()},[g,n==null?void 0:n.id]);const f=[{field:"question",headerName:"Pregunta",flex:1},{field:"correct_answer",headerName:"Correcta",width:120},{field:"has_dynamic",headerName:"Dinámica",width:120,renderCell:i=>e.jsx("span",{children:i.value?"Sí":"No"})},{field:"actions",headerName:"Acciones",width:120,sortable:!1,renderCell:i=>e.jsxs(z,{direction:"row",spacing:1,children:[e.jsx(N,{onClick:()=>l(i.row),color:"primary",children:e.jsx(de,{})}),e.jsx(N,{onClick:()=>c(i.row.id),color:"error",size:"small",children:e.jsx(ce,{})})]})}];return e.jsxs(P,{open:g,onClose:p,fullWidth:!0,maxWidth:"md",children:[e.jsxs(Q,{children:["Preguntas de la materia: ",n==null?void 0:n.name]}),e.jsx(T,{children:d?e.jsx(F,{children:"Cargando preguntas..."}):e.jsx(S,{sx:{height:400,width:"100%"},children:e.jsx(H,{rows:o,columns:f,pageSize:5,rowsPerPageOptions:[5],getRowId:i=>i.id})})}),e.jsx(A,{children:e.jsx(v,{onClick:p,children:"Cerrar"})})]})}function $e(){var L,R;const{errors:g,flash:p}=E().props,{questions:n,subjects:l,types:c}=E().props,[u,o]=s.useState(!1),[m,d]=s.useState(!1),[r,x]=s.useState(!1),[f,i]=s.useState(!1),[C,_]=s.useState(null),[j,w]=s.useState(null),a=((R=(L=E().props)==null?void 0:L.flash)==null?void 0:R.success)??null,[W,t]=s.useState(!!a),[G,O]=s.useState(!1);s.useEffect(()=>{a&&t(!0)},[a]),s.useEffect(()=>{Object.keys(g).length>0&&O(!0)},[g]);const $=h=>{w(h),x(!0)},U=h=>{_(h),o(!0)},J=h=>{w(h),d(!0)},K=()=>{o(!1),_(null),w(null)},X=()=>{x(!1),_(null),w(null)},Y=()=>{d(!1),_(null),w(null)},Z=()=>{i(!0)},ee=h=>{D.Inertia.get(route("question.export",h))},ne=[{field:"name",headerName:"Materia",flex:.5},{field:"questions_count",headerName:"Número de preguntas",flex:.5},{field:"actions",headerName:"Acciones",flex:.5,sortable:!0,renderCell:h=>e.jsxs(z,{direction:"row",spacing:1,children:[e.jsx(N,{onClick:()=>J(h.row),color:"primary",children:e.jsx(xe,{})}),e.jsx(N,{onClick:()=>$(h.row),color:"primary",children:e.jsx(pe,{})})]})}],te=h=>{confirm("¿Estás seguro de eliminar esta pregunta?")&&D.Inertia.delete(route("question.destroy",h))},ae=h=>{D.Inertia.post(route("question.test"),h,{forceFormData:!0})};return e.jsxs(le,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Cuestionarios"}),children:[e.jsx(se,{title:"Cuestionarios"}),e.jsx(ue,{open:W,onClose:()=>t(!1),message:a}),e.jsx(me,{open:G,onClose:()=>O(!1),errors:g}),e.jsxs(S,{p:4,children:[e.jsx(S,{display:"flex",justifyContent:"flex-end",mb:2,children:e.jsx(v,{variant:"contained",color:"primary",onClick:Z,children:"Importar Cuestionario"})}),e.jsx(S,{sx:{height:500,width:"100%"},children:e.jsx(H,{rows:l,columns:ne,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,autoHeight:!0})})]}),e.jsx(fe,{open:u,onClose:K,question:C,subjectId:j==null?void 0:j.id}),e.jsx(ge,{open:r,onClose:X,subject:j,types:c,onSave:ae}),e.jsx(_e,{open:m,onClose:Y,subject:j,handleEditQuestion:U,handleDelete:te}),e.jsx(je,{open:f,onClose:()=>i(!1),types:c,onImport:h=>{D.Inertia.post(route("question.import"),h,{forceFormData:!0})},handleExport:ee})]})}export{$e as default};
