import{r as a,j as e,a as de,u as Y,H as Te}from"./app-vMEhybGz.js";import{d as z}from"./index-Cp2kRUoV.js";import{V as ue}from"./VisibilityOff-CMpJueLX.js";import{I as Ne,A as Pe}from"./index-DXj4bLM3.js";import{E as me,D as xe}from"./Edit-BFSyyt5P.js";import{D as Z,A as ye}from"./AuthenticatedLayout-BvMg71qt.js";import{C as J}from"./Close-yzekcTXF.js";import{B as q,C as K,T as A}from"./Modal-CEDmwUrF.js";import{B as h}from"./Box-BKWdOuJm.js";import{I as P,A as oe}from"./Alert-DTEmJZo-.js";import{S as X,F as Le}from"./Stack-DWZHyoWU.js";import{F as O,I as V,S as Q,T as k,a as ce}from"./TextField-CWJJ3tbx.js";import{M as W,A as Ae,T as Re}from"./ErrorAlert-BtT46Saj.js";import{B as _}from"./Button-BH_P4w0r.js";import{D as B}from"./Dialog-BQl1CJd5.js";import{D as $,a as U}from"./DialogTitle-DlIOxz7_.js";import{F as ze}from"./FormGroup-B_X_uOpW.js";import{C as Oe,D as ee,a as Me}from"./DataGrid-CzTZphJN.js";import{D as G}from"./DialogActions-CJnfuP7r.js";import{T as M}from"./Tooltip-DUI6y57F.js";import{S as Qe,V as Be}from"./ValidationErrorAlert-aEtt3lqN.js";import{S as Ve}from"./index-C8edoBjR.js";import{L as $e}from"./LinearProgress-DiQVTD-a.js";import"./createSvgIcon-BmYiw_ua.js";import"./School-CiacmU3r.js";import"./MenuBook-CC1MHA_a.js";import"./Person-BEprolYZ.js";import"./Logout-7k1zeLkC.js";import"./isMuiElement-CE_7VB7y.js";import"./index-Dl0-U46O.js";import"./useFormControl-DrFhcK7J.js";import"./useControlled-BX8CzS8A.js";import"./useThemeProps-BMF9JAJv.js";import"./getThemeProps-HN35Jumh.js";import"./with-selector-ReOnLC-k.js";import"./TableCell-Bqo4lZWx.js";const H=g=>{if(typeof g!="string")return!1;const o=g.trim();return o?/^(https?:\/\/|s3:\/\/|data:image\/|\/[^\/].*\.(png|jpe?g|gif|webp|svg)(\?.*)?$)/i.test(o)||/^https?:\/\/.+\.(png|jpe?g|gif|webp|svg)(\?.*)?$/i.test(o):!1};function Ue({open:g,onClose:o,question:r=null}){const[u,m]=a.useState(!1),l=a.useMemo(()=>H(r==null?void 0:r.answer_a),[r]),f=a.useMemo(()=>H(r==null?void 0:r.answer_b),[r]),i=a.useMemo(()=>H(r==null?void 0:r.answer_c),[r]),b=a.useMemo(()=>H(r==null?void 0:r.answer_d),[r]),s=a.useMemo(()=>H(r==null?void 0:r.question_image),[r]),[n,t]=a.useState({question:"",question_image:null,answer_a:"",answer_b:"",answer_c:"",answer_d:"",correct_answer:"",feedback_text:"",feedback_image:null,has_dynamic:!1}),[c,j]=a.useState({question_image:null,answer_a_file:null,answer_b_file:null,answer_c_file:null,answer_d_file:null,feedback_image:null});a.useEffect(()=>{t({question:s?"":(r==null?void 0:r.question)||"",question_image:null,answer_a:(r==null?void 0:r.answer_a)??"",answer_b:(r==null?void 0:r.answer_b)??"",answer_c:(r==null?void 0:r.answer_c)??"",answer_d:(r==null?void 0:r.answer_d)??"",correct_answer:(r==null?void 0:r.correct_answer)||"",feedback_text:(r==null?void 0:r.feedback_text)||"",feedback_image:null,has_dynamic:!!(r!=null&&r.has_dynamic)||!1}),j({question_image:s&&(r==null?void 0:r.question_image)||null,answer_a:l&&(r==null?void 0:r.answer_a)||null,answer_b:f&&(r==null?void 0:r.answer_b)||null,answer_c:i&&(r==null?void 0:r.answer_c)||null,answer_d:b&&(r==null?void 0:r.answer_d)||null,feedback_image:null})},[r]);const S=C=>{const{name:w,type:T,files:E,value:y}=C.target;if(T==="file"){const d=(E==null?void 0:E[0])||null;if(t(N=>({...N,[w]:d})),d){const N=URL.createObjectURL(d);j(L=>({...L,[w]:N}))}else j(N=>({...N,[w]:null}))}else t(d=>({...d,[w]:y}))},I=C=>{C.preventDefault();const w={...n};console.log(w),z.Inertia.post(route("question.update",r.id),{...w,_method:"PUT"},{forceFormData:!0,preserveScroll:!0,onStart:()=>m(!0),onError:()=>m(!1),onSuccess:()=>{m(!1),o()},onFinish:()=>{}})},v=({label:C,valueName:w,fileName:T,existingUrl:E})=>{const y=c[T]||E;return e.jsxs(h,{mt:2,children:[e.jsxs(A,{variant:"subtitle2",sx:{mb:1},children:[C," (Imagen)"]}),y&&e.jsxs(h,{sx:{mb:1,border:"1px solid",borderColor:"divider",p:1,borderRadius:1},children:[e.jsx("img",{src:y,alt:`${C} actual`,style:{maxWidth:"100%",maxHeight:200,objectFit:"contain",display:"block",margin:"0 auto"}}),e.jsx(ce,{sx:{textAlign:"center"},children:"Vista previa"})]}),e.jsxs(_,{variant:"outlined",component:"label",fullWidth:!0,children:[y?"Reemplazar imagen":"Subir imagen",e.jsx("input",{type:"file",name:T,accept:"image/*",hidden:!0,onChange:S})]})]})},x=({label:C,name:w,required:T=!0})=>e.jsx(k,{label:C,name:w,fullWidth:!0,value:n[w]||"",onChange:S,margin:"normal",style:{marginTop:"10px"}}),D=(C,w,T,E)=>T?e.jsx(v,{label:C,valueName:w,fileName:`${w}_file`,existingUrl:E},w):e.jsx(x,{label:C,name:w},w);return e.jsxs(Z,{anchor:"right",open:g,onClose:o,sx:{zIndex:C=>C.zIndex.drawer+1e3},children:[e.jsx(q,{open:u,sx:{color:"#fff",zIndex:C=>C.zIndex.drawer+2e3},children:e.jsx(K,{color:"inherit"})}),e.jsxs(h,{sx:{width:440,p:3},role:"presentation",children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(A,{variant:"h6",children:r?"Editar Pregunta":"Nueva Pregunta"}),e.jsx(P,{onClick:o,children:e.jsx(J,{})})]}),e.jsxs(h,{component:"form",onSubmit:I,mt:2,children:[s?e.jsx(v,{label:"Pregunta",valueName:"question",fileName:"question_image",existingUrl:(r==null?void 0:r.question_image)||null}):e.jsx(x,{label:"Pregunta",name:"question"}),e.jsxs(X,{spacing:1,children:[D("Respuesta A","answer_a",l,l?r==null?void 0:r.answer_a:null),D("Respuesta B","answer_b",f,f?r==null?void 0:r.answer_b:null),D("Respuesta C","answer_c",i,i?r==null?void 0:r.answer_c:null),D("Respuesta D","answer_d",b,b?r==null?void 0:r.answer_d:null)]}),e.jsxs(O,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(V,{id:"correct-answer-label",children:"Respuesta Correcta"}),e.jsxs(Q,{labelId:"correct-answer-label",name:"correct_answer",value:n.correct_answer,label:"Respuesta Correcta",onChange:S,MenuProps:{container:document.body,disablePortal:!0},children:[e.jsx(W,{value:"A",children:"A"}),e.jsx(W,{value:"B",children:"B"}),e.jsx(W,{value:"C",children:"C"}),e.jsx(W,{value:"D",children:"D"})]})]}),e.jsx(k,{label:"Retroalimentación (texto)",name:"feedback_text",fullWidth:!0,multiline:!0,rows:3,value:n.feedback_text,onChange:S,margin:"normal"}),e.jsxs(h,{mt:1,children:[e.jsx(A,{variant:"subtitle2",sx:{mb:1},children:"Retroalimentación (imagen) — opcional"}),c.feedback_image&&e.jsxs(h,{sx:{mb:1,border:"1px solid",borderColor:"divider",p:1,borderRadius:1},children:[e.jsx("img",{src:c.feedback_image,alt:"Feedback preview",style:{maxWidth:"100%",maxHeight:160,objectFit:"contain",display:"block",margin:"0 auto"}}),e.jsx(ce,{sx:{textAlign:"center"},children:"Vista previa"})]}),e.jsxs(_,{variant:"outlined",component:"label",fullWidth:!0,children:[c.feedback_image?"Reemplazar imagen":"Subir imagen",e.jsx("input",{type:"file",name:"feedback_image",accept:"image/*",hidden:!0,onChange:S,style:{marginBottom:"10px"}})]})]}),e.jsx(_,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:3},disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(K,{size:20,sx:{mr:1}}),"Guardando..."]}):"Actualizar"})]})]})]})}function Ge({open:g,onClose:o,question:r=null}){const[u,m]=a.useState(!1),[l,f]=a.useState({question:"",option_a:"",option_b:"",option_c:"",answer:""});a.useEffect(()=>{f({question:r.question||"",option_a:r.option_a||"",option_b:r.option_b||"",option_c:r.option_c||"",answer:r.answer||""})},[r]);const i=s=>{const{name:n,type:t,files:c,value:j,checked:S}=s.target,I=t==="file"?c[0]:t==="checkbox"?S:j;f(v=>({...v,[n]:I}))},b=s=>{s.preventDefault();const n={...l};console.log(n),z.Inertia.post(route("question-multitask.update",r.id),{...n,_method:"PUT"},{forceFormData:!0,preserveScroll:!0,onStart:()=>m(!0),onError:()=>m(!1),onSuccess:()=>{m(!1),o()},onFinish:()=>{}})};return e.jsxs(Z,{anchor:"right",open:g,onClose:o,sx:{zIndex:s=>s.zIndex.drawer+1e3},children:[e.jsx(q,{open:u,sx:{color:"#fff",zIndex:s=>s.zIndex.drawer+2e3},children:e.jsx(K,{color:"inherit"})}),e.jsxs(h,{sx:{width:400,p:3},role:"presentation",children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(A,{variant:"h6",children:"Editar Pregunta"}),e.jsx(P,{onClick:o,children:e.jsx(J,{})})]}),e.jsxs(h,{component:"form",onSubmit:b,mt:2,children:[e.jsx(k,{label:"Pregunta",name:"question",fullWidth:!0,value:l.question,onChange:i,margin:"normal",required:!0}),e.jsx(k,{label:"Respuesta A",name:"option_a",fullWidth:!0,value:l.option_a,onChange:i,margin:"normal",required:!0}),e.jsx(k,{label:"Respuesta B",name:"option_b",fullWidth:!0,value:l.option_b,onChange:i,margin:"normal",required:!0}),e.jsx(k,{label:"Respuesta C",name:"option_c",fullWidth:!0,value:l.option_c,onChange:i,margin:"normal"}),e.jsxs(O,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(V,{id:"correct-answer-label",children:"Respuesta Correcta"}),(r==null?void 0:r.type)=="figure"?e.jsxs(Q,{labelId:"correct-answer-label",name:"answer",value:l.answer,label:"Respuesta Correcta",onChange:i,MenuProps:{container:document.body,disablePortal:!0},children:[e.jsx(W,{value:"x1",children:"x1"}),e.jsx(W,{value:"x2",children:"x2"}),e.jsx(W,{value:"x3",children:"x3"})]}):e.jsxs(Q,{labelId:"correct-answer-label",name:"answer",value:l.answer,label:"Respuesta Correcta",onChange:i,MenuProps:{container:document.body,disablePortal:!0},children:[e.jsx(W,{value:"Incorrecto",children:"Incorrecto"}),e.jsx(W,{value:"Correcto",children:"Correcto"})]})]}),e.jsx(_,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:3},disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(K,{size:20,sx:{mr:1}}),"Guardando..."]}):"Actualizar"})]})]})]})}function He({open:g,onClose:o,type:r,subjects:u,onSave:m}){const[l,f]=a.useState(""),[i,b]=a.useState(""),s=u.find(d=>d.id===Number(l)),n=(r==null?void 0:r.levels)||[],t=n.find(d=>d.id===Number(i)),[c,j]=a.useState(!1),[S,I]=a.useState(""),[v,x]=a.useState(""),D=(r==null?void 0:r.bypass_levels_and_questions)===1,[C,w]=a.useState(!1),[T,E]=a.useState(!1);a.useEffect(()=>{(async()=>{var N;if(l&&i)try{const L=await de.get(`/admin/question/check-existence/${l}/${i}/${r==null?void 0:r.id}`);((N=L.data)==null?void 0:N.exists.length)>0&&(console.log(L.data.exists),w(!0))}catch(L){console.error("Error al verificar test existente:",L)}})()},[l,i]);const y=()=>{if(r!=null&&r.id&&l){const d=new FormData;d.append("subject_id",l),d.append("question_type_id",r==null?void 0:r.id),d.append("question_level_id",i),d.append("question_count",S),d.append("has_time_limit",c?"1":"0"),d.append("reset",T),c&&d.append("time_limit",v),m(d),E(!1),f(""),b(""),I(""),x(""),o()}};return e.jsxs(e.Fragment,{children:[e.jsxs(B,{open:g,onClose:(d,N)=>{},fullWidth:!0,maxWidth:"xl",disableEscapeKeyDown:!0,children:[e.jsxs($,{children:["Tipo de cuestionario: ",r==null?void 0:r.name]}),e.jsx(U,{children:e.jsxs(h,{sx:{mt:2},children:[e.jsxs(O,{fullWidth:!0,margin:"normal",children:[e.jsx(V,{id:"type-select-label",children:"Materias"}),e.jsx(Q,{labelId:"type-select-label",value:l??"",label:"Materias",onChange:d=>{f(d.target.value),b("")},required:!0,children:u.map(d=>e.jsx(W,{value:d.id,children:d.name},d.id))})]}),e.jsxs(O,{fullWidth:!0,margin:"normal",disabled:n.length==0,children:[e.jsx(V,{id:"level-select-label",children:"Nivel de complejidad"}),e.jsx(Q,{labelId:"level-select-label",value:i??"",label:"Nivel de complejidad",onChange:d=>b(d.target.value),required:n.length>0,children:n.map(d=>e.jsxs(W,{value:d.id,children:[d.name," - ",d.description]},d.id))})]}),(t||D)&&e.jsxs(O,{fullWidth:!0,margin:"normal",children:[e.jsx(A,{variant:"subtitle1",component:"p",children:D?"Número de preguntas para el examen":`Preguntas disponibles sobre examen (${t?t.questions_count||0:(s==null?void 0:s.questions_count)||0})`}),e.jsx(k,{id:"count-question-required",label:"Número de preguntas para examen",type:"number",inputProps:{min:1,...D?{}:{max:t?t.questions_count:(s==null?void 0:s.questions_count)||1}},onChange:d=>I(d.target.value),required:!0})]}),D||l&&e.jsx(ze,{children:e.jsx(Le,{control:e.jsx(Oe,{checked:c,onChange:d=>j(d.target.checked)}),label:"Tiempo límite"})}),c&&e.jsx(e.Fragment,{children:e.jsx(O,{fullWidth:!0,margin:"normal",children:e.jsx(k,{id:"limit-time-required",label:"Tiempo límite (segundos por pregunta)",type:"number",onChange:d=>x(d.target.value),inputProps:{min:1}})})})]})}),e.jsxs(G,{children:[e.jsx(_,{onClick:()=>{o(),f(""),i("")},children:"Cancelar"}),e.jsx(_,{variant:"contained",onClick:y,disabled:!l,children:"Crear"})]})]}),e.jsxs(B,{open:C,onClose:()=>w(!1),children:[e.jsx($,{children:"Existen preguntas asignadas a esta materia"}),e.jsx(U,{children:"Al continuar se reasignarán las nuevas preguntas a la materia con el nivel asignado. ¿Quieres continuar?"}),e.jsxs(G,{children:[e.jsx(_,{onClick:()=>w(!1),children:"Cancelar"}),e.jsx(_,{onClick:()=>{E(!0),w(!1)},autoFocus:!0,children:"Continuar"})]})]})]})}function Ke({open:g,onClose:o,types:r,onImport:u,handleExport:m}){const[l,f]=a.useState(""),[i,b]=a.useState(null),[s,n]=a.useState(""),[t,c]=a.useState(""),j=r.find(x=>x.id===Number(s)),S=(j==null?void 0:j.levels)||[],I=x=>{b(x.target.files[0])},v=()=>{if(i&&s){const x=new FormData;x.append("file",i),x.append("type_id",s),x.append("level_id",t),u(x),b(null),setTypetId(""),setLeveltId(""),o()}};return e.jsxs(B,{open:g,onClose:o,fullWidth:!0,maxWidth:"sm",children:[e.jsx($,{children:"Importar a banco de preguntas"}),e.jsx(U,{children:e.jsxs(h,{sx:{mt:2},children:[e.jsxs(O,{fullWidth:!0,margin:"normal",children:[e.jsx(V,{id:"type-select-label",children:"Tipo de cuestionario"}),e.jsx(Q,{labelId:"type-select-label",value:s,label:"Tipo de cuestionario",onChange:x=>{n(x.target.value),c("")},required:!0,children:r.filter(x=>x.is_automatic===0).map(x=>e.jsx(W,{value:x.id,children:x.name},x.id))})]}),e.jsxs(O,{fullWidth:!0,margin:"normal",disabled:!S.length,children:[e.jsx(V,{id:"level-select-label",children:"Nivel de complejidad"}),e.jsx(Q,{labelId:"level-select-label",value:t,label:"Nivel de complejidad",onChange:x=>c(x.target.value),required:!0,children:S.map(x=>e.jsxs(W,{value:x.id,children:[x.name," - ",x.description]},x.id))})]}),e.jsxs(_,{variant:"outlined",component:"label",fullWidth:!0,sx:{mt:2},children:["Seleccionar archivo Excel",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx, .xls",onChange:I})]}),i&&e.jsx(k,{label:"Archivo seleccionado",value:i.name,fullWidth:!0,disabled:!0,margin:"normal"})]})}),e.jsxs(G,{children:[e.jsx(_,{disabled:!s||!t,onClick:()=>{m(s,t),f(null)},children:"Exportar Concentrado"}),e.jsx(_,{onClick:()=>{o(),n(null),c(null)},children:"Cancelar"}),e.jsx(_,{variant:"contained",onClick:v,disabled:!i||!s,children:"Importar"})]})]})}function Je({open:g,onClose:o,type:r,handleSowQuestions:u}){const m=[{field:"name",headerName:"Nivel",flex:.1},{field:"description",headerName:"Descripción",flex:.5},{field:"actions",headerName:"Acciones",flex:.2,sortable:!1,renderCell:l=>e.jsx(X,{direction:"row",spacing:1,children:e.jsx(M,{title:"Ver preguntas",arrow:!0,children:e.jsx(P,{onClick:()=>u(l.row),color:"primary",children:e.jsx(ue,{})})})})}];return e.jsxs(B,{open:g,onClose:o,fullWidth:!0,maxWidth:"md",children:[e.jsxs($,{children:["Niveles de: ",r==null?void 0:r.name]}),e.jsx(U,{children:e.jsx(h,{sx:{height:400,width:"100%"},children:e.jsx(ee,{rows:r==null?void 0:r.levels,columns:m,pageSize:5,rowsPerPageOptions:[5],getRowId:l=>l.id})})}),e.jsx(G,{children:e.jsx(_,{onClick:o,children:"Cerrar"})})]})}const Xe=a.forwardRef(function(o,r){return e.jsx(Ve,{direction:"up",ref:r,...o})});function Ye({open:g,close:o,questions:r,type:u,handleEditQuestion:m,handleDeleteQuestion:l}){const f=n=>{if(typeof n!="string")return!1;const t=n.trim().toLowerCase();return t.startsWith("data:image/")||/\.(png|jpe?g|gif|svg|webp)$/.test(t)},i=n=>n?n.startsWith("http")||n.startsWith("data:")?n:`undefined/${n}`:"",b=[{field:"name",headerName:"Memorama",flex:.9,sortable:!0,renderCell:n=>{const t=Ne[n.row.name];return t?e.jsx(t,{sx:{fontSize:40,color:"#555",mx:"auto"}}):e.jsx("span",{children:n.row.name})}}],s=[{field:"question",headerName:"Pregunta",flex:.9,sortable:!0,renderCell:n=>n.row.question?e.jsx(M,{title:n.row.question,arrow:!0,children:e.jsx("span",{style:{cursor:"default"},children:n.row.question})}):e.jsx(h,{component:"img",src:n.row.question_image,alt:"Pregunta",sx:{width:300,height:"auto",objectFit:"contain"}})},{field:"answer_a",headerName:"Opción A",flex:.9,sortable:!0,renderCell:({row:n})=>{if(n.question){const c=n.answer_a??n.option_a??"";return e.jsx("span",{children:c||"-"})}const t=n.answer_a??n.option_a??"";return t?f(t)?e.jsx(h,{sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(h,{component:"img",src:i(t),alt:"Respuesta A",sx:{width:25,height:25,objectFit:"contain"}})}):e.jsx("span",{children:t}):e.jsx("span",{children:"-"})}},{field:"answer_b",headerName:"Opción B",flex:.9,sortable:!0,renderCell:({row:n})=>{if(n.question){const c=n.answer_b??n.option_b??"";return e.jsx("span",{children:c||"-"})}const t=n.answer_b??n.option_b??"";return t?f(t)?e.jsx(h,{sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(h,{component:"img",src:i(t),alt:"Respuesta B",sx:{width:25,height:25,objectFit:"contain"}})}):e.jsx("span",{children:t}):e.jsx("span",{children:"-"})}},{field:"answer_c",headerName:"Opción C",flex:.9,sortable:!0,renderCell:({row:n})=>{if(n.question){const c=n.answer_c??n.option_c??"";return e.jsx("span",{children:c||"-"})}const t=n.answer_c??n.option_c??"";return t?f(t)?e.jsx(h,{sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(h,{component:"img",src:i(t),alt:"Respuesta C",sx:{width:25,height:25,objectFit:"contain"}})}):e.jsx("span",{children:t}):e.jsx("span",{children:"-"})}},{field:"answer_d",headerName:"Opción D",flex:.9,sortable:!0,renderCell:({row:n})=>{if(n.question){const c=n.answer_d??n.option_d??"";return e.jsx("span",{children:c||"-"})}const t=n.answer_d??n.option_d??"";return t?f(t)?e.jsx(h,{sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(h,{component:"img",src:i(t),alt:"Respuesta D",sx:{width:25,height:25,objectFit:"contain"}})}):e.jsx("span",{children:t}):e.jsx("span",{children:"-"})}},{field:"correct_answer",headerName:"Respuesta",flex:.9,sortable:!0,renderCell:n=>e.jsx("span",{children:n.row.correct_answer??n.row.answer})},{field:"actions",headerName:"Acciones",flex:.5,sortable:!0,renderCell:n=>e.jsxs(X,{direction:"row",spacing:1,children:[e.jsx(M,{title:"Editar",arrow:!0,children:e.jsx(P,{onClick:()=>m(n.row,u==null?void 0:u.name),color:"primary",children:e.jsx(me,{})})}),e.jsx(M,{title:"Eliminar",arrow:!0,children:e.jsx(P,{onClick:()=>l(n.row.id),color:"error",children:e.jsx(xe,{})})})]})}];return e.jsx(a.Fragment,{children:e.jsxs(B,{fullScreen:!0,open:g,onClose:o,slots:{transition:Xe},children:[e.jsx(Ae,{sx:{position:"relative"},children:e.jsxs(Re,{children:[e.jsx(P,{edge:"start",color:"inherit",onClick:o,"aria-label":"close",children:e.jsx(J,{})}),e.jsx(A,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:u==null?void 0:u.name}),e.jsx(_,{autoFocus:!0,color:"inherit",onClick:o,children:"CERRAR"})]})}),e.jsx(h,{p:4,children:e.jsx(h,{sx:{height:500,width:"100%"},children:e.jsx(ee,{rows:r,columns:(u==null?void 0:u.bypass_levels_and_questions)!=1?s:b,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,autoHeight:!0})})})]})})}function Ze({open:g,onClose:o,levels:r=[],onChange:u}){const[m,l]=a.useState([]);a.useEffect(()=>{l(r||[])},[r]);const f=(s,n,t)=>{const c=[...m];c[s][n]=t,l(c),u(c)},i=()=>{const s={id:`new-${Date.now()}`,name:"",description:"",question_type_id:1},n=[...m,s];l(n),u(n)},b=s=>{if(m.length<=1)return;const n=[...m];n.splice(s,1),l(n),u(n)};return e.jsxs(B,{open:g,onClose:o,fullWidth:!0,maxWidth:"sm",slotProps:{backdrop:{sx:{zIndex:s=>s.zIndex.drawer+2001}}},PaperProps:{sx:{zIndex:s=>s.zIndex.drawer+2002}},children:[e.jsx($,{children:"Editar Niveles"}),e.jsxs(U,{dividers:!0,children:[m.length===0&&e.jsx(A,{variant:"body2",sx:{mt:1},children:"No hay niveles registrados."}),m.map((s,n)=>e.jsxs(h,{sx:{mt:2},children:[n!==0&&e.jsx(Me,{sx:{my:2}}),e.jsxs(h,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(A,{variant:"subtitle1",children:"NIVEL"}),e.jsx(P,{color:"error",onClick:()=>b(n),disabled:m.length<=1,children:e.jsx(xe,{})})]}),e.jsx(k,{label:"Nombre",fullWidth:!0,value:s.name,onChange:t=>f(n,"name",t.target.value),sx:{mb:1}}),e.jsx(k,{label:"Descripción",fullWidth:!0,value:s.description,onChange:t=>f(n,"description",t.target.value)})]},s.id||n)),e.jsx(_,{variant:"outlined",onClick:i,sx:{mt:3},children:"Agregar nivel"})]}),e.jsx(G,{children:e.jsx(_,{onClick:o,children:"Cerrar"})})]})}function qe({open:g,onClose:o,type:r=null,onSubmit:u}){const[m,l]=a.useState(!1),[f,i]=a.useState([]),[b,s]=a.useState({type_id:"",name:"",description:""});a.useEffect(()=>{r?(s({type_id:r.id||"",name:r.name||"",description:r.description||""}),i(r.levels||[])):(s({type_id:(r==null?void 0:r.id)||"",name:"",description:""}),i([]))},[r]);const n=c=>{const{name:j,value:S}=c.target;s(I=>({...I,[j]:S}))},t=c=>{c.preventDefault();const j={...b,levels:f};u(j),o()};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{anchor:"right",open:g,onClose:o,sx:{zIndex:c=>c.zIndex.drawer+10},children:e.jsxs(h,{sx:{width:400,p:3},role:"presentation",children:[e.jsxs(h,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(A,{variant:"h6",children:r?"Editar tipo de cuestionario":"Nuevo tipo de cuestionario"}),e.jsx(P,{onClick:o,children:e.jsx(J,{})})]}),e.jsxs(h,{component:"form",onSubmit:t,mt:2,children:[e.jsx(k,{label:"Nombre",name:"name",fullWidth:!0,value:b.name,onChange:n,required:!0}),e.jsx(k,{label:"Descripción",name:"description",fullWidth:!0,value:b.description,onChange:n,margin:"normal",required:!0}),e.jsx(_,{type:"button",variant:"text",color:"secondary",fullWidth:!0,sx:{mt:2},onClick:()=>l(!0),children:"Editar niveles"}),e.jsx(_,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:2},children:r?"Actualizar":"Crear"})]})]})}),e.jsx(Ze,{open:m,onClose:()=>l(!1),levels:f,onChange:i})]})}function er({open:g,onClose:o,onImport:r,loading:u=!1}){const[m,l]=a.useState(null),[f,i]=a.useState(""),b=()=>{l(null),i("")},s=c=>{var v;const j=(v=c.target.files)==null?void 0:v[0];if(!j){l(null),i("");return}if(!(j.type==="application/pdf"||j.name.toLowerCase().endsWith(".pdf"))){l(null),i("Solo se permite un archivo PDF (.pdf).");return}const I=25;if(j.size>I*1024*1024){l(null),i(`El archivo excede ${I} MB.`);return}i(""),l(j)},n=()=>{if(!m)return;const c=new FormData;c.append("file",m),r==null||r(c),b(),o==null||o()},t=()=>{b(),o==null||o()};return e.jsxs(B,{open:g,onClose:t,fullWidth:!0,maxWidth:"sm",children:[e.jsx($,{children:"Importar documento PDF"}),e.jsx(U,{children:e.jsxs(h,{sx:{mt:1,display:"grid",gap:2},children:[e.jsxs(oe,{severity:"info",children:["Selecciona un archivo en formato ",e.jsx("strong",{children:"PDF"}),". Tamaño máximo sugerido: 25 MB."]}),e.jsxs(_,{variant:"outlined",component:"label",disabled:u,children:["Seleccionar PDF",e.jsx("input",{type:"file",hidden:!0,accept:"application/pdf,.pdf",onChange:s})]}),m&&e.jsx(k,{label:"Archivo seleccionado",value:m.name,fullWidth:!0,disabled:!0}),f&&e.jsx(oe,{severity:"error",children:f}),u&&e.jsx($e,{})]})}),e.jsxs(G,{children:[e.jsx(_,{onClick:t,disabled:u,children:"Cancelar"}),e.jsx(_,{variant:"contained",onClick:n,disabled:!m||!!f||u,children:"Importar"})]})]})}function Rr(){var le,ie;const{errors:g,flash:o}=Y().props,{subjects:r,types:u}=Y().props,[m,l]=a.useState(!1),[f,i]=a.useState(!1),[b,s]=a.useState(!1),[n,t]=a.useState(!1),[c,j]=a.useState(null),[S,I]=a.useState(null),[v,x]=a.useState(null),D=((ie=(le=Y().props)==null?void 0:le.flash)==null?void 0:ie.success)??null,[C,w]=a.useState(!!D),[T,E]=a.useState(!1),[y,d]=a.useState([]),[N,L]=a.useState(!1),[he,re]=a.useState(!1),[pe,ne]=a.useState(null),[te,F]=a.useState(!1),[fe,se]=a.useState(!1);a.useEffect(()=>{D&&w(!0)},[D]),a.useEffect(()=>{Object.keys(g).length>0&&E(!0)},[g]);const je=p=>{x(p),s(!0)},ge=(p,R)=>{j(p),l(!0),R=="MULTITASKING"?ne("MULTITASKING"):ne("SINGLE")},be=p=>{x(p),i(!0)},ae=()=>{l(!1),j(null),I(null)},we=()=>{s(!1),j(null),I(null)},_e=()=>{i(!1),j(null),I(null)},ve=()=>{t(!0)},Ce=()=>{se(!0)},Ie=(p,R)=>{F(!0),z.Inertia.get(route("question.export",{typeId:p,levelId:R}),{},{onFinish:()=>F(!1),onError:()=>F(!1)})},Se=p=>{x(p),re(!0)},De=[{field:"name",headerName:"Tipo de cuestionario",flex:.5},{field:"description",headerName:"Descripción",flex:.5},{field:"actions",headerName:"Acciones",flex:.5,sortable:!0,renderCell:p=>e.jsxs(X,{direction:"row",spacing:1,children:[e.jsx(M,{title:"Niveles",arrow:!0,children:e.jsx(P,{onClick:()=>be(p.row),color:"primary",children:e.jsx(ue,{})})}),e.jsx(M,{title:"Asignar a Materias",arrow:!0,children:e.jsx(P,{onClick:()=>je(p.row),color:"primary",children:e.jsx(Pe,{})})}),e.jsx(M,{title:"Editar tipo",arrow:!0,children:e.jsx(P,{onClick:()=>Se(p.row),color:"primary",children:e.jsx(me,{})})})]})}],Fe=p=>{confirm("¿Estás seguro de eliminar esta pregunta?")&&z.Inertia.delete(route("question.destroy",p),{preserveScroll:!0,onStart:()=>{F(!0)},onError:()=>{F(!1)},onSuccess:()=>{F(!1)}})},ke=p=>{F(!0),z.Inertia.post(route("question.test"),p,{forceFormData:!0,onFinish:()=>{console.log("termino de guardar"),F(!1)}})},Ee=async p=>{try{F(!0);const R=await de.get(route("question.show",{typeId:v==null?void 0:v.id,levelId:p==null?void 0:p.id}));R.data.questions&&(d(R.data.questions),L(!0),F(!1))}catch(R){console.error("Error al obtener preguntas:",R)}},We=p=>{z.Inertia.put(route("type.update",p.type_id),p)};return e.jsxs(ye,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Cuestionarios"}),children:[e.jsx(Te,{title:"Cuestionarios"}),e.jsx(Qe,{open:C,onClose:()=>w(!1),message:D}),e.jsx(Be,{open:T,onClose:()=>E(!1),errors:g}),e.jsxs(h,{p:4,children:[e.jsxs(h,{display:"flex",justifyContent:"flex-end",mb:2,children:[e.jsx(_,{variant:"contained",color:"primary",onClick:ve,children:"Importar Cuestionario"}),e.jsx(_,{sx:{marginLeft:"10px"},variant:"contained",color:"primary",onClick:Ce,children:"Importar instrucciones"})]}),e.jsx(h,{sx:{height:500,width:"100%"},children:e.jsx(ee,{rows:u,columns:De,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,autoHeight:!0})})]}),e.jsx(q,{open:te,sx:{color:"#fff",zIndex:p=>p.zIndex.modal+1},children:e.jsx(K,{color:"inherit"})}),pe=="MULTITASKING"?e.jsx(Ge,{open:m,onClose:ae,question:c}):e.jsx(Ue,{open:m,onClose:ae,question:c}),e.jsx(He,{open:b,onClose:we,subjects:r,type:v,onSave:ke}),e.jsx(Je,{open:f,onClose:_e,type:v,handleSowQuestions:Ee}),e.jsx(Ye,{open:N,close:()=>L(!1),questions:y,type:v,handleEditQuestion:ge,handleDeleteQuestion:Fe}),e.jsx(Ke,{open:n,onClose:()=>t(!1),types:u,onImport:p=>{F(!0),z.Inertia.post(route("question.import"),p,{forceFormData:!0,onFinish:()=>{console.log("termino de guardar"),F(!1)}})},handleExport:Ie}),e.jsx(er,{open:fe,onClose:()=>se(!1),loading:te,onImport:p=>{F(!0),z.Inertia.post(route("question.instructions"),p,{forceFormData:!0,onFinish:()=>{F(!1)}})}}),e.jsx(qe,{open:he,onClose:()=>re(!1),type:v,onSubmit:We})]})}export{Rr as default};
