import{r as t,j as n,a as C}from"./app-DXaiALKI.js";function B({onFinish:x,durationSec:l=30,autoSendResult:j=!1}){const[a,m]=t.useState(120),[I,b]=t.useState([]),[o,S]=t.useState(0),[p,E]=t.useState(0),[c,W]=t.useState(0),[w,M]=t.useState(0),[s,H]=t.useState(!0),y=t.useRef(Date.now()),i=t.useRef(null),u=t.useRef(null),d=t.useRef(null),v=()=>m(e=>Math.max(0,e-20)),k=()=>m(e=>Math.min(240,e+20));t.useEffect(()=>{const e=r=>{s&&(r.key==="ArrowLeft"?v():r.key==="ArrowRight"&&k())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[s]),t.useEffect(()=>{if(s)return i.current=setInterval(()=>{b(e=>[...e,{x:Math.random()*290,y:0,id:Date.now()}]),W(e=>e+1)},1500),()=>clearInterval(i.current)},[s]),t.useEffect(()=>{if(s)return u.current=setInterval(()=>{b(e=>e.map(r=>({...r,y:r.y+5})).filter(r=>{const f=r.y>270&&r.x>=a&&r.x<=a+60;f&&S(h=>h+1);const R=r.y>300;return!f&&R&&E(h=>h+1),!f&&!R}))},50),()=>clearInterval(u.current)},[s,a]),t.useEffect(()=>{if(s)return y.current=Date.now(),d.current=setInterval(()=>{const e=Math.floor((Date.now()-y.current)/1e3);M(e),e>=l&&g()},250),()=>clearInterval(d.current)},[s,l]);const z=async()=>{const e=w;try{await C.post(route("student.game.store"),{score:o,missed:p,total:c,duration:e}),console.log("Resultados enviados al backend.")}catch(r){console.error("Error al guardar los resultados:",r)}},g=async()=>{if(!s)return;H(!1),clearInterval(i.current),clearInterval(u.current),clearInterval(d.current);const e=Math.round(o/Math.max(1,c)*100);j&&await z(),typeof x=="function"&&x(e)};return n.jsxs("div",{children:[n.jsxs("div",{style:{width:300,height:300,background:"black",position:"relative",overflow:"hidden",borderRadius:8},children:[I.map(e=>n.jsx("div",{style:{position:"absolute",width:10,height:10,borderRadius:"50%",backgroundColor:"white",top:e.y,left:e.x}},e.id)),n.jsx("div",{style:{position:"absolute",bottom:0,left:a,width:60,height:20,backgroundColor:"white",borderRadius:"0 0 10px 10px"}})]}),n.jsxs("div",{className:"mt-3 flex justify-center gap-3",children:[n.jsx("button",{onClick:v,className:"px-3 py-2 bg-gray-700 text-white rounded shadow",disabled:!s,children:"◀ Izq"}),n.jsx("button",{onClick:k,className:"px-3 py-2 bg-gray-700 text-white rounded shadow",disabled:!s,children:"Der ▶"}),n.jsx("button",{onClick:g,className:"px-3 py-2 bg-blue-600 text-white rounded shadow",disabled:!s,children:"Terminar"})]}),n.jsxs("div",{className:"mt-3 text-sm text-gray-700 text-center",children:[n.jsxs("p",{children:["Tiempo: ",w,"s / ",l,"s"]}),n.jsxs("p",{children:["Atrapadas: ",o,"  |  Falladas: ",p,"  |  Total: ",c]}),n.jsxs("p",{children:["Porcentaje actual: ",Math.round(o/Math.max(1,c)*100),"%"]})]})]})}export{B as default};
