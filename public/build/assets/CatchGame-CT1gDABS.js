import{r as t,j as n,a as C}from"./app-iwa7Ko-Z.js";function B({onFinish:h,durationSec:x=300,autoSendResult:g=!1}){const[a,m]=t.useState(120),[R,b]=t.useState([]),[o,j]=t.useState(0),[p,S]=t.useState(0),[c,I]=t.useState(0),[E,W]=t.useState(0),[r,M]=t.useState(!0),w=t.useRef(Date.now()),l=t.useRef(null),i=t.useRef(null),u=t.useRef(null),v=()=>m(e=>Math.max(0,e-20)),y=()=>m(e=>Math.min(240,e+20));t.useEffect(()=>{const e=s=>{r&&(s.key==="ArrowLeft"?v():s.key==="ArrowRight"&&y())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r]),t.useEffect(()=>{if(r)return l.current=setInterval(()=>{b(e=>[...e,{x:Math.random()*290,y:0,id:Date.now()}]),I(e=>e+1)},1500),()=>clearInterval(l.current)},[r]),t.useEffect(()=>{if(r)return i.current=setInterval(()=>{b(e=>e.map(s=>({...s,y:s.y+5})).filter(s=>{const d=s.y>270&&s.x>=a&&s.x<=a+60;d&&j(f=>f+1);const k=s.y>300;return!d&&k&&S(f=>f+1),!d&&!k}))},50),()=>clearInterval(i.current)},[r,a]),t.useEffect(()=>{if(r)return w.current=Date.now(),u.current=setInterval(()=>{const e=Math.floor((Date.now()-w.current)/1e3);W(e),e>=x&&z()},250),()=>clearInterval(u.current)},[r,x]);const H=async()=>{const e=E;try{await C.post(route("student.game.store"),{score:o,missed:p,total:c,duration:e}),console.log("Resultados enviados al backend.")}catch(s){console.error("Error al guardar los resultados:",s)}},z=async()=>{if(!r)return;M(!1),clearInterval(l.current),clearInterval(i.current),clearInterval(u.current);const e=Math.round(o/Math.max(1,c)*100);g&&await H(),typeof h=="function"&&h(e)};return n.jsxs("div",{children:[n.jsxs("div",{style:{width:300,height:300,background:"black",position:"relative",overflow:"hidden",borderRadius:8},children:[R.map(e=>n.jsx("div",{style:{position:"absolute",width:10,height:10,borderRadius:"50%",backgroundColor:"white",top:e.y,left:e.x}},e.id)),n.jsx("div",{style:{position:"absolute",bottom:0,left:a,width:60,height:20,backgroundColor:"white",borderRadius:"0 0 10px 10px"}})]}),n.jsxs("div",{className:"mt-3 flex justify-center gap-3",children:[n.jsx("button",{onClick:v,className:"px-3 py-2 bg-gray-700 text-white rounded shadow",disabled:!r,children:"◀ Izq"}),n.jsx("button",{onClick:y,className:"px-3 py-2 bg-gray-700 text-white rounded shadow",disabled:!r,children:"Der ▶"})]}),n.jsxs("div",{className:"mt-3 text-sm text-gray-700 text-center",children:[n.jsxs("p",{children:["Atrapadas: ",o,"  |  Falladas: ",p,"  |  Total: ",c]}),n.jsxs("p",{children:["Porcentaje actual: ",Math.round(o/Math.max(1,c)*100),"%"]})]})]})}export{B as default};
