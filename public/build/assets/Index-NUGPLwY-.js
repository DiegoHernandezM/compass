import{r as i,j as t,q,v as Z,$ as ee}from"./app-CB1Wn47M.js";import{A as te}from"./AuthenticatedLayout-D7eXAAww.js";import{B as r}from"./Box-CIvngmiI.js";import{S as G}from"./Stack-D-nuBd2W.js";import{A as J}from"./Alert-rix-SGyC.js";import{C as K}from"./Card-C81HJ_KB.js";import{g as se,a as re,b as ae,T as w,s as I,c as oe,t as Q}from"./Typography-BBQVAT80.js";import{u as j}from"./Modal-BDyfTLlR.js";import{C as V}from"./CardContent-D9tDgvDb.js";import{B as X}from"./Button-DYDiXRFL.js";import{L as ie}from"./LinearProgress-D5kWFDmr.js";import{T as le,F as ne,I as de,S as ce}from"./TextField-D168frMY.js";import{M as b}from"./Toolbar-B5itTDCO.js";import{D as me}from"./Dialog-CCMh28DC.js";import{D as ue,a as pe,b as he}from"./DialogTitle-Bj7pWyjk.js";import{D as xe}from"./DataGrid-WYmslZEd.js";import"./School--jwHZVZ5.js";import"./createSvgIcon-BvPnfHpE.js";import"./Logout-AErxafY4.js";import"./isMuiElement-Dz_oPvCq.js";import"./Fade-D_kNIubh.js";import"./index-DbaILNzX.js";import"./getThemeProps-CiFHx4lv.js";import"./IconButton-NxM1byrw.js";import"./index-DHVOxdtz.js";import"./Slide-6deYovZb.js";import"./debounce-Be36O1Ab.js";import"./useFormControl-DBPSG6Il.js";import"./useThemeProps-BtwdknJG.js";function fe(l){return re("MuiCardHeader",l)}const A=se("MuiCardHeader",["root","avatar","action","content","title","subheader"]),ge=l=>{const{classes:a}=l;return oe({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},fe,a)},Ce=I("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(l,a)=>[{[`& .${A.title}`]:a.title},{[`& .${A.subheader}`]:a.subheader},a.root]})({display:"flex",alignItems:"center",padding:16}),je=I("div",{name:"MuiCardHeader",slot:"Avatar"})({display:"flex",flex:"0 0 auto",marginRight:16}),be=I("div",{name:"MuiCardHeader",slot:"Action"})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),we=I("div",{name:"MuiCardHeader",slot:"Content"})({flex:"1 1 auto",[`.${Q.root}:where(& .${A.title})`]:{display:"block"},[`.${Q.root}:where(& .${A.subheader})`]:{display:"block"}}),Y=i.forwardRef(function(a,p){const T=ae({props:a,name:"MuiCardHeader"}),{action:v,avatar:n,component:S="div",disableTypography:h=!1,subheader:W,subheaderTypographyProps:y,title:M,titleTypographyProps:P,slots:R={},slotProps:D={},...$}=T,d={...T,component:S,disableTypography:h},m=ge(d),u={slots:R,slotProps:{title:P,subheader:y,...D}};let x=M;const[H,_]=j("title",{className:m.title,elementType:w,externalForwardedProps:u,ownerState:d,additionalProps:{variant:n?"body2":"h5",component:"span"}});x!=null&&x.type!==w&&!h&&(x=t.jsx(H,{..._,children:x}));let f=W;const[L,N]=j("subheader",{className:m.subheader,elementType:w,externalForwardedProps:u,ownerState:d,additionalProps:{variant:n?"body2":"body1",color:"textSecondary",component:"span"}});f!=null&&f.type!==w&&!h&&(f=t.jsx(L,{...N,children:f}));const[g,B]=j("root",{ref:p,className:m.root,elementType:Ce,externalForwardedProps:{...u,...$,component:S},ownerState:d}),[U,E]=j("avatar",{className:m.avatar,elementType:je,externalForwardedProps:u,ownerState:d}),[z,k]=j("content",{className:m.content,elementType:we,externalForwardedProps:u,ownerState:d}),[O,F]=j("action",{className:m.action,elementType:be,externalForwardedProps:u,ownerState:d});return t.jsxs(g,{...B,children:[n&&t.jsx(U,{...E,children:n}),t.jsxs(z,{...k,children:[x,f]}),v&&t.jsx(O,{...F,children:v})]})});function Xe(){var F;const{props:l}=q(),a=q().props.latest??[],p=((F=l==null?void 0:l.flash)==null?void 0:F.success)??null,[T,v]=i.useState(!!p),[n,S]=i.useState(!1),[h,W]=i.useState(""),[y,M]=i.useState("all"),P=e=>e?new Date(e):null,[R,D]=i.useState(!1),[$,d]=i.useState("Detalle"),[m,u]=i.useState(""),x=e=>{var c,C;if(console.log(e),e.field!=="description")return;const s=((c=e==null?void 0:e.row)==null?void 0:c.description)??"";s&&(d(`Ticket ${((C=e==null?void 0:e.row)==null?void 0:C.ticket_number)??""}`),u(s),D(!0))},{data:H,setData:_,post:f,reset:L,errors:N,progress:g}=Z({file:null});i.useEffect(()=>{p&&v(!0)},[p]);const B=e=>{_("file",e.target.files[0]??null)},U=e=>{e.preventDefault(),H.file&&(S(!0),f(route("personal-reports.import"),{forceFormData:!0,onFinish:()=>{S(!1),L("file")}}))},E=(e,s)=>{if(console.log("entrox"),s==="all")return!0;if(!e)return!1;const c=new Date,C=24*60*60*1e3,o=Math.floor((c-e)/C);switch(s){case"1w":return o<=7;case"2w":return o>7&&o<=14;case"3w":return o>14&&o<=21;case"1m":return o>21&&o<=31;case"gt1m":return o>31;default:return!0}},z=i.useMemo(()=>{const e=h.trim().toLowerCase();return(a??[]).filter(s=>{const c=P(s==null?void 0:s.opened_at),C=E(c,y),o=!e||String((s==null?void 0:s.ticket_number)??"").toLowerCase().includes(e)||String((s==null?void 0:s.client)??"").toLowerCase().includes(e)||String((s==null?void 0:s.unit)??"").toLowerCase().includes(e)||String((s==null?void 0:s.assignee)??"").toLowerCase().includes(e);return C&&o})},[a,h,y]),k=e=>{if(!e)return"";const s=P(e);return s?s.toLocaleString():""},O=[{field:"ticket_number",headerName:"Ticket",flex:.8,minWidth:120,renderCell:e=>{var s;return t.jsx(r,{children:((s=e.row)==null?void 0:s.ticket_number)??""})}},{field:"opened_at",headerName:"F. de alta",flex:1,minWidth:160,renderCell:e=>{var s;return t.jsx(r,{children:k((s=e.row)==null?void 0:s.opened_at)})}},{field:"closed_at",headerName:"F. de cierre",flex:1,minWidth:160,renderCell:e=>{var s;return t.jsx(r,{children:k((s=e.row)==null?void 0:s.closed_at)})}},{field:"status",headerName:"Estado",flex:.8,minWidth:120,renderCell:e=>{var s;return t.jsx(r,{children:((s=e.row)==null?void 0:s.status)??""})}},{field:"assignee",headerName:"Asignado",flex:1.2,minWidth:160,renderCell:e=>{var s;return t.jsx(r,{children:((s=e.row)==null?void 0:s.assignee)??""})}},{field:"client",headerName:"Cliente",flex:1,minWidth:140,renderCell:e=>{var s;return t.jsx(r,{children:((s=e.row)==null?void 0:s.client)??""})}},{field:"unit",headerName:"Unidad",flex:1,minWidth:140,renderCell:e=>{var s;return t.jsx(r,{children:((s=e.row)==null?void 0:s.unit)??""})}},{field:"contact",headerName:"Contacto",flex:1,minWidth:160,renderCell:e=>{var s;return t.jsx(r,{children:((s=e.row)==null?void 0:s.contact)??""})}},{field:"description",headerName:"Descripción",flex:1.6,minWidth:220,renderCell:e=>{var s,c;return t.jsx(r,{sx:{width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:(s=e.row)!=null&&s.description?"zoom-in":"default"},title:"Doble clic para ver completo",children:((c=e.row)==null?void 0:c.description)??""})}}];return t.jsxs(te,{header:t.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Importar reporte de tickets"}),children:[t.jsx(ee,{title:"Personal Reports"}),t.jsxs(r,{p:3,children:[t.jsxs(G,{spacing:2,sx:{mb:2},children:[T&&t.jsx(J,{severity:"success",onClose:()=>v(!1),children:p}),N.file&&t.jsx(J,{severity:"error",children:N.file})]}),t.jsxs(K,{sx:{mb:3},children:[t.jsx(Y,{title:"Subir archivo Excel",subheader:"Formatos permitidos: .xlsx, .xls, .csv"}),t.jsx(V,{children:t.jsxs("form",{onSubmit:U,encType:"multipart/form-data",children:[t.jsxs(G,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",children:[t.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:B,disabled:n}),t.jsx(X,{type:"submit",variant:"contained",disabled:!H.file||n,children:n?"Importando...":"Importar"})]}),(g||n)&&t.jsxs(r,{sx:{mt:2},children:[t.jsx(w,{variant:"caption",children:"Progreso"}),t.jsx(ie,{variant:"determinate",value:(g==null?void 0:g.percentage)??100})]})]})})]}),t.jsxs(K,{children:[t.jsx(Y,{title:"Últimos registros importados"}),t.jsxs(V,{children:[t.jsxs(r,{display:"flex",gap:2,mb:2,alignItems:"center",flexWrap:"wrap",children:[t.jsx(le,{size:"small",label:"Buscar (ticket / cliente / unidad / asignado)",value:h,onChange:e=>W(e.target.value),sx:{minWidth:360}}),t.jsxs(ne,{size:"small",sx:{minWidth:240},children:[t.jsx(de,{id:"age-filter-label",children:"Creado"}),t.jsxs(ce,{labelId:"age-filter-label",label:"Creado",value:y,onChange:e=>M(e.target.value),children:[t.jsx(b,{value:"all",children:"Todos"}),t.jsx(b,{value:"1w",children:"Creado hace 1 semana"}),t.jsx(b,{value:"2w",children:"Creado hace 2 semanas"}),t.jsx(b,{value:"3w",children:"Creado hace 3 semanas"}),t.jsx(b,{value:"1m",children:"Creado hace 1 mes"}),t.jsx(b,{value:"gt1m",children:"Creado hace más de 1 mes"})]})]})]}),t.jsx(xe,{rows:z,columns:O,getRowId:e=>(e==null?void 0:e.id)??`${e.ticket_number}-${e.opened_at}-${Math.random()}`,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,autoHeight:!0,onCellDoubleClick:x})]}),t.jsxs(me,{open:R,onClose:()=>D(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(ue,{children:$}),t.jsx(pe,{dividers:!0,children:t.jsx(w,{sx:{whiteSpace:"pre-wrap"},children:m})}),t.jsx(he,{children:t.jsx(X,{onClick:()=>D(!1),variant:"contained",children:"Cerrar"})})]})]})]})]})}export{Xe as default};
