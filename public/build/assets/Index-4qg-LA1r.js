import{r as i,j as e,q as w,$ as A}from"./app-DU9iJ9lJ.js";import{D as B,A as M}from"./AuthenticatedLayout-LfLXVdcq.js";import{E as G,D as W}from"./Edit-DTxJ6tBr.js";import{d as b}from"./index-UlY1COHY.js";import{C as R}from"./Close-Cg_7frKN.js";import{u as V,T as $}from"./Typography-BtCANJAc.js";import{B as p}from"./Box-DBi_kvVn.js";import{I as C}from"./IconButton-By2cUc4o.js";import{T as s,I as q,a as H}from"./TextField-DLuZsqEs.js";import{M as S}from"./Toolbar-CcaEszc5.js";import{B as D}from"./Button-C1dAGLTF.js";import{S as U,V as J,D as K,T as v}from"./ValidationErrorAlert-HBIE92XJ.js";import{S as Q}from"./Stack-5xg6UJK9.js";import"./School-DJKoDHfb.js";import"./Logout-CDCPCQPy.js";import"./isMuiElement-CuW62KB6.js";import"./Modal-BrTFE178.js";import"./index-C0d5k8nT.js";import"./debounce-Be36O1Ab.js";import"./getThemeProps-BK4ydgtj.js";import"./index-CSQFHPNi.js";import"./useFormControl-CWQn12GJ.js";import"./useThemeProps-CgRAnLKM.js";import"./Alert-83JDCWvT.js";function X({open:x,onClose:g,student:t=null}){const j=new Date().toISOString().split("T")[0],f=V(),[o,h]=i.useState({name:"",email:"",password:"",birthdate:"",gender:"",phone:"",address:"",zip_code:"",city:"",country:"",school:"",expires_at:""});i.useEffect(()=>{var l,n,m,c;h(t?{name:((l=t.user)==null?void 0:l.name)||"",email:((n=t.user)==null?void 0:n.email)||"",password:"",birthdate:t.birthdate||"",gender:(t==null?void 0:t.gender)||"",phone:t.phone||"",address:t.address||"",zip_code:t.zip_code||"",city:t.city||"",country:t.country||"",school:t.school||"",expires_at:((c=(m=t.user)==null?void 0:m.paypal_user)==null?void 0:c.expires_at.substring(0,10))||""}:{name:"",email:"",password:"",birthdate:"",phone:"",address:"",zip_code:"",city:"",country:"",school:"",expires_at:""})},[t]);const a=l=>{const{name:n,value:m}=l.target;h(c=>({...c,[n]:m}))},y=l=>{l.preventDefault();const n={...o,role:"student"};t?b.Inertia.post(route("students.update",t.id),{...n,_method:"PUT"}):(console.log(n),b.Inertia.post(route("students.store"),n)),g()};return e.jsx(B,{anchor:"right",open:x,onClose:g,sx:{zIndex:f.zIndex.drawer+1},children:e.jsxs(p,{sx:{width:400,p:3},role:"presentation",children:[e.jsxs(p,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx($,{variant:"h6",children:t?"Editar Estudiante":"Nuevo Estudiante"}),e.jsx(C,{onClick:g,children:e.jsx(R,{})})]}),e.jsxs(p,{component:"form",onSubmit:y,mt:2,children:[e.jsx(s,{fullWidth:!0,label:"Nombre",name:"name",value:o.name,onChange:a,margin:"normal"}),e.jsx(s,{fullWidth:!0,label:"Correo electrónico",name:"email",type:"email",value:o.email,onChange:a,margin:"normal"}),e.jsx(s,{fullWidth:!0,label:"Contraseña",name:"password",type:"password",value:o.password,onChange:a,margin:"normal",helperText:t?"Deja en blanco si no deseas cambiar la contraseña":""}),e.jsx(s,{fullWidth:!0,label:"Fecha de nacimiento",name:"birthdate",type:"date",value:o.birthdate,onChange:a,margin:"normal",InputLabelProps:{shrink:!0},inputProps:{max:j}}),e.jsx(q,{id:"gender-label",children:"Género"}),e.jsxs(H,{fullWidth:!0,name:"gender",value:o.gender||"",label:"Género",onChange:a,children:[e.jsx(S,{value:"Masculino",children:"Masculino"}),e.jsx(S,{value:"Femenino",children:"Femenino"}),e.jsx(S,{value:"Otro",children:"Otro"})]}),e.jsx(s,{fullWidth:!0,label:"Teléfono",name:"phone",value:o.phone,onChange:a,margin:"normal"}),e.jsx(s,{fullWidth:!0,label:"Dirección",name:"address",value:o.address,onChange:a,margin:"normal"}),e.jsx(s,{fullWidth:!0,label:"CP",name:"zip_code",value:o.zip_code,onChange:a,margin:"normal"}),e.jsx(s,{fullWidth:!0,label:"Ciudad",name:"city",value:o.city,onChange:a,margin:"normal"}),e.jsx(s,{fullWidth:!0,label:"Pais",name:"country",value:o.country,onChange:a,margin:"normal"}),e.jsx(s,{fullWidth:!0,label:"Escuela",name:"school",value:o.school,onChange:a,margin:"normal"}),e.jsx(s,{fullWidth:!0,label:"Fecha de expiración",name:"expires_at",type:"date",value:o.expires_at,onChange:a,margin:"normal",InputLabelProps:{shrink:!0},inputProps:{min:j}}),e.jsx(D,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:2},children:t?"Actualizar":"Crear"})]})]})})}function we(){var E,_;const{errors:x,flash:g}=w().props,{students:t}=w().props,[j,f]=i.useState(!1),[o,h]=i.useState(null),a=((_=(E=w().props)==null?void 0:E.flash)==null?void 0:_.success)??null,[y,l]=i.useState(!!a),[n,m]=i.useState(!1),[c,N]=i.useState("");i.useEffect(()=>{a&&l(!0)},[a]),i.useEffect(()=>{Object.keys(x).length>0&&m(!0)},[x]);const z=r=>{h(r),f(!0)},k=()=>{h(null),f(!0)},O=r=>{confirm("¿Estás seguro de eliminar este estudiante?")&&b.Inertia.delete(route("students.destroy",r))},P=r=>{confirm("¿Estás seguro de recuperar este estudiante?")&&b.Inertia.put(route("students.restore",r))},F=t.filter(r=>{var d,u;return r.name.toLowerCase().includes(c.toLowerCase())||((u=(d=r.user)==null?void 0:d.email)==null?void 0:u.toLowerCase().includes(c.toLowerCase()))}),L=[{field:"name",headerName:"Nombre",flex:1},{field:"user_email",headerName:"Correo",flex:1.5,renderCell:r=>{var d,u;return((u=(d=r==null?void 0:r.row)==null?void 0:d.user)==null?void 0:u.email)||""}},{field:"gender",headerName:"Género",flex:1},{field:"phone",headerName:"Teléfono",flex:1},{field:"city",headerName:"Ciudad",flex:1},{field:"school",headerName:"Escuela",flex:1},{field:"user_expires_at",headerName:"Fecha Expiración",flex:1,renderCell:r=>{var u,I,T;const d=(T=(I=(u=r==null?void 0:r.row)==null?void 0:u.user)==null?void 0:I.paypal_user)==null?void 0:T.expires_at;return d?d.substring(0,10):""}},{field:"actions",headerName:"Acciones",width:120,sortable:!1,renderCell:r=>e.jsxs(Q,{direction:"row",spacing:1,children:[e.jsx(v,{title:"Editar",children:e.jsx(C,{onClick:()=>z(r.row),color:"primary",children:e.jsx(G,{})})}),r.row.deleted_at?e.jsx(v,{title:"Recuperar",children:e.jsx(C,{onClick:()=>P(r.row.id),color:"success",children:e.jsx(W,{})})}):e.jsx(v,{title:"Eliminar",children:e.jsx(C,{onClick:()=>O(r.row.id),color:"error",children:e.jsx(W,{})})})]})}];return e.jsxs(M,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Estudiantes"}),children:[e.jsx(A,{title:"Estudiantes"}),e.jsx(U,{open:y,onClose:()=>l(!1),message:a}),e.jsx(J,{open:n,onClose:()=>m(!1),errors:x}),e.jsx(p,{p:4,children:e.jsxs(p,{sx:{height:600,width:"100%"},children:[e.jsxs(p,{display:"flex",justifyContent:"space-between",mb:2,children:[e.jsx(s,{label:"Buscar por nombre o correo",variant:"outlined",size:"small",value:c,onChange:r=>N(r.target.value),sx:{width:300}}),e.jsx(D,{variant:"contained",color:"primary",onClick:k,children:"Crear nuevo estudiante"})]}),e.jsx(K,{rows:F,columns:L,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,getRowId:r=>r.id,autoHeight:!0})]})}),e.jsx(X,{open:j,onClose:()=>f(!1),student:o})]})}export{we as default};
