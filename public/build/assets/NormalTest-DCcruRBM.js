import{r as a,j as t}from"./app-BqWlvYXa.js";import{d as te}from"./index-CVHOTQJQ.js";import{D as se}from"./Dialog-ugX8HYZ3.js";import{D as re,a as ne,b as oe}from"./DialogTitle-DhoVBOoA.js";import{a as ie,g as ae,b as le,s as ce,i as de,c as ue,T as p,r as fe,u as me}from"./Typography-KjnR0wxH.js";import{B as k}from"./Button-B6_tUdkC.js";import{S as xe}from"./Slide-B7yoBshC.js";import{u as q}from"./index-CUdHpl8X.js";import{C as pe}from"./Card-CeR8cu3-.js";import{C as ge}from"./CardContent-Dmz4biAL.js";import{L as E}from"./LinearProgress-CVlH1iMS.js";import{B as S}from"./Box-BUJooizW.js";import{P as he,F as _e}from"./Fade-C2LyS97k.js";import{R as we,a as Ce}from"./RadioGroup-Cm41hHHI.js";import{F as be,S as je}from"./Stack-TDRU_GPF.js";import"./Modal-DSVhJoGT.js";import"./debounce-Be36O1Ab.js";import"./getThemeProps-VTvsTMSr.js";import"./index-BltL7mRL.js";import"./createSvgIcon-CwdkiJb4.js";import"./useFormControl-Btw4PGPb.js";import"./FormGroup-Cura7wL1.js";import"./useThemeProps-CT_TUxfz.js";function Se(s){return ie("MuiDialogContentText",s)}ae("MuiDialogContentText",["root"]);const ke=s=>{const{classes:l}=s,c=ue({root:["root"]},Se,l);return{...l,...c}},ve=ce(p,{shouldForwardProp:s=>fe(s)||s==="classes",name:"MuiDialogContentText",slot:"Root"})({}),ye=a.forwardRef(function(l,u){const c=le({props:l,name:"MuiDialogContentText"}),{children:T,className:i,...d}=c,f=ke(d);return t.jsx(ve,{component:"p",variant:"body1",color:"textSecondary",ref:u,ownerState:d,className:de(f.root,i),...c,classes:f})}),De=a.forwardRef(function(l,u){return t.jsx(xe,{direction:"up",ref:u,...l})});function Fe({open:s,close:l,message:u,image:c}){return t.jsx(a.Fragment,{children:t.jsxs(se,{open:s,slots:{transition:De},keepMounted:!0,onClose:l,"aria-describedby":"alert-dialog-slide-description",PaperProps:{sx:{borderRadius:4}},children:[t.jsx(re,{children:"Explicación"}),t.jsx(ne,{children:t.jsxs(ye,{id:"alert-dialog-slide-description",children:[u,c&&t.jsx("div",{style:{display:"flex",justifyContent:"center",margin:"20px 0"},children:t.jsx("img",{src:c,alt:"feedback image",style:{height:300,width:"auto"}})})]})}),t.jsx(oe,{children:t.jsx(k,{onClick:l,children:"Cerrar"})})]})})}function Qe({test:s,subject:l}){const u=me(),c=q(u.breakpoints.up("md")),T=q(u.breakpoints.down("sm")),[i,d]=a.useState(0),[f,v]=a.useState({}),n=s.test_questions[i],[g,h]=a.useState(null),[B,_]=a.useState(null),[y,w]=a.useState(!1),[C,I]=a.useState(!1),[M,D]=a.useState(null),[L,P]=a.useState(null),[O,A]=a.useState(!1),F=a.useRef(new Set),U=a.useRef(new Set),x=e=>(e==null?void 0:e.is_correct)!==null||!!(e!=null&&e.user_answer),N=e=>{const r={};return e.forEach(o=>{o.user_answer&&(r[o.id]=String(o.user_answer).toLowerCase())}),r},H=e=>{const r=e.findIndex(o=>!x(o));return r===-1?0:r},b=(e,r)=>{for(let o=r+1;o<e.length;o++)if(!x(e[o]))return o;return null},m=n?x(n)||U.current.has(n.id):!1;a.useEffect(()=>{var e;(e=s==null?void 0:s.test_questions)!=null&&e.length&&(v(N(s.test_questions)),d(H(s.test_questions)))},[s==null?void 0:s.id]),a.useEffect(()=>{if(!y||C)return;const e=setTimeout(()=>{X()},2500);return()=>clearTimeout(e)},[y,C]),a.useEffect(()=>{if(!n)return;if(x(n)){D(null),P(null);return}const e=(n==null?void 0:n.limit_time)??null;if(D(e),P(e),!e)return;const r=setInterval(()=>{D(o=>o===null?o:o<=1?(clearInterval(r),R(null,!0),0):o-1)},1e3);return()=>clearInterval(r)},[n]);const W=e=>{m||v(r=>({...r,[n.id]:e.target.value.toLowerCase()}))},R=(e="",r=!1)=>{if(m)return;const o=(e||"").toLowerCase(),$=o.toUpperCase(),j=!r&&$===n.correct_answer;U.current.add(n.id),v(ee=>({...ee,[n.id]:r?"__timeout__":o})),r?w(!1):(h(j?"correct":"incorrect"),j||_(n.correct_answer),!j&&(n.feedback_text||n.feedback_image)&&(I(!0),A(!0)),w(!0)),z({test_id:s==null?void 0:s.id,subject_id:(l==null?void 0:l.id)??null,current_question:n,is_correct:r?0:j?1:0,user_answer:r?null:$}),r||setTimeout(()=>w(!1),5e3)},z=e=>{var o;const r=`${e.test_id}:${(o=e.current_question)==null?void 0:o.question_id}`;F.current.has(r)||(F.current.add(r),te.Inertia.post(route("answer.save"),e,{preserveScroll:!0,onError:()=>F.current.delete(r)}))},G=()=>{if(m){const r=b(s.test_questions,i);r!==null?d(r):i<s.test_questions.length-1&&d(i+1);return}const e=f[n.id];e&&e!=="__timeout__"&&(R(e),setTimeout(()=>{h(null),_(null)},3e3))},J=()=>{i>0&&d(i-1)},V=()=>{const e=f[n.id];e&&e!=="__timeout__"&&R(e)},K=s.test_questions.filter(e=>x(e)).length/s.test_questions.length*100,X=()=>{const e=b(s.test_questions,i);e!==null?d(e):i<s.test_questions.length-1&&d(i+1),h(null),_(null),w(!1)},Y=()=>{I(!1),A(!1);const e=b(s.test_questions,i);e!==null?d(e):i<s.test_questions.length-1&&d(i+1)},Z=e=>{if(typeof e!="string")return!1;const r=e.trim();return!!(/^data:image\//i.test(r)||/^https?:\/\/.+\.(png|jpe?g|gif|svg|webp)(\?.*)?$/i.test(r)||/^[\w.\-\/]+?\.(png|jpe?g|gif|svg|webp)$/i.test(r))},Q=(f[n.id]==="__timeout__"?"":f[n.id]||(n==null?void 0:n.user_answer)||"").toString().toLowerCase();return t.jsxs(t.Fragment,{children:[t.jsx(pe,{sx:{mb:c?2:1,mt:c?2:1,mx:c?"auto":1,width:c?"60%":"100%",borderRadius:3,boxShadow:3,backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e0e0e0"},children:t.jsxs(ge,{sx:{backgroundColor:`${l.color}80`,borderTopLeftRadius:"12px",borderTopRightRadius:"12px"},children:[t.jsx(p,{variant:"h6",gutterBottom:!0,children:l.name}),t.jsx(E,{variant:"determinate",value:K})]})}),t.jsx(S,{sx:{mt:4,mb:2,px:1,display:"flex",alignItems:"flex-start",justifyContent:"center",minHeight:"calc(100vh - 220px)"},children:t.jsxs(he,{elevation:3,sx:{width:"100%",maxWidth:c?600:"95%",p:3,borderRadius:3,boxShadow:3,backgroundColor:"rgba(255,255,255,0.95)",border:"1px solid #e0e0e0"},children:[L&&t.jsx(E,{variant:"determinate",value:M/L*100,sx:{mt:2,height:10,borderRadius:5}}),t.jsxs(p,{variant:"subtitle1",gutterBottom:!0,children:["Pregunta ",i+1," de ",s.test_questions.length]}),n.type==="image"?t.jsx(S,{component:"img",src:`${n.question_text}`,alt:"Pregunta",sx:{width:"100%",maxWidth:350,maxHeight:350,height:"auto",display:"block",mx:"auto",mb:4}}):t.jsx(p,{variant:"h6",gutterBottom:!0,children:n.question_text}),t.jsx(we,{value:Q,onChange:m?void 0:W,children:Object.entries(JSON.parse(n.options)).filter(([e,r])=>r!=null&&r!=="").map(([e,r])=>{const o=String(r).trim();return t.jsx(be,{value:e,control:t.jsx(Ce,{disabled:m}),disabled:m,sx:{mb:2,...m?{opacity:.8}:{}},label:Z(o)?t.jsx(S,{component:"img",src:o,alt:`Opción ${e.toUpperCase()}`,sx:{width:70,height:70,objectFit:"contain",border:"1px solid #ccc",p:1}}):`${e.toUpperCase()}: ${o}`},e)})}),t.jsxs(je,{direction:"row",justifyContent:"space-between",mt:3,children:[t.jsx(k,{variant:"outlined",onClick:J,disabled:i===0,children:"Anterior"}),i<s.test_questions.length-1?t.jsx(k,{variant:"contained",onClick:G,children:"Siguiente"}):t.jsx(k,{variant:"contained",color:"success",onClick:V,children:"Finalizar"})]}),t.jsx(_e,{in:y,timeout:{enter:300,exit:1e3},onExited:()=>{if(h(null),_(null),C||O)return;const e=b(s.test_questions,i);e!==null?d(e):i<s.test_questions.length-1&&d(i+1)},children:t.jsxs(S,{sx:{mt:2,p:2,borderRadius:2,backgroundColor:g==="correct"?"#dcfce7":"#fee2e2",color:g==="correct"?"#15803d":"#b91c1c",display:"flex",alignItems:"center",gap:2},children:[t.jsx("img",{src:g==="correct"?"/assets/correct.gif":"/assets/incorrect.gif",alt:"feedback gif",style:{height:70}}),t.jsx(p,{variant:"h6",children:g==="correct"?"¡Muy bien! Respuesta correcta.":`Incorrecto. La respuesta correcta era: ${B}`})]})})]})}),t.jsx(Fe,{open:C,close:Y,message:n==null?void 0:n.feedback_text,image:n==null?void 0:n.feedback_image})]})}export{Qe as default};
