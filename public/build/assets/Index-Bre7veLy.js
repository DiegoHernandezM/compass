import{r as i,j as t,q as O,v as Y,$ as Z}from"./app-dIF5oOkC.js";import{A as ee}from"./AuthenticatedLayout-Cqfhmjf1.js";import{B as a}from"./Box-Dm8QCMCJ.js";import{S as q}from"./Stack-CBTC9-Aj.js";import{A as G}from"./Alert-B57x1Ou1.js";import{C as J}from"./Card-BUDPb4pN.js";import{g as te,a as se,b as re,T as w,s as I,c as ae,t as K}from"./Typography-Cwnm3did.js";import{u as j}from"./Modal-C7wy9Tuw.js";import{C as Q}from"./CardContent-DDnz83fl.js";import{B as V}from"./Button-BXDar6yt.js";import{L as oe}from"./LinearProgress-D30oR1Pk.js";import{T as ie,F as le,I as ne,S as de}from"./TextField-B6J7-CQo.js";import{M as b}from"./Toolbar-BQ-zFWfO.js";import{D as ce}from"./Dialog-B9a49U7l.js";import{D as me,a as ue,b as pe}from"./DialogTitle-Dn65HOUQ.js";import{D as he}from"./DataGrid-BGxbdawo.js";import"./School-qMk4RwXT.js";import"./createSvgIcon-CpIgIJu0.js";import"./Logout-D1vKcOlp.js";import"./isMuiElement-cdcwAWjy.js";import"./Fade-mgIuAe8C.js";import"./index-C52-5yLG.js";import"./getThemeProps--ixpBrZk.js";import"./IconButton-Dju1OIWb.js";import"./index-73LGcBaD.js";import"./Slide-6klx0PXl.js";import"./debounce-Be36O1Ab.js";import"./useFormControl-SrnJYW5x.js";import"./useThemeProps-Dw8_SRzY.js";function xe(l){return se("MuiCardHeader",l)}const F=te("MuiCardHeader",["root","avatar","action","content","title","subheader"]),fe=l=>{const{classes:r}=l;return ae({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},xe,r)},ge=I("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(l,r)=>[{[`& .${F.title}`]:r.title},{[`& .${F.subheader}`]:r.subheader},r.root]})({display:"flex",alignItems:"center",padding:16}),Ce=I("div",{name:"MuiCardHeader",slot:"Avatar"})({display:"flex",flex:"0 0 auto",marginRight:16}),je=I("div",{name:"MuiCardHeader",slot:"Action"})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),be=I("div",{name:"MuiCardHeader",slot:"Content"})({flex:"1 1 auto",[`.${K.root}:where(& .${F.title})`]:{display:"block"},[`.${K.root}:where(& .${F.subheader})`]:{display:"block"}}),X=i.forwardRef(function(r,p){const T=re({props:r,name:"MuiCardHeader"}),{action:v,avatar:n,component:S="div",disableTypography:h=!1,subheader:W,subheaderTypographyProps:y,title:M,titleTypographyProps:P,slots:R={},slotProps:D={},...$}=T,d={...T,component:S,disableTypography:h},m=fe(d),u={slots:R,slotProps:{title:P,subheader:y,...D}};let x=M;const[A,_]=j("title",{className:m.title,elementType:w,externalForwardedProps:u,ownerState:d,additionalProps:{variant:n?"body2":"h5",component:"span"}});x!=null&&x.type!==w&&!h&&(x=t.jsx(A,{..._,children:x}));let f=W;const[L,H]=j("subheader",{className:m.subheader,elementType:w,externalForwardedProps:u,ownerState:d,additionalProps:{variant:n?"body2":"body1",color:"textSecondary",component:"span"}});f!=null&&f.type!==w&&!h&&(f=t.jsx(L,{...H,children:f}));const[g,B]=j("root",{ref:p,className:m.root,elementType:ge,externalForwardedProps:{...u,...$,component:S},ownerState:d}),[U,E]=j("avatar",{className:m.avatar,elementType:Ce,externalForwardedProps:u,ownerState:d}),[N,z]=j("content",{className:m.content,elementType:be,externalForwardedProps:u,ownerState:d}),[k,e]=j("action",{className:m.action,elementType:je,externalForwardedProps:u,ownerState:d});return t.jsxs(g,{...B,children:[n&&t.jsx(U,{...E,children:n}),t.jsxs(N,{...z,children:[x,f]}),v&&t.jsx(k,{...e,children:v})]})});function Ve(){var k;const{props:l}=O(),r=O().props.latest??[],p=((k=l==null?void 0:l.flash)==null?void 0:k.success)??null,[T,v]=i.useState(!!p),[n,S]=i.useState(!1),[h,W]=i.useState(""),[y,M]=i.useState("all"),P=e=>e?new Date(e):null,[R,D]=i.useState(!1),[$,d]=i.useState("Detalle"),[m,u]=i.useState(""),x=e=>{var c,C;if(console.log(e),e.field!=="description")return;const s=((c=e==null?void 0:e.row)==null?void 0:c.description)??"";s&&(d(`Ticket ${((C=e==null?void 0:e.row)==null?void 0:C.ticket_number)??""}`),u(s),D(!0))},{data:A,setData:_,post:f,reset:L,errors:H,progress:g}=Y({file:null});i.useEffect(()=>{p&&v(!0)},[p]);const B=e=>{_("file",e.target.files[0]??null)},U=e=>{e.preventDefault(),A.file&&(S(!0),f(route("personal-reports.import"),{forceFormData:!0,onFinish:()=>{S(!1),L("file")}}))},E=(e,s)=>{if(s==="all")return!0;if(!e)return!1;const c=new Date,C=24*60*60*1e3,o=Math.floor((c-e)/C);switch(s){case"1w":return o<=7;case"2w":return o>7&&o<=14;case"3w":return o>14&&o<=21;case"1m":return o>21&&o<=31;case"gt1m":return o>31;default:return!0}};i.useMemo(()=>{const e=h.trim().toLowerCase();return(r??[]).filter(s=>{const c=P(s==null?void 0:s.opened_at),C=E(c,y),o=!e||String((s==null?void 0:s.ticket_number)??"").toLowerCase().includes(e)||String((s==null?void 0:s.client)??"").toLowerCase().includes(e)||String((s==null?void 0:s.unit)??"").toLowerCase().includes(e)||String((s==null?void 0:s.assignee)??"").toLowerCase().includes(e);return C&&o})},[r,h,y]);const N=e=>{if(!e)return"";const s=P(e);return s?s.toLocaleString():""},z=[{field:"ticket_number",headerName:"Ticket",flex:.8,minWidth:120,renderCell:e=>{var s;return t.jsx(a,{children:((s=e.row)==null?void 0:s.ticket_number)??""})}},{field:"opened_at",headerName:"F. de alta",flex:1,minWidth:160,renderCell:e=>{var s;return t.jsx(a,{children:N((s=e.row)==null?void 0:s.opened_at)})}},{field:"closed_at",headerName:"F. de cierre",flex:1,minWidth:160,renderCell:e=>{var s;return t.jsx(a,{children:N((s=e.row)==null?void 0:s.closed_at)})}},{field:"status",headerName:"Estado",flex:.8,minWidth:120,renderCell:e=>{var s;return t.jsx(a,{children:((s=e.row)==null?void 0:s.status)??""})}},{field:"assignee",headerName:"Asignado",flex:1.2,minWidth:160,renderCell:e=>{var s;return t.jsx(a,{children:((s=e.row)==null?void 0:s.assignee)??""})}},{field:"client",headerName:"Cliente",flex:1,minWidth:140,renderCell:e=>{var s;return t.jsx(a,{children:((s=e.row)==null?void 0:s.client)??""})}},{field:"unit",headerName:"Unidad",flex:1,minWidth:140,renderCell:e=>{var s;return t.jsx(a,{children:((s=e.row)==null?void 0:s.unit)??""})}},{field:"contact",headerName:"Contacto",flex:1,minWidth:160,renderCell:e=>{var s;return t.jsx(a,{children:((s=e.row)==null?void 0:s.contact)??""})}},{field:"description",headerName:"Descripción",flex:1.6,minWidth:220,renderCell:e=>{var s,c;return t.jsx(a,{sx:{width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:(s=e.row)!=null&&s.description?"zoom-in":"default"},title:"Doble clic para ver completo",children:((c=e.row)==null?void 0:c.description)??""})}}];return t.jsxs(ee,{header:t.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Importar reporte de tickets"}),children:[t.jsx(Z,{title:"Personal Reports"}),t.jsxs(a,{p:3,children:[t.jsxs(q,{spacing:2,sx:{mb:2},children:[T&&t.jsx(G,{severity:"success",onClose:()=>v(!1),children:p}),H.file&&t.jsx(G,{severity:"error",children:H.file})]}),t.jsxs(J,{sx:{mb:3},children:[t.jsx(X,{title:"Subir archivo Excel",subheader:"Formatos permitidos: .xlsx, .xls, .csv"}),t.jsx(Q,{children:t.jsxs("form",{onSubmit:U,encType:"multipart/form-data",children:[t.jsxs(q,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",children:[t.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:B,disabled:n}),t.jsx(V,{type:"submit",variant:"contained",disabled:!A.file||n,children:n?"Importando...":"Importar"})]}),(g||n)&&t.jsxs(a,{sx:{mt:2},children:[t.jsx(w,{variant:"caption",children:"Progreso"}),t.jsx(oe,{variant:"determinate",value:(g==null?void 0:g.percentage)??100})]})]})})]}),t.jsxs(J,{children:[t.jsx(X,{title:"Últimos registros importados"}),t.jsxs(Q,{children:[t.jsxs(a,{display:"flex",gap:2,mb:2,alignItems:"center",flexWrap:"wrap",children:[t.jsx(ie,{size:"small",label:"Buscar (ticket / cliente / unidad / asignado)",value:h,onChange:e=>W(e.target.value),sx:{minWidth:360}}),t.jsxs(le,{size:"small",sx:{minWidth:240},children:[t.jsx(ne,{id:"age-filter-label",children:"Creado"}),t.jsxs(de,{labelId:"age-filter-label",label:"Creado",value:y,onChange:e=>M(e.target.value),children:[t.jsx(b,{value:"all",children:"Todos"}),t.jsx(b,{value:"1w",children:"Creado hace 1 semana"}),t.jsx(b,{value:"2w",children:"Creado hace 2 semanas"}),t.jsx(b,{value:"3w",children:"Creado hace 3 semanas"}),t.jsx(b,{value:"1m",children:"Creado hace 1 mes"}),t.jsx(b,{value:"gt1m",children:"Creado hace más de 1 mes"})]})]})]}),t.jsx(he,{rows:Array.isArray(r)?r:[],columns:z,getRowId:e=>(e==null?void 0:e.id)??`${e.ticket_number}-${e.opened_at}-${Math.random()}`,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,autoHeight:!0,onCellDoubleClick:x})]}),t.jsxs(ce,{open:R,onClose:()=>D(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(me,{children:$}),t.jsx(ue,{dividers:!0,children:t.jsx(w,{sx:{whiteSpace:"pre-wrap"},children:m})}),t.jsx(pe,{children:t.jsx(V,{onClick:()=>D(!1),variant:"contained",children:"Cerrar"})})]})]})]})]})}export{Ve as default};
