import{r as s,j as e,a as te,q as P,$ as re}from"./app-CBucPHzG.js";import{D as se,M as b,A as ie}from"./AuthenticatedLayout-BUigKAkC.js";import{V as le,A as oe}from"./Visibility-4qQyGr2O.js";import{d as D}from"./index-BGU7hHMp.js";import{C as de}from"./Close-D3H3o-J2.js";import{B as y}from"./Box-m--2wziB.js";import{T as Q}from"./Typography-DJb3NVXn.js";import{I as E}from"./IconButton-CPdJt1zi.js";import{T as S,F as k,I as q,a as W}from"./TextField-lb7VQPDo.js";import{F as V,S as G}from"./Stack-Cb4FCVXq.js";import{C as U,D as $,S as ce,V as ue}from"./ValidationErrorAlert-b073npDS.js";import{B as I}from"./Button-CTICrhqb.js";import{D as L}from"./Dialog-sDwa-wob.js";import{D as O,a as B,b as R}from"./DialogTitle-oN21Xprn.js";import{F as me}from"./FormGroup-5qyDL-Mc.js";import{E as he,D as pe}from"./Edit-BOGXEiyV.js";import"./School-D4ZvFjwW.js";import"./ButtonBase-DdA8Ku2c.js";import"./isMuiElement-C7jjdW1_.js";import"./useSlot-CJPmMWAX.js";import"./Logout-DN7lPPvv.js";import"./getThemeProps-CQcBN-ro.js";import"./CssBaseline-CmCe9WUw.js";import"./index-CQUi5ALd.js";import"./Modal-BEcyDk9H.js";import"./Slide-KN0NCWVU.js";import"./useFormControl-BsPVMvoc.js";import"./useThemeProps-BAltvEUj.js";import"./Alert-COo2tptv.js";function xe({open:g,onClose:p,question:a=null,subjectId:l}){const[c,u]=s.useState({subject_id:l,question:"",answer_a:"",answer_b:"",answer_c:"",answer_d:"",correct_answer:"",feedback_text:"",feedback_image:null,has_dynamic:!1});s.useEffect(()=>{l&&u(d=>({...d,subject_id:l}))},[l]),s.useEffect(()=>{u(a?{subject_id:a.subject_id||l||"",question:a.question||"",answer_a:a.answer_a||"",answer_b:a.answer_b||"",answer_c:a.answer_c||"",answer_d:a.answer_d||"",correct_answer:a.correct_answer||"",feedback_text:a.feedback_text||"",feedback_image:null,has_dynamic:a.has_dynamic||!1}:{subject_id:l||"",question:"",answer_a:"",answer_b:"",answer_c:"",answer_d:"",correct_answer:"",feedback_text:"",feedback_image:null,has_dynamic:!1})},[a,l]);const o=d=>{const{name:t,type:x,files:f,value:i,checked:w}=d.target,_=x==="file"?f[0]:x==="checkbox"?w:i;u(j=>({...j,[t]:_}))},m=d=>{d.preventDefault();const t={...c};a?D.Inertia.post(route("question.update",a.id),{...t,_method:"PUT"},{forceFormData:!0}):D.Inertia.post(route("question.store"),t,{forceFormData:!0}),p()};return e.jsx(se,{anchor:"right",open:g,onClose:p,sx:{zIndex:d=>d.zIndex.drawer+1e3},children:e.jsxs(y,{sx:{width:400,p:3},role:"presentation",children:[e.jsxs(y,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(Q,{variant:"h6",children:a?"Editar Pregunta":"Nueva Pregunta"}),e.jsx(E,{onClick:p,children:e.jsx(de,{})})]}),e.jsxs(y,{component:"form",onSubmit:m,mt:2,children:[e.jsx(S,{label:"Pregunta",name:"question",fullWidth:!0,value:c.question,onChange:o,margin:"normal",required:!0}),e.jsx(S,{label:"Respuesta A",name:"answer_a",fullWidth:!0,value:c.answer_a,onChange:o,margin:"normal",required:!0}),e.jsx(S,{label:"Respuesta B",name:"answer_b",fullWidth:!0,value:c.answer_b,onChange:o,margin:"normal",required:!0}),e.jsx(S,{label:"Respuesta C",name:"answer_c",fullWidth:!0,value:c.answer_c,onChange:o,margin:"normal",required:!0}),e.jsx(S,{label:"Respuesta D",name:"answer_d",fullWidth:!0,value:c.answer_d,onChange:o,margin:"normal"}),e.jsxs(k,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(q,{id:"correct-answer-label",children:"Respuesta Correcta"}),e.jsxs(W,{labelId:"correct-answer-label",name:"correct_answer",value:c.correct_answer,label:"Respuesta Correcta",onChange:o,MenuProps:{container:document.body,disablePortal:!0},children:[e.jsx(b,{value:"A",children:"A"}),e.jsx(b,{value:"B",children:"B"}),e.jsx(b,{value:"C",children:"C"}),e.jsx(b,{value:"D",children:"D"})]})]}),e.jsx(S,{label:"Retroalimentación",name:"feedback_text",fullWidth:!0,multiline:!0,rows:3,value:c.feedback_text,onChange:o,margin:"normal"}),e.jsx("input",{type:"file",name:"feedback_image",onChange:o,style:{marginTop:16}}),e.jsx(V,{control:e.jsx(U,{checked:c.has_dynamic,onChange:o,name:"has_dynamic"}),label:"¿Contiene dinámica?",sx:{mt:2}}),e.jsx(I,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:2},children:a?"Actualizar":"Crear"})]})]})})}function fe({open:g,onClose:p,types:a,subject:l,onSave:c}){const[u,o]=s.useState(""),[m,d]=s.useState(""),t=a.find(n=>n.id===Number(u)),x=(t==null?void 0:t.levels)||[],f=x.find(n=>n.id===Number(m)),[i,w]=s.useState(!1),[_,j]=s.useState(""),[C,r]=s.useState(""),F=(t==null?void 0:t.name)==="MULTITASK"||(t==null?void 0:t.name)==="MULTITASKING",[N,A]=s.useState(""),v=(t==null?void 0:t.bypass_levels_and_questions)===1,T=()=>{if(l!=null&&l.id&&u){const n=new FormData;n.append("subject_id",l.id),n.append("question_type_id",u),n.append("question_level_id",m),n.append("question_count",_),n.append("game",N),n.append("has_time_limit",i?"1":"0"),i&&n.append("time_limit",C),c(n),o(""),d(""),j(""),r(""),p()}};return e.jsxs(L,{open:g,onClose:p,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(O,{children:["Crear cuestionario para: ",l==null?void 0:l.name]}),e.jsx(B,{children:e.jsxs(y,{sx:{mt:2},children:[e.jsxs(k,{fullWidth:!0,margin:"normal",children:[e.jsx(q,{id:"type-select-label",children:"Tipo de cuestionario"}),e.jsx(W,{labelId:"type-select-label",value:u,label:"Tipo de cuestionario",onChange:n=>{o(n.target.value),d("")},required:!0,children:a.map(n=>e.jsx(b,{value:n.id,children:n.name},n.id))})]}),e.jsxs(k,{fullWidth:!0,margin:"normal",disabled:!x.length||!v,children:[e.jsx(q,{id:"level-select-label",children:"Nivel de complejidad"}),e.jsx(W,{labelId:"level-select-label",value:m,label:"Nivel de complejidad",onChange:n=>d(n.target.value),required:x.length>0||!v,children:x.map(n=>e.jsxs(b,{value:n.id,disabled:!v,children:[n.name," - ",n.description]},n.id))})]}),(f||t)&&e.jsxs(k,{fullWidth:!0,margin:"normal",children:[e.jsx(Q,{variant:"subtitle1",component:"p",children:v?"Número de preguntas para el examen":`Preguntas disponibles sobre examen (${f?f.questions_count||0:(t==null?void 0:t.questions_count)||0})`}),e.jsx(S,{id:"count-question-required",label:"Número de preguntas para examen",type:"number",inputProps:{min:1,...v?{}:{max:f?f.questions_count:(t==null?void 0:t.questions_count)||1}},onChange:n=>j(n.target.value),required:!0})]}),F&&e.jsxs(k,{fullWidth:!0,margin:"normal",children:[e.jsx(q,{id:"game-type-label",children:"Tipo de juego"}),e.jsxs(W,{labelId:"game-type-label",value:N,label:"Tipo de juego",onChange:n=>A(n.target.value),required:!0,children:[e.jsx(b,{value:"balde",children:"Balde"}),e.jsx(b,{value:"avion",children:"Avión"})]})]}),v||u&&e.jsx(me,{children:e.jsx(V,{control:e.jsx(U,{checked:i,onChange:n=>w(n.target.checked)}),label:"Tiempo límite"})}),i&&e.jsx(e.Fragment,{children:e.jsx(k,{fullWidth:!0,margin:"normal",children:e.jsx(S,{id:"limit-time-required",label:"Tiempo límite (segundos por pregunta)",type:"number",onChange:n=>r(n.target.value),inputProps:{min:1}})})})]})}),e.jsxs(R,{children:[e.jsx(I,{onClick:()=>{p(),o(""),m("")},children:"Cancelar"}),e.jsx(I,{variant:"contained",onClick:T,disabled:!u,children:"Crear"})]})]})}function ge({open:g,onClose:p,types:a,onImport:l,handleExport:c}){const[u,o]=s.useState(""),[m,d]=s.useState(null),[t,x]=s.useState(""),[f,i]=s.useState(""),w=a.find(r=>r.id===Number(t)),_=(w==null?void 0:w.levels)||[],j=r=>{d(r.target.files[0])},C=()=>{if(m&&t){const r=new FormData;r.append("file",m),r.append("type_id",t),r.append("level_id",f),l(r),d(null),setTypetId(""),setLeveltId(""),p()}};return e.jsxs(L,{open:g,onClose:p,fullWidth:!0,maxWidth:"sm",children:[e.jsx(O,{children:"Importar a banco de preguntas"}),e.jsx(B,{children:e.jsxs(y,{sx:{mt:2},children:[e.jsxs(k,{fullWidth:!0,margin:"normal",children:[e.jsx(q,{id:"type-select-label",children:"Tipo de cuestionario"}),e.jsx(W,{labelId:"type-select-label",value:t,label:"Tipo de cuestionario",onChange:r=>{x(r.target.value),i("")},required:!0,children:a.filter(r=>r.is_automatic===0).map(r=>e.jsx(b,{value:r.id,children:r.name},r.id))})]}),e.jsxs(k,{fullWidth:!0,margin:"normal",disabled:!_.length,children:[e.jsx(q,{id:"level-select-label",children:"Nivel de complejidad"}),e.jsx(W,{labelId:"level-select-label",value:f,label:"Nivel de complejidad",onChange:r=>i(r.target.value),required:!0,children:_.map(r=>e.jsxs(b,{value:r.id,children:[r.name," - ",r.description]},r.id))})]}),e.jsxs(I,{variant:"outlined",component:"label",fullWidth:!0,sx:{mt:2},children:["Seleccionar archivo Excel",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx, .xls",onChange:j})]}),m&&e.jsx(S,{label:"Archivo seleccionado",value:m.name,fullWidth:!0,disabled:!0,margin:"normal"})]})}),e.jsxs(R,{children:[e.jsx(I,{onClick:()=>{c(u),o(null)},children:"Exportar Concentrado"}),e.jsx(I,{onClick:()=>{p(),x(null),i(null)},children:"Cancelar"}),e.jsx(I,{variant:"contained",onClick:C,disabled:!m||!t,children:"Importar"})]})]})}function je({open:g,onClose:p,subject:a,handleEditQuestion:l,handleDelete:c,handleExport:u}){const[o,m]=s.useState([]),[d,t]=s.useState(!0),x=async()=>{try{const i=await te.get(route("question.subject",a==null?void 0:a.id));m(i.data)}catch(i){console.error("Error fetching questions:",i)}finally{t(!1)}};s.useEffect(()=>{g&&(a!=null&&a.id)&&x()},[g,a==null?void 0:a.id]);const f=[{field:"question",headerName:"Pregunta",flex:1},{field:"correct_answer",headerName:"Correcta",width:120,renderCell:i=>e.jsx("span",{children:i.row.correct_answer||i.row.answer})},{field:"actions",headerName:"Acciones",width:120,sortable:!1,renderCell:i=>e.jsxs(G,{direction:"row",spacing:1,children:[e.jsx(E,{onClick:()=>l(i.row),color:"primary",children:e.jsx(he,{})}),e.jsx(E,{onClick:()=>c(i.row.id),color:"error",size:"small",children:e.jsx(pe,{})})]})}];return e.jsxs(L,{open:g,onClose:p,fullWidth:!0,maxWidth:"md",children:[e.jsxs(O,{children:["Preguntas de la materia: ",a==null?void 0:a.name]}),e.jsx(B,{children:d?e.jsx(Q,{children:"Cargando preguntas..."}):e.jsx(y,{sx:{height:400,width:"100%"},children:e.jsx($,{rows:o,columns:f,pageSize:5,rowsPerPageOptions:[5],getRowId:i=>i.id})})}),e.jsx(R,{children:e.jsx(I,{onClick:p,children:"Cerrar"})})]})}function He(){var M,z;const{errors:g,flash:p}=P().props,{questions:a,subjects:l,types:c}=P().props,[u,o]=s.useState(!1),[m,d]=s.useState(!1),[t,x]=s.useState(!1),[f,i]=s.useState(!1),[w,_]=s.useState(null),[j,C]=s.useState(null),r=((z=(M=P().props)==null?void 0:M.flash)==null?void 0:z.success)??null,[F,N]=s.useState(!!r),[A,v]=s.useState(!1);s.useEffect(()=>{r&&N(!0)},[r]),s.useEffect(()=>{Object.keys(g).length>0&&v(!0)},[g]);const T=h=>{C(h),x(!0)},n=h=>{_(h),o(!0)},H=h=>{C(h),d(!0)},K=()=>{o(!1),_(null),C(null)},J=()=>{x(!1),_(null),C(null)},X=()=>{d(!1),_(null),C(null)},Y=()=>{i(!0)},Z=h=>{D.Inertia.get(route("question.export",h))},ee=[{field:"name",headerName:"Materia",flex:.5},{field:"questions_count",headerName:"Número de preguntas",flex:.5},{field:"actions",headerName:"Acciones",flex:.5,sortable:!0,renderCell:h=>e.jsxs(G,{direction:"row",spacing:1,children:[e.jsx(E,{onClick:()=>H(h.row),color:"primary",children:e.jsx(le,{})}),e.jsx(E,{onClick:()=>T(h.row),color:"primary",children:e.jsx(oe,{})})]})}],ae=h=>{confirm("¿Estás seguro de eliminar esta pregunta?")&&D.Inertia.delete(route("question.destroy",h))},ne=h=>{D.Inertia.post(route("question.test"),h,{forceFormData:!0})};return e.jsxs(ie,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Cuestionarios"}),children:[e.jsx(re,{title:"Cuestionarios"}),e.jsx(ce,{open:F,onClose:()=>N(!1),message:r}),e.jsx(ue,{open:A,onClose:()=>v(!1),errors:g}),e.jsxs(y,{p:4,children:[e.jsx(y,{display:"flex",justifyContent:"flex-end",mb:2,children:e.jsx(I,{variant:"contained",color:"primary",onClick:Y,children:"Importar Cuestionario"})}),e.jsx(y,{sx:{height:500,width:"100%"},children:e.jsx($,{rows:l,columns:ee,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,autoHeight:!0})})]}),e.jsx(xe,{open:u,onClose:K,question:w,subjectId:j==null?void 0:j.id}),e.jsx(fe,{open:t,onClose:J,subject:j,types:c,onSave:ne}),e.jsx(je,{open:m,onClose:X,subject:j,handleEditQuestion:n,handleDelete:ae}),e.jsx(ge,{open:f,onClose:()=>i(!1),types:c,onImport:h=>{D.Inertia.post(route("question.import"),h,{forceFormData:!0})},handleExport:Z})]})}export{He as default};
