import{r as i,a as R,j as e,q as F,$ as Z}from"./app-iwa7Ko-Z.js";import{D as H,A as $}from"./AuthenticatedLayout-BSs6eLkc.js";import{E as q,D as B}from"./Edit-D-IbjLMr.js";import{d as P}from"./index-CmCaFWEg.js";import{C as U}from"./Close-BWwuavNZ.js";import{u as J,T as K}from"./Modal-gcJFvPF_.js";import{B as y}from"./Box-CqNUOHRX.js";import{I as v}from"./Alert-DiYJsapg.js";import{T as d,I as L,S as O,F as M,a as Q}from"./TextField-Q7kOsDE7.js";import{I as X,D as Y,T as A}from"./DataGrid-BDPtAAPa.js";import{a as ee,V as re}from"./VisibilityOff-5iZA5zDi.js";import{M as h}from"./ErrorAlert-DL_97Dck.js";import{B as V}from"./Button-C8fvO0-a.js";import{S as te,V as oe}from"./ValidationErrorAlert-DwhElMJ5.js";import{S as se}from"./Stack-DVqpet58.js";import"./School-CroBi7-Q.js";import"./createSvgIcon-D99aBHKs.js";import"./Logout-CrnWu4kK.js";import"./isMuiElement-55XBPpcb.js";import"./index-DtfEqqqK.js";import"./getThemeProps-FokNFDAI.js";import"./index-DMgIWF8b.js";import"./Slide-DdegnNH9.js";import"./useFormControl-BUotvuGz.js";import"./index-InVKASzb.js";import"./useThemeProps-CBQDxJ_D.js";import"./LinearProgress-Wwjqn4ud.js";import"./TableCell-DB2CM2vu.js";function ne({open:b,onClose:E,student:s=null}){const D=Math.random().toString(36).substring(2,10),[x,N]=i.useState(!1),[f,m]=i.useState([]),[C,g]=i.useState([]),[k,S]=i.useState(!1),[j,w]=i.useState(""),[_,I]=i.useState(""),z=new Date().toISOString().split("T")[0],W=J(),[n,u]=i.useState({name:"",email:"",password:"",birthdate:"",gender:"",phone:"",address:"",zip_code:"",city:"",country:"",school:"",expires_at:""});i.useEffect(()=>{var t,o,c,a;u(s?{name:((t=s.user)==null?void 0:t.name)||"",email:((o=s.user)==null?void 0:o.email)||"",password:"",birthdate:s.birthdate||"",gender:(s==null?void 0:s.gender)||"",phone:s.phone||"",address:s.address||"",zip_code:s.zip_code||"",city:s.city||"",country:s.country||"",school:s.school||"",expires_at:((a=(c=s.user)==null?void 0:c.paypal_user)==null?void 0:a.expires_at.substring(0,10))||""}:{name:"",email:"",password:D,birthdate:"",phone:"",address:"",zip_code:"",city:"",country:"",school:"",expires_at:""})},[s]),i.useEffect(()=>{if(!n.zip_code||n.zip_code.length<4){m([]),g([]),w("");return}const t=setTimeout(()=>{T(n.zip_code,"mx")},500);return()=>clearTimeout(t)},[n.zip_code]);const T=async(t,o="mx")=>{S(!0),w("");try{const{data:c}=await R.get(route("zip.lookup"),{params:{zip:t,country:o}}),a=c.cities||[],p=c.country||"";m(a),g(p?[p]:[]),u(G=>({...G,city:a[0]||"",country:p||""}))}catch(c){m([]),g([]),u(a=>({...a,city:"",country:""})),w("No se encontró el código postal."),console.error(c)}finally{S(!1)}},l=t=>{const{name:o,value:c}=t.target;if(o==="zip_code"){const a=c.replace(/\D/g,"");u(p=>({...p,zip_code:a}));return}if(o==="phone"){const a=c.replace(/\D/g,"");u(p=>({...p,phone:a})),a.length>0&&a.length!==10?I("El teléfono debe tener 10 dígitos."):I("")}u(a=>({...a,[o]:c}))},r=t=>{t.preventDefault();const o={...n,role:"student"};s?P.Inertia.post(route("students.update",s.id),{...o,_method:"PUT"}):(console.log(o),P.Inertia.post(route("students.store"),o)),E()};return e.jsx(H,{anchor:"right",open:b,onClose:E,sx:{zIndex:W.zIndex.drawer+1},children:e.jsxs(y,{sx:{width:400,p:3},role:"presentation",children:[e.jsxs(y,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(K,{variant:"h6",children:s?"Editar Estudiante":"Nuevo Estudiante"}),e.jsx(v,{onClick:E,children:e.jsx(U,{})})]}),e.jsxs(y,{component:"form",onSubmit:r,mt:2,children:[e.jsx(d,{fullWidth:!0,label:"Nombre",name:"name",value:n.name,onChange:l,margin:"normal"}),e.jsx(d,{fullWidth:!0,label:"Correo electrónico",name:"email",type:"email",value:n.email,onChange:l,margin:"normal"}),e.jsx(d,{fullWidth:!0,label:"Contraseña",name:"password",type:x?"text":"password",value:n.password,onChange:l,margin:"normal",helperText:s?"Deja en blanco si no deseas cambiar la contraseña":"",InputProps:{endAdornment:e.jsx(X,{position:"end",children:e.jsx(v,{onClick:()=>N(t=>!t),edge:"end",children:x?e.jsx(ee,{}):e.jsx(re,{})})})}}),e.jsx(d,{fullWidth:!0,label:"Fecha de nacimiento",name:"birthdate",type:"date",value:n.birthdate,onChange:l,margin:"normal",InputLabelProps:{shrink:!0},inputProps:{max:z}}),e.jsx(L,{id:"gender-label",children:"Género"}),e.jsxs(O,{fullWidth:!0,name:"gender",value:n.gender||"",label:"Género",onChange:l,children:[e.jsx(h,{value:"Masculino",children:"Masculino"}),e.jsx(h,{value:"Femenino",children:"Femenino"}),e.jsx(h,{value:"Otro",children:"Otro"})]}),e.jsx(d,{fullWidth:!0,label:"Teléfono",name:"phone",value:n.phone,onChange:l,margin:"normal",inputProps:{inputMode:"numeric",pattern:"[0-9]*",maxLength:10},error:!!_,helperText:_||"Ingresa un número de 10 dígitos"}),e.jsx(d,{fullWidth:!0,label:"Dirección",name:"address",value:n.address,onChange:l,margin:"normal"}),e.jsx(d,{fullWidth:!0,label:"CP",name:"zip_code",value:n.zip_code,onChange:l,margin:"normal",inputProps:{inputMode:"numeric",pattern:"[0-9]*"},helperText:j||(k?"Buscando…":""),error:!!j}),e.jsxs(M,{fullWidth:!0,margin:"normal",children:[e.jsx(L,{children:"Ciudad"}),e.jsx(O,{name:"city",value:n.city,onChange:l,label:"Ciudad",disabled:f.length===0,children:f.length>0?f.map((t,o)=>e.jsx(h,{value:t,children:t},o)):e.jsx(h,{value:"",children:"Sin datos"})}),e.jsx(Q,{children:"Selecciona tu ciudad"})]}),e.jsxs(M,{fullWidth:!0,margin:"normal",children:[e.jsx(L,{children:"País"}),e.jsx(O,{name:"country",value:n.country,onChange:l,label:"País",disabled:C.length===0,children:C.length>0?C.map((t,o)=>e.jsx(h,{value:t,children:t},o)):e.jsx(h,{value:"",children:"Sin datos"})})]}),e.jsx(d,{fullWidth:!0,label:"Escuela",name:"school",value:n.school,onChange:l,margin:"normal"}),e.jsx(d,{fullWidth:!0,label:"Fecha de expiración",name:"expires_at",type:"date",value:n.expires_at,onChange:l,margin:"normal",InputLabelProps:{shrink:!0},inputProps:{min:z}}),e.jsx(V,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:2},children:s?"Actualizar":"Crear"})]})]})})}function We(){var T,l;const{errors:b,flash:E}=F().props,{students:s}=F().props,[D,x]=i.useState(!1),[N,f]=i.useState(null),m=((l=(T=F().props)==null?void 0:T.flash)==null?void 0:l.success)??null,[C,g]=i.useState(!!m),[k,S]=i.useState(!1),[j,w]=i.useState("");i.useEffect(()=>{m&&g(!0)},[m]),i.useEffect(()=>{Object.keys(b).length>0&&S(!0)},[b]);const _=r=>{f(r),x(!0)},I=()=>{f(null),x(!0)},z=r=>{confirm("¿Estás seguro de eliminar este estudiante?")&&P.Inertia.delete(route("students.destroy",r))},W=r=>{confirm("¿Estás seguro de recuperar este estudiante?")&&P.Inertia.put(route("students.restore",r))},n=s.filter(r=>{var t,o;return r.name.toLowerCase().includes(j.toLowerCase())||((o=(t=r.user)==null?void 0:t.email)==null?void 0:o.toLowerCase().includes(j.toLowerCase()))}),u=[{field:"name",headerName:"Nombre",flex:1},{field:"user_email",headerName:"Correo",flex:1.5,renderCell:r=>{var t,o;return((o=(t=r==null?void 0:r.row)==null?void 0:t.user)==null?void 0:o.email)||""}},{field:"gender",headerName:"Género",flex:1},{field:"phone",headerName:"Teléfono",flex:1},{field:"city",headerName:"Ciudad",flex:1},{field:"school",headerName:"Escuela",flex:1},{field:"user_expires_at",headerName:"Fecha Expiración",flex:1,renderCell:r=>{var o,c,a;const t=(a=(c=(o=r==null?void 0:r.row)==null?void 0:o.user)==null?void 0:c.paypal_user)==null?void 0:a.expires_at;return t?t.substring(0,10):""}},{field:"actions",headerName:"Acciones",width:120,sortable:!1,renderCell:r=>e.jsxs(se,{direction:"row",spacing:1,children:[e.jsx(A,{title:"Editar",children:e.jsx(v,{onClick:()=>_(r.row),color:"primary",children:e.jsx(q,{})})}),r.row.deleted_at?e.jsx(A,{title:"Recuperar",children:e.jsx(v,{onClick:()=>W(r.row.id),color:"success",children:e.jsx(B,{})})}):e.jsx(A,{title:"Eliminar",children:e.jsx(v,{onClick:()=>z(r.row.id),color:"error",children:e.jsx(B,{})})})]})}];return e.jsxs($,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Estudiantes"}),children:[e.jsx(Z,{title:"Estudiantes"}),e.jsx(te,{open:C,onClose:()=>g(!1),message:m}),e.jsx(oe,{open:k,onClose:()=>S(!1),errors:b}),e.jsx(y,{p:4,children:e.jsxs(y,{sx:{height:600,width:"100%"},children:[e.jsxs(y,{display:"flex",justifyContent:"space-between",mb:2,children:[e.jsx(d,{label:"Buscar por nombre o correo",variant:"outlined",size:"small",value:j,onChange:r=>w(r.target.value),sx:{width:300}}),e.jsx(V,{variant:"contained",color:"primary",onClick:I,children:"Crear nuevo estudiante"})]}),e.jsx(Y,{rows:n,columns:u,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,getRowId:r=>r.id,autoHeight:!0})]})}),e.jsx(ne,{open:D,onClose:()=>x(!1),student:N})]})}export{We as default};
