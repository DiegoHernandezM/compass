import{r as a,j as e,a as ie,q as Y,$ as ke}from"./app-BLq9qGjh.js";import{d as O}from"./index-C2jAZdz9.js";import{V as oe}from"./VisibilityOff-B8scy8B3.js";import{I as Fe,A as Ee}from"./index-CRfPOSmF.js";import{E as ce,D as de}from"./Edit-yhFPSgDj.js";import{D as Z,A as Ne}from"./AuthenticatedLayout-DdsxpUii.js";import{C as J}from"./Close-C3PnWu73.js";import{B as q,C as U,T as y}from"./Modal-De_ycrcN.js";import{B as x}from"./Box-Cz7V3xGm.js";import{I as A}from"./Alert-CpLzSzlf.js";import{S as X,F as Te}from"./Stack-D08xgxbL.js";import{F as z,I as B,S as M,T as E,a as le}from"./TextField-DBFj0bvo.js";import{M as F,A as We,T as Ae}from"./ErrorAlert-BW-WwH7d.js";import{B as v}from"./Button-CuNxhS1F.js";import{D as $}from"./Dialog-D-u6Do8Y.js";import{D as G,a as H,b as K}from"./DialogTitle-BsS6_qF-.js";import{F as Le}from"./FormGroup-CZXF_j8I.js";import{C as Re,D as ee,T as Q,a as ye}from"./DataGrid-Cv2EfpVC.js";import{S as Pe,V as ze}from"./ValidationErrorAlert-DPDm9xLn.js";import{S as Oe}from"./index-B1RQIcyM.js";import"./createSvgIcon-C0m7Iky1.js";import"./School-DyR7C2LF.js";import"./Person-CORynGXJ.js";import"./MenuBook-vcyJ5ap0.js";import"./Logout-CUDp4jRG.js";import"./isMuiElement-CGz5YhyF.js";import"./index-C-LZr9ID.js";import"./useFormControl-DrCdXN2E.js";import"./useThemeProps-CxXTaoeJ.js";import"./getThemeProps-Deont-l5.js";import"./index-ZXtRLO-I.js";import"./LinearProgress-DeS7CSV4.js";import"./TableCell-CS9GeTju.js";const V=g=>{if(typeof g!="string")return!1;const d=g.trim();return d?/^(https?:\/\/|s3:\/\/|data:image\/|\/[^\/].*\.(png|jpe?g|gif|webp|svg)(\?.*)?$)/i.test(d)||/^https?:\/\/.+\.(png|jpe?g|gif|webp|svg)(\?.*)?$/i.test(d):!1};function Qe({open:g,onClose:d,question:r=null}){const[u,h]=a.useState(!1),i=a.useMemo(()=>V(r==null?void 0:r.answer_a),[r]),f=a.useMemo(()=>V(r==null?void 0:r.answer_b),[r]),o=a.useMemo(()=>V(r==null?void 0:r.answer_c),[r]),b=a.useMemo(()=>V(r==null?void 0:r.answer_d),[r]),s=a.useMemo(()=>V(r==null?void 0:r.question_image),[r]),[n,t]=a.useState({question:"",question_image:null,answer_a:"",answer_b:"",answer_c:"",answer_d:"",correct_answer:"",feedback_text:"",feedback_image:null,has_dynamic:!1}),[c,w]=a.useState({question_image:null,answer_a_file:null,answer_b_file:null,answer_c_file:null,answer_d_file:null,feedback_image:null});a.useEffect(()=>{t({question:s?"":(r==null?void 0:r.question)||"",question_image:null,answer_a:(r==null?void 0:r.answer_a)??"",answer_b:(r==null?void 0:r.answer_b)??"",answer_c:(r==null?void 0:r.answer_c)??"",answer_d:(r==null?void 0:r.answer_d)??"",correct_answer:(r==null?void 0:r.correct_answer)||"",feedback_text:(r==null?void 0:r.feedback_text)||"",feedback_image:null,has_dynamic:!!(r!=null&&r.has_dynamic)||!1}),w({question_image:s&&(r==null?void 0:r.question_image)||null,answer_a:i&&(r==null?void 0:r.answer_a)||null,answer_b:f&&(r==null?void 0:r.answer_b)||null,answer_c:o&&(r==null?void 0:r.answer_c)||null,answer_d:b&&(r==null?void 0:r.answer_d)||null,feedback_image:null})},[r]);const I=_=>{const{name:j,type:T,files:k,value:L}=_.target;if(T==="file"){const l=(k==null?void 0:k[0])||null;if(t(W=>({...W,[j]:l})),l){const W=URL.createObjectURL(l);w(R=>({...R,[j]:W}))}else w(W=>({...W,[j]:null}))}else t(l=>({...l,[j]:L}))},S=_=>{_.preventDefault();const j={...n};console.log(j),O.Inertia.post(route("question.update",r.id),{...j,_method:"PUT"},{forceFormData:!0,preserveScroll:!0,onStart:()=>h(!0),onError:()=>h(!1),onSuccess:()=>{h(!1),d()},onFinish:()=>{}})},C=({label:_,valueName:j,fileName:T,existingUrl:k})=>{const L=c[T]||k;return e.jsxs(x,{mt:2,children:[e.jsxs(y,{variant:"subtitle2",sx:{mb:1},children:[_," (Imagen)"]}),L&&e.jsxs(x,{sx:{mb:1,border:"1px solid",borderColor:"divider",p:1,borderRadius:1},children:[e.jsx("img",{src:L,alt:`${_} actual`,style:{maxWidth:"100%",maxHeight:200,objectFit:"contain",display:"block",margin:"0 auto"}}),e.jsx(le,{sx:{textAlign:"center"},children:"Vista previa"})]}),e.jsxs(v,{variant:"outlined",component:"label",fullWidth:!0,children:[L?"Reemplazar imagen":"Subir imagen",e.jsx("input",{type:"file",name:T,accept:"image/*",hidden:!0,onChange:I})]})]})},m=({label:_,name:j,required:T=!0})=>e.jsx(E,{label:_,name:j,fullWidth:!0,value:n[j]||"",onChange:I,margin:"normal",style:{marginTop:"10px"}}),D=(_,j,T,k)=>T?e.jsx(C,{label:_,valueName:j,fileName:`${j}_file`,existingUrl:k},j):e.jsx(m,{label:_,name:j},j);return e.jsxs(Z,{anchor:"right",open:g,onClose:d,sx:{zIndex:_=>_.zIndex.drawer+1e3},children:[e.jsx(q,{open:u,sx:{color:"#fff",zIndex:_=>_.zIndex.drawer+2e3},children:e.jsx(U,{color:"inherit"})}),e.jsxs(x,{sx:{width:440,p:3},role:"presentation",children:[e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(y,{variant:"h6",children:r?"Editar Pregunta":"Nueva Pregunta"}),e.jsx(A,{onClick:d,children:e.jsx(J,{})})]}),e.jsxs(x,{component:"form",onSubmit:S,mt:2,children:[s?e.jsx(C,{label:"Pregunta",valueName:"question",fileName:"question_image",existingUrl:(r==null?void 0:r.question_image)||null}):e.jsx(m,{label:"Pregunta",name:"question"}),e.jsxs(X,{spacing:1,children:[D("Respuesta A","answer_a",i,i?r==null?void 0:r.answer_a:null),D("Respuesta B","answer_b",f,f?r==null?void 0:r.answer_b:null),D("Respuesta C","answer_c",o,o?r==null?void 0:r.answer_c:null),D("Respuesta D","answer_d",b,b?r==null?void 0:r.answer_d:null)]}),e.jsxs(z,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(B,{id:"correct-answer-label",children:"Respuesta Correcta"}),e.jsxs(M,{labelId:"correct-answer-label",name:"correct_answer",value:n.correct_answer,label:"Respuesta Correcta",onChange:I,MenuProps:{container:document.body,disablePortal:!0},children:[e.jsx(F,{value:"A",children:"A"}),e.jsx(F,{value:"B",children:"B"}),e.jsx(F,{value:"C",children:"C"}),e.jsx(F,{value:"D",children:"D"})]})]}),e.jsx(E,{label:"Retroalimentación (texto)",name:"feedback_text",fullWidth:!0,multiline:!0,rows:3,value:n.feedback_text,onChange:I,margin:"normal"}),e.jsxs(x,{mt:1,children:[e.jsx(y,{variant:"subtitle2",sx:{mb:1},children:"Retroalimentación (imagen) — opcional"}),c.feedback_image&&e.jsxs(x,{sx:{mb:1,border:"1px solid",borderColor:"divider",p:1,borderRadius:1},children:[e.jsx("img",{src:c.feedback_image,alt:"Feedback preview",style:{maxWidth:"100%",maxHeight:160,objectFit:"contain",display:"block",margin:"0 auto"}}),e.jsx(le,{sx:{textAlign:"center"},children:"Vista previa"})]}),e.jsxs(v,{variant:"outlined",component:"label",fullWidth:!0,children:[c.feedback_image?"Reemplazar imagen":"Subir imagen",e.jsx("input",{type:"file",name:"feedback_image",accept:"image/*",hidden:!0,onChange:I,style:{marginBottom:"10px"}})]})]}),e.jsx(v,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:3},disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:20,sx:{mr:1}}),"Guardando..."]}):"Actualizar"})]})]})]})}function Me({open:g,onClose:d,question:r=null}){const[u,h]=a.useState(!1),[i,f]=a.useState({question:"",option_a:"",option_b:"",option_c:"",answer:""});a.useEffect(()=>{f({question:r.question||"",option_a:r.option_a||"",option_b:r.option_b||"",option_c:r.option_c||"",answer:r.answer||""})},[r]);const o=s=>{const{name:n,type:t,files:c,value:w,checked:I}=s.target,S=t==="file"?c[0]:t==="checkbox"?I:w;f(C=>({...C,[n]:S}))},b=s=>{s.preventDefault();const n={...i};console.log(n),O.Inertia.post(route("question-multitask.update",r.id),{...n,_method:"PUT"},{forceFormData:!0,preserveScroll:!0,onStart:()=>h(!0),onError:()=>h(!1),onSuccess:()=>{h(!1),d()},onFinish:()=>{}})};return e.jsxs(Z,{anchor:"right",open:g,onClose:d,sx:{zIndex:s=>s.zIndex.drawer+1e3},children:[e.jsx(q,{open:u,sx:{color:"#fff",zIndex:s=>s.zIndex.drawer+2e3},children:e.jsx(U,{color:"inherit"})}),e.jsxs(x,{sx:{width:400,p:3},role:"presentation",children:[e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(y,{variant:"h6",children:"Editar Pregunta"}),e.jsx(A,{onClick:d,children:e.jsx(J,{})})]}),e.jsxs(x,{component:"form",onSubmit:b,mt:2,children:[e.jsx(E,{label:"Pregunta",name:"question",fullWidth:!0,value:i.question,onChange:o,margin:"normal",required:!0}),e.jsx(E,{label:"Respuesta A",name:"option_a",fullWidth:!0,value:i.option_a,onChange:o,margin:"normal",required:!0}),e.jsx(E,{label:"Respuesta B",name:"option_b",fullWidth:!0,value:i.option_b,onChange:o,margin:"normal",required:!0}),e.jsx(E,{label:"Respuesta C",name:"option_c",fullWidth:!0,value:i.option_c,onChange:o,margin:"normal"}),e.jsxs(z,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(B,{id:"correct-answer-label",children:"Respuesta Correcta"}),(r==null?void 0:r.type)=="figure"?e.jsxs(M,{labelId:"correct-answer-label",name:"answer",value:i.answer,label:"Respuesta Correcta",onChange:o,MenuProps:{container:document.body,disablePortal:!0},children:[e.jsx(F,{value:"x1",children:"x1"}),e.jsx(F,{value:"x2",children:"x2"}),e.jsx(F,{value:"x3",children:"x3"})]}):e.jsxs(M,{labelId:"correct-answer-label",name:"answer",value:i.answer,label:"Respuesta Correcta",onChange:o,MenuProps:{container:document.body,disablePortal:!0},children:[e.jsx(F,{value:"Incorrecto",children:"Incorrecto"}),e.jsx(F,{value:"Correcto",children:"Correcto"})]})]}),e.jsx(v,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:3},disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:20,sx:{mr:1}}),"Guardando..."]}):"Actualizar"})]})]})]})}function Be({open:g,onClose:d,type:r,subjects:u,onSave:h}){const[i,f]=a.useState(""),[o,b]=a.useState(""),s=u.find(l=>l.id===Number(i)),n=(r==null?void 0:r.levels)||[],t=n.find(l=>l.id===Number(o)),[c,w]=a.useState(!1),[I,S]=a.useState(""),[C,m]=a.useState(""),D=(r==null?void 0:r.bypass_levels_and_questions)===1,[_,j]=a.useState(!1),[T,k]=a.useState(!1);a.useEffect(()=>{(async()=>{var W;if(i&&o)try{const R=await ie.get(`/admin/question/check-existence/${i}/${o}/${r==null?void 0:r.id}`);((W=R.data)==null?void 0:W.exists.length)>0&&(console.log(R.data.exists),j(!0))}catch(R){console.error("Error al verificar test existente:",R)}})()},[i,o]);const L=()=>{if(r!=null&&r.id&&i){const l=new FormData;l.append("subject_id",i),l.append("question_type_id",r==null?void 0:r.id),l.append("question_level_id",o),l.append("question_count",I),l.append("has_time_limit",c?"1":"0"),l.append("reset",T),c&&l.append("time_limit",C),h(l),k(!1),f(""),b(""),S(""),m(""),d()}};return e.jsxs(e.Fragment,{children:[e.jsxs($,{open:g,onClose:(l,W)=>{},fullWidth:!0,maxWidth:"xl",disableEscapeKeyDown:!0,children:[e.jsxs(G,{children:["Tipo de cuestionario: ",r==null?void 0:r.name]}),e.jsx(H,{children:e.jsxs(x,{sx:{mt:2},children:[e.jsxs(z,{fullWidth:!0,margin:"normal",children:[e.jsx(B,{id:"type-select-label",children:"Materias"}),e.jsx(M,{labelId:"type-select-label",value:i??"",label:"Materias",onChange:l=>{f(l.target.value),b("")},required:!0,children:u.map(l=>e.jsx(F,{value:l.id,children:l.name},l.id))})]}),e.jsxs(z,{fullWidth:!0,margin:"normal",disabled:n.length==0,children:[e.jsx(B,{id:"level-select-label",children:"Nivel de complejidad"}),e.jsx(M,{labelId:"level-select-label",value:o??"",label:"Nivel de complejidad",onChange:l=>b(l.target.value),required:n.length>0,children:n.map(l=>e.jsxs(F,{value:l.id,children:[l.name," - ",l.description]},l.id))})]}),(t||D)&&e.jsxs(z,{fullWidth:!0,margin:"normal",children:[e.jsx(y,{variant:"subtitle1",component:"p",children:D?"Número de preguntas para el examen":`Preguntas disponibles sobre examen (${t?t.questions_count||0:(s==null?void 0:s.questions_count)||0})`}),e.jsx(E,{id:"count-question-required",label:"Número de preguntas para examen",type:"number",inputProps:{min:1,...D?{}:{max:t?t.questions_count:(s==null?void 0:s.questions_count)||1}},onChange:l=>S(l.target.value),required:!0})]}),D||i&&e.jsx(Le,{children:e.jsx(Te,{control:e.jsx(Re,{checked:c,onChange:l=>w(l.target.checked)}),label:"Tiempo límite"})}),c&&e.jsx(e.Fragment,{children:e.jsx(z,{fullWidth:!0,margin:"normal",children:e.jsx(E,{id:"limit-time-required",label:"Tiempo límite (segundos por pregunta)",type:"number",onChange:l=>m(l.target.value),inputProps:{min:1}})})})]})}),e.jsxs(K,{children:[e.jsx(v,{onClick:()=>{d(),f(""),o("")},children:"Cancelar"}),e.jsx(v,{variant:"contained",onClick:L,disabled:!i,children:"Crear"})]})]}),e.jsxs($,{open:_,onClose:()=>j(!1),children:[e.jsx(G,{children:"Existen preguntas asignadas a esta materia"}),e.jsx(H,{children:"Al continuar se reasignarán las nuevas preguntas a la materia con el nivel asignado. ¿Quieres continuar?"}),e.jsxs(K,{children:[e.jsx(v,{onClick:()=>j(!1),children:"Cancelar"}),e.jsx(v,{onClick:()=>{k(!0),j(!1)},autoFocus:!0,children:"Continuar"})]})]})]})}function $e({open:g,onClose:d,types:r,onImport:u,handleExport:h}){const[i,f]=a.useState(""),[o,b]=a.useState(null),[s,n]=a.useState(""),[t,c]=a.useState(""),w=r.find(m=>m.id===Number(s)),I=(w==null?void 0:w.levels)||[],S=m=>{b(m.target.files[0])},C=()=>{if(o&&s){const m=new FormData;m.append("file",o),m.append("type_id",s),m.append("level_id",t),u(m),b(null),setTypetId(""),setLeveltId(""),d()}};return e.jsxs($,{open:g,onClose:d,fullWidth:!0,maxWidth:"sm",children:[e.jsx(G,{children:"Importar a banco de preguntas"}),e.jsx(H,{children:e.jsxs(x,{sx:{mt:2},children:[e.jsxs(z,{fullWidth:!0,margin:"normal",children:[e.jsx(B,{id:"type-select-label",children:"Tipo de cuestionario"}),e.jsx(M,{labelId:"type-select-label",value:s,label:"Tipo de cuestionario",onChange:m=>{n(m.target.value),c("")},required:!0,children:r.filter(m=>m.is_automatic===0).map(m=>e.jsx(F,{value:m.id,children:m.name},m.id))})]}),e.jsxs(z,{fullWidth:!0,margin:"normal",disabled:!I.length,children:[e.jsx(B,{id:"level-select-label",children:"Nivel de complejidad"}),e.jsx(M,{labelId:"level-select-label",value:t,label:"Nivel de complejidad",onChange:m=>c(m.target.value),required:!0,children:I.map(m=>e.jsxs(F,{value:m.id,children:[m.name," - ",m.description]},m.id))})]}),e.jsxs(v,{variant:"outlined",component:"label",fullWidth:!0,sx:{mt:2},children:["Seleccionar archivo Excel",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx, .xls",onChange:S})]}),o&&e.jsx(E,{label:"Archivo seleccionado",value:o.name,fullWidth:!0,disabled:!0,margin:"normal"})]})}),e.jsxs(K,{children:[e.jsx(v,{disabled:!s||!t,onClick:()=>{h(s,t),f(null)},children:"Exportar Concentrado"}),e.jsx(v,{onClick:()=>{d(),n(null),c(null)},children:"Cancelar"}),e.jsx(v,{variant:"contained",onClick:C,disabled:!o||!s,children:"Importar"})]})]})}function Ve({open:g,onClose:d,type:r,handleSowQuestions:u}){const h=[{field:"name",headerName:"Nivel",flex:.1},{field:"description",headerName:"Descripción",flex:.5},{field:"actions",headerName:"Acciones",flex:.2,sortable:!1,renderCell:i=>e.jsx(X,{direction:"row",spacing:1,children:e.jsx(Q,{title:"Ver preguntas",arrow:!0,children:e.jsx(A,{onClick:()=>u(i.row),color:"primary",children:e.jsx(oe,{})})})})}];return e.jsxs($,{open:g,onClose:d,fullWidth:!0,maxWidth:"md",children:[e.jsxs(G,{children:["Niveles de: ",r==null?void 0:r.name]}),e.jsx(H,{children:e.jsx(x,{sx:{height:400,width:"100%"},children:e.jsx(ee,{rows:r==null?void 0:r.levels,columns:h,pageSize:5,rowsPerPageOptions:[5],getRowId:i=>i.id})})}),e.jsx(K,{children:e.jsx(v,{onClick:d,children:"Cerrar"})})]})}const Ue=a.forwardRef(function(d,r){return e.jsx(Oe,{direction:"up",ref:r,...d})});function Ge({open:g,close:d,questions:r,type:u,handleEditQuestion:h,handleDeleteQuestion:i}){const f=n=>{if(typeof n!="string")return!1;const t=n.trim().toLowerCase();return t.startsWith("data:image/")||/\.(png|jpe?g|gif|svg|webp)$/.test(t)},o=n=>n?n.startsWith("http")||n.startsWith("data:")?n:`undefined/${n}`:"",b=[{field:"name",headerName:"Memorama",flex:.9,sortable:!0,renderCell:n=>{const t=Fe[n.row.name];return t?e.jsx(t,{sx:{fontSize:40,color:"#555",mx:"auto"}}):e.jsx("span",{children:n.row.name})}}],s=[{field:"question",headerName:"Pregunta",flex:.9,sortable:!0,renderCell:n=>n.row.question?e.jsx(Q,{title:n.row.question,arrow:!0,children:e.jsx("span",{style:{cursor:"default"},children:n.row.question})}):e.jsx(x,{component:"img",src:n.row.question_image,alt:"Pregunta",sx:{width:300,height:"auto",objectFit:"contain"}})},{field:"answer_a",headerName:"Opción A",flex:.9,sortable:!0,renderCell:({row:n})=>{if(n.question){const c=n.answer_a??n.option_a??"";return e.jsx("span",{children:c||"-"})}const t=n.answer_a??n.option_a??"";return t?f(t)?e.jsx(x,{sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(x,{component:"img",src:o(t),alt:"Respuesta A",sx:{width:25,height:25,objectFit:"contain"}})}):e.jsx("span",{children:t}):e.jsx("span",{children:"-"})}},{field:"answer_b",headerName:"Opción B",flex:.9,sortable:!0,renderCell:({row:n})=>{if(n.question){const c=n.answer_b??n.option_b??"";return e.jsx("span",{children:c||"-"})}const t=n.answer_b??n.option_b??"";return t?f(t)?e.jsx(x,{sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(x,{component:"img",src:o(t),alt:"Respuesta B",sx:{width:25,height:25,objectFit:"contain"}})}):e.jsx("span",{children:t}):e.jsx("span",{children:"-"})}},{field:"answer_c",headerName:"Opción C",flex:.9,sortable:!0,renderCell:({row:n})=>{if(n.question){const c=n.answer_c??n.option_c??"";return e.jsx("span",{children:c||"-"})}const t=n.answer_c??n.option_c??"";return t?f(t)?e.jsx(x,{sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(x,{component:"img",src:o(t),alt:"Respuesta C",sx:{width:25,height:25,objectFit:"contain"}})}):e.jsx("span",{children:t}):e.jsx("span",{children:"-"})}},{field:"answer_d",headerName:"Opción D",flex:.9,sortable:!0,renderCell:({row:n})=>{if(n.question){const c=n.answer_d??n.option_d??"";return e.jsx("span",{children:c||"-"})}const t=n.answer_d??n.option_d??"";return t?f(t)?e.jsx(x,{sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(x,{component:"img",src:o(t),alt:"Respuesta D",sx:{width:25,height:25,objectFit:"contain"}})}):e.jsx("span",{children:t}):e.jsx("span",{children:"-"})}},{field:"correct_answer",headerName:"Respuesta",flex:.9,sortable:!0,renderCell:n=>e.jsx("span",{children:n.row.correct_answer??n.row.answer})},{field:"actions",headerName:"Acciones",flex:.5,sortable:!0,renderCell:n=>e.jsxs(X,{direction:"row",spacing:1,children:[e.jsx(Q,{title:"Editar",arrow:!0,children:e.jsx(A,{onClick:()=>h(n.row,u==null?void 0:u.name),color:"primary",children:e.jsx(ce,{})})}),e.jsx(Q,{title:"Eliminar",arrow:!0,children:e.jsx(A,{onClick:()=>i(n.row.id),color:"error",children:e.jsx(de,{})})})]})}];return e.jsx(a.Fragment,{children:e.jsxs($,{fullScreen:!0,open:g,onClose:d,slots:{transition:Ue},children:[e.jsx(We,{sx:{position:"relative"},children:e.jsxs(Ae,{children:[e.jsx(A,{edge:"start",color:"inherit",onClick:d,"aria-label":"close",children:e.jsx(J,{})}),e.jsx(y,{sx:{ml:2,flex:1},variant:"h6",component:"div",children:u==null?void 0:u.name}),e.jsx(v,{autoFocus:!0,color:"inherit",onClick:d,children:"CERRAR"})]})}),e.jsx(x,{p:4,children:e.jsx(x,{sx:{height:500,width:"100%"},children:e.jsx(ee,{rows:r,columns:(u==null?void 0:u.bypass_levels_and_questions)!=1?s:b,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,autoHeight:!0})})})]})})}function He({open:g,onClose:d,levels:r=[],onChange:u}){const[h,i]=a.useState([]);a.useEffect(()=>{i(r||[])},[r]);const f=(s,n,t)=>{const c=[...h];c[s][n]=t,i(c),u(c)},o=()=>{const s={id:`new-${Date.now()}`,name:"",description:"",question_type_id:1},n=[...h,s];i(n),u(n)},b=s=>{if(h.length<=1)return;const n=[...h];n.splice(s,1),i(n),u(n)};return e.jsxs($,{open:g,onClose:d,fullWidth:!0,maxWidth:"sm",slotProps:{backdrop:{sx:{zIndex:s=>s.zIndex.drawer+2001}}},PaperProps:{sx:{zIndex:s=>s.zIndex.drawer+2002}},children:[e.jsx(G,{children:"Editar Niveles"}),e.jsxs(H,{dividers:!0,children:[h.length===0&&e.jsx(y,{variant:"body2",sx:{mt:1},children:"No hay niveles registrados."}),h.map((s,n)=>e.jsxs(x,{sx:{mt:2},children:[n!==0&&e.jsx(ye,{sx:{my:2}}),e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(y,{variant:"subtitle1",children:"NIVEL"}),e.jsx(A,{color:"error",onClick:()=>b(n),disabled:h.length<=1,children:e.jsx(de,{})})]}),e.jsx(E,{label:"Nombre",fullWidth:!0,value:s.name,onChange:t=>f(n,"name",t.target.value),sx:{mb:1}}),e.jsx(E,{label:"Descripción",fullWidth:!0,value:s.description,onChange:t=>f(n,"description",t.target.value)})]},s.id||n)),e.jsx(v,{variant:"outlined",onClick:o,sx:{mt:3},children:"Agregar nivel"})]}),e.jsx(K,{children:e.jsx(v,{onClick:d,children:"Cerrar"})})]})}function Ke({open:g,onClose:d,type:r=null,onSubmit:u}){const[h,i]=a.useState(!1),[f,o]=a.useState([]),[b,s]=a.useState({type_id:"",name:"",description:""});a.useEffect(()=>{r?(s({type_id:r.id||"",name:r.name||"",description:r.description||""}),o(r.levels||[])):(s({type_id:(r==null?void 0:r.id)||"",name:"",description:""}),o([]))},[r]);const n=c=>{const{name:w,value:I}=c.target;s(S=>({...S,[w]:I}))},t=c=>{c.preventDefault();const w={...b,levels:f};u(w),d()};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{anchor:"right",open:g,onClose:d,sx:{zIndex:c=>c.zIndex.drawer+10},children:e.jsxs(x,{sx:{width:400,p:3},role:"presentation",children:[e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(y,{variant:"h6",children:r?"Editar tipo de cuestionario":"Nuevo tipo de cuestionario"}),e.jsx(A,{onClick:d,children:e.jsx(J,{})})]}),e.jsxs(x,{component:"form",onSubmit:t,mt:2,children:[e.jsx(E,{label:"Nombre",name:"name",fullWidth:!0,value:b.name,onChange:n,required:!0}),e.jsx(E,{label:"Descripción",name:"description",fullWidth:!0,value:b.description,onChange:n,margin:"normal",required:!0}),e.jsx(v,{type:"button",variant:"text",color:"secondary",fullWidth:!0,sx:{mt:2},onClick:()=>i(!0),children:"Editar niveles"}),e.jsx(v,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:2},children:r?"Actualizar":"Crear"})]})]})}),e.jsx(He,{open:h,onClose:()=>i(!1),levels:f,onChange:o})]})}function Fr(){var se,ae;const{errors:g,flash:d}=Y().props,{subjects:r,types:u}=Y().props,[h,i]=a.useState(!1),[f,o]=a.useState(!1),[b,s]=a.useState(!1),[n,t]=a.useState(!1),[c,w]=a.useState(null),[I,S]=a.useState(null),[C,m]=a.useState(null),D=((ae=(se=Y().props)==null?void 0:se.flash)==null?void 0:ae.success)??null,[_,j]=a.useState(!!D),[T,k]=a.useState(!1),[L,l]=a.useState([]),[W,R]=a.useState(!1),[ue,re]=a.useState(!1),[me,ne]=a.useState(null),[xe,N]=a.useState(!1);a.useEffect(()=>{D&&j(!0)},[D]),a.useEffect(()=>{Object.keys(g).length>0&&k(!0)},[g]);const he=p=>{m(p),s(!0)},pe=(p,P)=>{w(p),i(!0),P=="MULTITASKING"?ne("MULTITASKING"):ne("SINGLE")},fe=p=>{m(p),o(!0)},te=()=>{i(!1),w(null),S(null)},je=()=>{s(!1),w(null),S(null)},ge=()=>{o(!1),w(null),S(null)},be=()=>{t(!0)},we=(p,P)=>{N(!0),O.Inertia.get(route("question.export",{typeId:p,levelId:P}),{},{onFinish:()=>N(!1),onError:()=>N(!1)})},_e=p=>{m(p),re(!0)},ve=[{field:"name",headerName:"Tipo de cuestionario",flex:.5},{field:"description",headerName:"Descripción",flex:.5},{field:"actions",headerName:"Acciones",flex:.5,sortable:!0,renderCell:p=>e.jsxs(X,{direction:"row",spacing:1,children:[e.jsx(Q,{title:"Niveles",arrow:!0,children:e.jsx(A,{onClick:()=>fe(p.row),color:"primary",children:e.jsx(oe,{})})}),e.jsx(Q,{title:"Asignar a Materias",arrow:!0,children:e.jsx(A,{onClick:()=>he(p.row),color:"primary",children:e.jsx(Ee,{})})}),e.jsx(Q,{title:"Editar tipo",arrow:!0,children:e.jsx(A,{onClick:()=>_e(p.row),color:"primary",children:e.jsx(ce,{})})})]})}],Ce=p=>{confirm("¿Estás seguro de eliminar esta pregunta?")&&O.Inertia.delete(route("question.destroy",p),{preserveScroll:!0,onStart:()=>{N(!0)},onError:()=>{N(!1)},onSuccess:()=>{N(!1)}})},Ie=p=>{N(!0),O.Inertia.post(route("question.test"),p,{forceFormData:!0,onFinish:()=>{console.log("termino de guardar"),N(!1)}})},Se=async p=>{try{N(!0);const P=await ie.get(route("question.show",{typeId:C==null?void 0:C.id,levelId:p==null?void 0:p.id}));P.data.questions&&(l(P.data.questions),R(!0),N(!1))}catch(P){console.error("Error al obtener preguntas:",P)}},De=p=>{O.Inertia.put(route("type.update",p.type_id),p)};return e.jsxs(Ne,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Cuestionarios"}),children:[e.jsx(ke,{title:"Cuestionarios"}),e.jsx(Pe,{open:_,onClose:()=>j(!1),message:D}),e.jsx(ze,{open:T,onClose:()=>k(!1),errors:g}),e.jsxs(x,{p:4,children:[e.jsx(x,{display:"flex",justifyContent:"flex-end",mb:2,children:e.jsx(v,{variant:"contained",color:"primary",onClick:be,children:"Importar Cuestionario"})}),e.jsx(x,{sx:{height:500,width:"100%"},children:e.jsx(ee,{rows:u,columns:ve,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,autoHeight:!0})})]}),e.jsx(q,{open:xe,sx:{color:"#fff",zIndex:p=>p.zIndex.modal+1},children:e.jsx(U,{color:"inherit"})}),me=="MULTITASKING"?e.jsx(Me,{open:h,onClose:te,question:c}):e.jsx(Qe,{open:h,onClose:te,question:c}),e.jsx(Be,{open:b,onClose:je,subjects:r,type:C,onSave:Ie}),e.jsx(Ve,{open:f,onClose:ge,type:C,handleSowQuestions:Se}),e.jsx(Ge,{open:W,close:()=>R(!1),questions:L,type:C,handleEditQuestion:pe,handleDeleteQuestion:Ce}),e.jsx($e,{open:n,onClose:()=>t(!1),types:u,onImport:p=>{N(!0),O.Inertia.post(route("question.import"),p,{forceFormData:!0,onFinish:()=>{console.log("termino de guardar"),N(!1)}})},handleExport:we}),e.jsx(Ke,{open:ue,onClose:()=>re(!1),type:C,onSubmit:De})]})}export{Fr as default};
