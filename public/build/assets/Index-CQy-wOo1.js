import{j as e,r as s,a as re,q as A,$ as se}from"./app-BvioZF8O.js";import{D as ie,M as w,A as le}from"./AuthenticatedLayout-E3UBRmTd.js";import{c as z}from"./ButtonBase-wecvMaha.js";import{d as k}from"./index-L7eV0z_h.js";import{C as oe,T as v,F as y,I as D,a as q}from"./Close-Dc21t6Uw.js";import{B as I}from"./Logout-pGeDttDu.js";import{T as P}from"./Typography-QI3aQ4H6.js";import{I as E}from"./IconButton-CfOetlK4.js";import{F as V}from"./FormControlLabel-Ebh7BGzM.js";import{C as G,D as H,E as de,a as ce,S as ue,V as me}from"./ValidationErrorAlert-BmSoism1.js";import{B as S}from"./Button-Te3lklNG.js";import{D as Q}from"./Dialog-Cfi4jFQO.js";import{D as L,a as O,b as M}from"./DialogTitle-DO6p_D4A.js";import{F as he}from"./FormGroup-B6FQnwi3.js";import{S as U}from"./Stack-ITk6zMv5.js";import"./isMuiElement-CZu2d8pn.js";import"./getThemeProps-DGe96xVY.js";import"./index-BZd934AE.js";import"./Modal-TVW6gwfh.js";import"./Slide-CCEYf0br.js";import"./useFormControl-DAU01lwA.js";import"./useThemeProps-zsyYkAH1.js";import"./Alert-cMddPiOy.js";const pe=z(e.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"})),xe=z(e.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}));function fe({open:g,onClose:p,question:a=null,subjectId:l}){const[c,u]=s.useState({subject_id:l,question:"",answer_a:"",answer_b:"",answer_c:"",answer_d:"",correct_answer:"",feedback_text:"",feedback_image:null,has_dynamic:!1});s.useEffect(()=>{l&&u(d=>({...d,subject_id:l}))},[l]),s.useEffect(()=>{u(a?{subject_id:a.subject_id||l||"",question:a.question||"",answer_a:a.answer_a||"",answer_b:a.answer_b||"",answer_c:a.answer_c||"",answer_d:a.answer_d||"",correct_answer:a.correct_answer||"",feedback_text:a.feedback_text||"",feedback_image:null,has_dynamic:a.has_dynamic||!1}:{subject_id:l||"",question:"",answer_a:"",answer_b:"",answer_c:"",answer_d:"",correct_answer:"",feedback_text:"",feedback_image:null,has_dynamic:!1})},[a,l]);const o=d=>{const{name:t,type:x,files:f,value:i,checked:C}=d.target,_=x==="file"?f[0]:x==="checkbox"?C:i;u(j=>({...j,[t]:_}))},m=d=>{d.preventDefault();const t={...c};a?k.Inertia.post(route("question.update",a.id),{...t,_method:"PUT"},{forceFormData:!0}):k.Inertia.post(route("question.store"),t,{forceFormData:!0}),p()};return e.jsx(ie,{anchor:"right",open:g,onClose:p,sx:{zIndex:d=>d.zIndex.drawer+1e3},children:e.jsxs(I,{sx:{width:400,p:3},role:"presentation",children:[e.jsxs(I,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(P,{variant:"h6",children:a?"Editar Pregunta":"Nueva Pregunta"}),e.jsx(E,{onClick:p,children:e.jsx(oe,{})})]}),e.jsxs(I,{component:"form",onSubmit:m,mt:2,children:[e.jsx(v,{label:"Pregunta",name:"question",fullWidth:!0,value:c.question,onChange:o,margin:"normal",required:!0}),e.jsx(v,{label:"Respuesta A",name:"answer_a",fullWidth:!0,value:c.answer_a,onChange:o,margin:"normal",required:!0}),e.jsx(v,{label:"Respuesta B",name:"answer_b",fullWidth:!0,value:c.answer_b,onChange:o,margin:"normal",required:!0}),e.jsx(v,{label:"Respuesta C",name:"answer_c",fullWidth:!0,value:c.answer_c,onChange:o,margin:"normal",required:!0}),e.jsx(v,{label:"Respuesta D",name:"answer_d",fullWidth:!0,value:c.answer_d,onChange:o,margin:"normal"}),e.jsxs(y,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(D,{id:"correct-answer-label",children:"Respuesta Correcta"}),e.jsxs(q,{labelId:"correct-answer-label",name:"correct_answer",value:c.correct_answer,label:"Respuesta Correcta",onChange:o,MenuProps:{container:document.body,disablePortal:!0},children:[e.jsx(w,{value:"A",children:"A"}),e.jsx(w,{value:"B",children:"B"}),e.jsx(w,{value:"C",children:"C"}),e.jsx(w,{value:"D",children:"D"})]})]}),e.jsx(v,{label:"Retroalimentación",name:"feedback_text",fullWidth:!0,multiline:!0,rows:3,value:c.feedback_text,onChange:o,margin:"normal"}),e.jsx("input",{type:"file",name:"feedback_image",onChange:o,style:{marginTop:16}}),e.jsx(V,{control:e.jsx(G,{checked:c.has_dynamic,onChange:o,name:"has_dynamic"}),label:"¿Contiene dinámica?",sx:{mt:2}}),e.jsx(S,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{mt:2},children:a?"Actualizar":"Crear"})]})]})})}function ge({open:g,onClose:p,types:a,subject:l,onSave:c}){const[u,o]=s.useState(""),[m,d]=s.useState(""),t=a.find(n=>n.id===Number(u)),x=(t==null?void 0:t.levels)||[],f=x.find(n=>n.id===Number(m)),[i,C]=s.useState(!1),[_,j]=s.useState(""),[b,r]=s.useState(""),F=(t==null?void 0:t.name)==="MULTITASK"||(t==null?void 0:t.name)==="MULTITASKING",[W,T]=s.useState(""),N=()=>{if(l!=null&&l.id&&u){const n=new FormData;n.append("subject_id",l.id),n.append("question_type_id",u),n.append("question_level_id",m),n.append("question_count",_),n.append("game",W),n.append("has_time_limit",i?"1":"0"),i&&n.append("time_limit",b),c(n),o(""),d(""),j(""),r(""),p()}};return e.jsxs(Q,{open:g,onClose:p,fullWidth:!0,maxWidth:"xl",children:[e.jsxs(L,{children:["Crear cuestionario para: ",l==null?void 0:l.name]}),e.jsx(O,{children:e.jsxs(I,{sx:{mt:2},children:[e.jsxs(y,{fullWidth:!0,margin:"normal",children:[e.jsx(D,{id:"type-select-label",children:"Tipo de cuestionario"}),e.jsx(q,{labelId:"type-select-label",value:u,label:"Tipo de cuestionario",onChange:n=>{o(n.target.value),d("")},required:!0,children:a.map(n=>e.jsx(w,{value:n.id,children:n.name},n.id))})]}),e.jsxs(y,{fullWidth:!0,margin:"normal",disabled:!x.length,children:[e.jsx(D,{id:"level-select-label",children:"Nivel de complejidad"}),e.jsx(q,{labelId:"level-select-label",value:m,label:"Nivel de complejidad",onChange:n=>d(n.target.value),required:x.length>0,children:x.map(n=>e.jsxs(w,{value:n.id,disabled:n.questions_count===0,children:[n.name," - ",n.description]},n.id))})]}),(f||t)&&e.jsxs(y,{fullWidth:!0,margin:"normal",children:[e.jsxs(P,{variant:"subtitle1",component:"p",children:["Preguntas disponibles sobre examen (",f?f.questions_count||0:(t==null?void 0:t.questions_count)||0,")"]}),e.jsx(v,{id:"count-question-required",label:"Número de preguntas para examen",type:"number",inputProps:{min:1,max:f?f.questions_count:(t==null?void 0:t.questions_count)||1},onChange:n=>j(n.target.value),required:!0})]}),F&&e.jsxs(y,{fullWidth:!0,margin:"normal",children:[e.jsx(D,{id:"game-type-label",children:"Tipo de juego"}),e.jsxs(q,{labelId:"game-type-label",value:W,label:"Tipo de juego",onChange:n=>T(n.target.value),required:!0,children:[e.jsx(w,{value:"balde",children:"Balde"}),e.jsx(w,{value:"avion",children:"Avión"})]})]}),u&&e.jsx(he,{children:e.jsx(V,{control:e.jsx(G,{checked:i,onChange:n=>C(n.target.checked)}),label:"Tiempo límite"})}),i&&e.jsxs(e.Fragment,{children:[console.log(u),e.jsx(y,{fullWidth:!0,margin:"normal",children:e.jsx(v,{id:"limit-time-required",label:"Tiempo límite (segundos por pregunta)",type:"number",onChange:n=>r(n.target.value),inputProps:{min:1}})})]})]})}),e.jsxs(M,{children:[e.jsx(S,{onClick:()=>{p(),o(""),m("")},children:"Cancelar"}),e.jsx(S,{variant:"contained",onClick:N,disabled:!u,children:"Crear"})]})]})}function je({open:g,onClose:p,types:a,onImport:l,handleExport:c}){const[u,o]=s.useState(""),[m,d]=s.useState(null),[t,x]=s.useState(""),[f,i]=s.useState(""),C=a.find(r=>r.id===Number(t)),_=(C==null?void 0:C.levels)||[],j=r=>{d(r.target.files[0])},b=()=>{if(m&&t){const r=new FormData;r.append("file",m),r.append("type_id",t),r.append("level_id",f),l(r),d(null),setTypetId(""),setLeveltId(""),p()}};return e.jsxs(Q,{open:g,onClose:p,fullWidth:!0,maxWidth:"sm",children:[e.jsx(L,{children:"Importar a banco de preguntas"}),e.jsx(O,{children:e.jsxs(I,{sx:{mt:2},children:[e.jsxs(y,{fullWidth:!0,margin:"normal",children:[e.jsx(D,{id:"type-select-label",children:"Tipo de cuestionario"}),e.jsx(q,{labelId:"type-select-label",value:t,label:"Tipo de cuestionario",onChange:r=>{x(r.target.value),i("")},required:!0,children:a.filter(r=>r.is_automatic===0).map(r=>e.jsx(w,{value:r.id,children:r.name},r.id))})]}),e.jsxs(y,{fullWidth:!0,margin:"normal",disabled:!_.length,children:[e.jsx(D,{id:"level-select-label",children:"Nivel de complejidad"}),e.jsx(q,{labelId:"level-select-label",value:f,label:"Nivel de complejidad",onChange:r=>i(r.target.value),required:!0,children:_.map(r=>e.jsxs(w,{value:r.id,children:[r.name," - ",r.description]},r.id))})]}),e.jsxs(S,{variant:"outlined",component:"label",fullWidth:!0,sx:{mt:2},children:["Seleccionar archivo Excel",e.jsx("input",{type:"file",hidden:!0,accept:".xlsx, .xls",onChange:j})]}),m&&e.jsx(v,{label:"Archivo seleccionado",value:m.name,fullWidth:!0,disabled:!0,margin:"normal"})]})}),e.jsxs(M,{children:[e.jsx(S,{onClick:()=>{c(u),o(null)},children:"Exportar Concentrado"}),e.jsx(S,{onClick:()=>{p(),x(null),i(null)},children:"Cancelar"}),e.jsx(S,{variant:"contained",onClick:b,disabled:!m||!t,children:"Importar"})]})]})}function _e({open:g,onClose:p,subject:a,handleEditQuestion:l,handleDelete:c,handleExport:u}){const[o,m]=s.useState([]),[d,t]=s.useState(!0),x=async()=>{try{const i=await re.get(route("question.subject",a==null?void 0:a.id));m(i.data)}catch(i){console.error("Error fetching questions:",i)}finally{t(!1)}};s.useEffect(()=>{g&&(a!=null&&a.id)&&x()},[g,a==null?void 0:a.id]);const f=[{field:"question",headerName:"Pregunta",flex:1},{field:"correct_answer",headerName:"Correcta",width:120,renderCell:i=>e.jsx("span",{children:i.row.correct_answer||i.row.answer})},{field:"actions",headerName:"Acciones",width:120,sortable:!1,renderCell:i=>e.jsxs(U,{direction:"row",spacing:1,children:[e.jsx(E,{onClick:()=>l(i.row),color:"primary",children:e.jsx(de,{})}),e.jsx(E,{onClick:()=>c(i.row.id),color:"error",size:"small",children:e.jsx(ce,{})})]})}];return e.jsxs(Q,{open:g,onClose:p,fullWidth:!0,maxWidth:"md",children:[e.jsxs(L,{children:["Preguntas de la materia: ",a==null?void 0:a.name]}),e.jsx(O,{children:d?e.jsx(P,{children:"Cargando preguntas..."}):e.jsx(I,{sx:{height:400,width:"100%"},children:e.jsx(H,{rows:o,columns:f,pageSize:5,rowsPerPageOptions:[5],getRowId:i=>i.id})})}),e.jsx(M,{children:e.jsx(S,{onClick:p,children:"Cerrar"})})]})}function ze(){var B,R;const{errors:g,flash:p}=A().props,{questions:a,subjects:l,types:c}=A().props,[u,o]=s.useState(!1),[m,d]=s.useState(!1),[t,x]=s.useState(!1),[f,i]=s.useState(!1),[C,_]=s.useState(null),[j,b]=s.useState(null),r=((R=(B=A().props)==null?void 0:B.flash)==null?void 0:R.success)??null,[F,W]=s.useState(!!r),[T,N]=s.useState(!1);s.useEffect(()=>{r&&W(!0)},[r]),s.useEffect(()=>{Object.keys(g).length>0&&N(!0)},[g]);const n=h=>{b(h),x(!0)},K=h=>{_(h),o(!0)},$=h=>{b(h),d(!0)},J=()=>{o(!1),_(null),b(null)},X=()=>{x(!1),_(null),b(null)},Y=()=>{d(!1),_(null),b(null)},Z=()=>{i(!0)},ee=h=>{k.Inertia.get(route("question.export",h))},ne=[{field:"name",headerName:"Materia",flex:.5},{field:"questions_count",headerName:"Número de preguntas",flex:.5},{field:"actions",headerName:"Acciones",flex:.5,sortable:!0,renderCell:h=>e.jsxs(U,{direction:"row",spacing:1,children:[e.jsx(E,{onClick:()=>$(h.row),color:"primary",children:e.jsx(xe,{})}),e.jsx(E,{onClick:()=>n(h.row),color:"primary",children:e.jsx(pe,{})})]})}],ae=h=>{confirm("¿Estás seguro de eliminar esta pregunta?")&&k.Inertia.delete(route("question.destroy",h))},te=h=>{k.Inertia.post(route("question.test"),h,{forceFormData:!0})};return e.jsxs(le,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Cuestionarios"}),children:[e.jsx(se,{title:"Cuestionarios"}),e.jsx(ue,{open:F,onClose:()=>W(!1),message:r}),e.jsx(me,{open:T,onClose:()=>N(!1),errors:g}),e.jsxs(I,{p:4,children:[e.jsx(I,{display:"flex",justifyContent:"flex-end",mb:2,children:e.jsx(S,{variant:"contained",color:"primary",onClick:Z,children:"Importar Cuestionario"})}),e.jsx(I,{sx:{height:500,width:"100%"},children:e.jsx(H,{rows:l,columns:ne,pageSize:10,rowsPerPageOptions:[5,10,20],disableSelectionOnClick:!0,autoHeight:!0})})]}),e.jsx(fe,{open:u,onClose:J,question:C,subjectId:j==null?void 0:j.id}),e.jsx(ge,{open:t,onClose:X,subject:j,types:c,onSave:te}),e.jsx(_e,{open:m,onClose:Y,subject:j,handleEditQuestion:K,handleDelete:ae}),e.jsx(je,{open:f,onClose:()=>i(!1),types:c,onImport:h=>{k.Inertia.post(route("question.import"),h,{forceFormData:!0})},handleExport:ee})]})}export{ze as default};
